(()=>{var{defineProperty:l,getOwnPropertyNames:v$,getOwnPropertyDescriptor:p$}=Object,d$=Object.prototype.hasOwnProperty;var P$=new WeakMap,c$=($)=>{var J=P$.get($),U;if(J)return J;if(J=l({},"__esModule",{value:!0}),$&&typeof $==="object"||typeof $==="function")v$($).map((Y)=>!d$.call(J,Y)&&l(J,Y,{get:()=>$[Y],enumerable:!(U=p$($,Y))||U.enumerable}));return P$.set($,J),J};var i$=($,J)=>{for(var U in J)l($,U,{get:J[U],enumerable:!0,configurable:!0,set:(Y)=>J[U]=()=>Y})};var t$={};i$(t$,{initSpruceX:()=>s,SpruceX:()=>h$});var j="sx-data",m="sx-text",g="sx-html",e="sx-show",v="sx-bind:",p="sx-on:",$$="sx-model",d="sx-model.",J$="sx-class",D$="sx-toggle",I="sx-error-fallback",T="sx-for",c="sx-memo",R="sx-page",U$="sx-boost",Q$="sx-boost-on",O$=["get","post","put","delete"],K$="sx-trigger",L$="sx-target",F$="sx-swap",w$="sx-vars",N$="sx-json-into",S$="sx-optimistic",M$="sx-revert-on-error",j$="sx-poll",B$="sx-poll-while",I$="sx-include",Y$="sx-lazy",Z$="sx-local",x="sx-animate",n=new Set(["click","dblclick","mousedown","mouseup","input","change","submit","keydown","keyup","keypress","focusin","focusout"]);var k=($,J)=>{if(J($)===!1)return;let U=$.firstElementChild;while(U){let Y=U.nextElementSibling;k(U,J),U=Y}};function x$($){return typeof $==="function"&&/^class\s/.test($.toString())}function q$($){let J=$.match(/^\s*(.*?)\s+(in|of)\s+(.*)\s*$/);if(!J)return null;let U=J[1].trim(),Y=J[3].trim();if(U.startsWith("(")){let Q=U.slice(1,-1),[Z,q]=Q.split(",").map((W)=>W.trim());return{item:Z,index:q,iterable:Y}}return{item:U,index:null,iterable:Y}}function _$($){let J=document.createDocumentFragment(),U=$.firstChild;while(U)J.appendChild(U.cloneNode(!0)),U=U.nextSibling;return J}function b($,J,U=new WeakSet){if($===null||typeof $!=="object")return $;if(U.has($))return $;if(U.add($),Array.isArray($))["push","pop","shift","unshift","splice","sort","reverse"].forEach((Z)=>{let q=$[Z];if(typeof q==="function")$[Z]=function(...W){let z=q.apply(this,W);return J(),z}}),$.forEach((Z,q)=>{if(Z&&typeof Z==="object")$[q]=b(Z,J,U)});else Object.keys($).forEach((Q)=>{if($[Q]&&typeof $[Q]==="object")$[Q]=b($[Q],J,U)});return new Proxy($,{get(Q,Z,q){let W=Reflect.get(Q,Z,q);if(typeof W==="function"&&!x$(W))return W.bind(q);return W},set(Q,Z,q,W){let z=Q[Z];if(q&&typeof q==="object")q=b(q,J,new WeakSet);let P=Reflect.set(Q,Z,q,W);if(z!==q)J(Z,q,z);return P},deleteProperty(Q,Z){let q=Reflect.deleteProperty(Q,Z);return J(),q}})}function f$($,J){let U=$.watch||{};if(U&&typeof U==="object")delete $.watch;let Q=b($,(Z,q,W)=>{if(J(Z,q,W),U&&typeof U[Z]==="function")try{U[Z].call(Q,q,W)}catch(z){console.error("SpruceX watcher error on",Z,z)}});return{proxy:Q,watchers:U}}var E=Object.create(null),_=Object.create(null);function h($){return E[$]}function C$($,J,U={}){if(!E[$]){let Y=J||{};if(U.persist)try{let q=localStorage.getItem(`sprucex-store-${$}`);if(q)Object.assign(Y,JSON.parse(q))}catch(q){console.error(`SpruceX store "${$}" load error:`,q)}let Q=new Set;_[$]=Q;let Z=()=>{if(U.persist)try{localStorage.setItem(`sprucex-store-${$}`,JSON.stringify(E[$]))}catch(q){console.error(`SpruceX store "${$}" save error:`,q)}Q.forEach((q)=>q.scheduleUpdate())};E[$]=b(Y,Z)}return E[$]}var i=null,W$=!1;function o(){if(W$)return i;if(W$=!0,window.autoAnimate)i=window.autoAnimate;else if(window.AutoAnimate?.default)i=window.AutoAnimate.default;return i}function y$($){i=$,W$=!0}var R$=new Map,k$=new Map;function z$($,J,U={}){let Y=J.locals||{},Q=Object.keys(U),Z=$+"|"+Q.join(","),q=R$.get(Z);if(!q)try{q=new Function("$state","$event","$refs","$emit","$store","$locals",...Q,`with($state){ with($locals){ return (${$}); } }`),R$.set(Z,q)}catch(W){if(J.debug)console.error("SpruceX expression compile error:",$,W);throw W}try{return q(J.state,J.lastEvent||null,J.refs,J.emit,h,Y,...Object.values(U))}catch(W){if(J.debug)console.error("SpruceX expression error:",$,W);throw W}}function B($,J,U){try{return z$($,J)}catch(Y){if(U)try{return z$(U,J)}catch(Q){console.error("SpruceX fallback expression error:",U,Q)}return}}function C($,J,U={}){let Y=J.locals||{},Q=Object.keys(U),Z=$+"|"+Q.join(","),q=k$.get(Z);if(!q)try{q=new Function("$state","$event","$refs","$emit","$store","$locals",...Q,`with($state){ with($locals){ ${$} } }`),k$.set(Z,q)}catch(W){console.error("SpruceX statement compile error:",$,W);return}try{q(J.state,J.lastEvent||null,J.refs,J.emit,h,Y,...Object.values(U))}catch(W){console.error("SpruceX statement error:",$,W)}}function u($,J){let U=new Map;J.querySelectorAll("[id]").forEach((Y)=>{U.set(Y.id,Y)}),U.forEach((Y,Q)=>{let Z=$.querySelector(`#${CSS.escape(Q)}`);if(Z)b$(Z,Y),Y.__morphed=!0}),V$($,J)}function b$($,J){if($===J)return;if($.isEqualNode(J))return;if($.tagName!==J.tagName){$.replaceWith(J.cloneNode(!0));return}if(s$($,J),$.tagName==="INPUT"||$.tagName==="TEXTAREA"){if($.value!==J.value)$.value=J.value;if($.checked!==J.checked)$.checked=J.checked;return}if($.tagName==="SELECT"){if(V$($,J),$.value!==J.value)$.value=J.value;return}if($.hasAttribute("sx-preserve"))return;V$($,J)}function V$($,J){let U=Array.from($.childNodes),Y=Array.from(J.childNodes),Q=new Map,Z=new Map;U.forEach((W,z)=>{if(W.nodeType===1){let P=W.getAttribute?.("sx-key")||W.getAttribute?.("key");if(P)Q.set(P,{el:W,index:z});let K=W.id;if(K)Z.set(K,{el:W,index:z})}});let q=0;for(let W=0;W<Y.length;W++){let z=Y[W];if(z.nodeType===3||z.nodeType===8){let P=U[q];if(P&&P.nodeType===z.nodeType){if(P.nodeValue!==z.nodeValue)P.nodeValue=z.nodeValue;q++}else{let K=z.cloneNode(!0);if(P)$.insertBefore(K,P);else $.appendChild(K)}continue}if(z.nodeType===1){if(z.__morphed){delete z.__morphed,q++;continue}let P=z.getAttribute?.("sx-key")||z.getAttribute?.("key"),K=z.id,L=null;if(P&&Q.has(P))L=Q.get(P).el,Q.delete(P);else if(K&&Z.has(K))L=Z.get(K).el,Z.delete(K);else{let G=U[q];if(G?.nodeType===1&&G.tagName===z.tagName){if(!(G.getAttribute?.("sx-key")||G.getAttribute?.("key")))L=G}}if(L){b$(L,z);let G=Array.from($.childNodes).indexOf(L),F=W;if(G!==F&&G!==-1){let V=$.childNodes[F];if(V&&V!==L)$.insertBefore(L,V)}q++}else{let G=z.cloneNode(!0),F=U[q];if(F)$.insertBefore(G,F);else $.appendChild(G)}}}while($.childNodes.length>Y.length){let W=$.childNodes[Y.length];if(W){if(W.__sprucex)W.__sprucex.destroy();if(W.nodeType===1)W.querySelectorAll?.(`[${j}]`).forEach((z)=>{if(z.__sprucex)z.__sprucex.destroy()});W.remove()}}}function s$($,J){let U=Array.from($.attributes);for(let Q of U)if(!J.hasAttribute(Q.name))$.removeAttribute(Q.name);let Y=Array.from(J.attributes);for(let Q of Y)if($.getAttribute(Q.name)!==Q.value)$.setAttribute(Q.name,Q.value)}class H${constructor($){this.root=$,this.bindings=[],this.memoBindings=[],this.eventHandlers=[],this.netBindings=[],this.modelBindings=[],this.forBlocks=[],this.pollTimers=[],this.lastEvent=null,this.debug=!1,this.locals={},this.updatePending=!1,this.originalClasses=new WeakMap,this.animatedElements=new Map,this.refs={},this.emitter=document.createElement("div"),this.emit=(J,U)=>{let Y=new CustomEvent(J,{detail:U,bubbles:!1});this.emitter.dispatchEvent(Y)},this.initState(),this.collectRefs(),this.setupDelegation(),this.scan($),this.renderForBlocks(),this.applyInitialRender(),this.callHook("init"),queueMicrotask(()=>this.callHook("mounted"))}scheduleUpdate(){if(this.updatePending)return;this.updatePending=!0,this.rafId=requestAnimationFrame(()=>{this.updatePending=!1,this.rafId=null;let $=document.activeElement;if(!($&&($.tagName==="INPUT"||$.tagName==="TEXTAREA"||$.tagName==="SELECT"||$.isContentEditable)&&this.root.contains($)&&this.forBlocks.some((Y)=>{return Y.instances.some((Q)=>Q.elements&&Q.elements.some((Z)=>Z.contains($)))})))this.renderForBlocks();this.updateBindings(),this.modelBindings.forEach((Y)=>Y.updateDom()),this.updateMemoBindings()})}initState(){let $=this.root.getAttribute(j)||"{}",J,U=this.root.querySelector("script[sx-init-data]"),Y=/^[A-Za-z_$][A-Za-z0-9_$]*$/.test($);if(U&&Y)try{J=JSON.parse(U.textContent.trim()||"{}")}catch(q){console.error("SpruceX sx-init-data JSON parse error:",q),J={}}else try{J=new Function("$store",`return (${$});`)((W)=>{let z=h(W);if(z&&_[W])_[W].add(this);return z})}catch(q){console.error("SpruceX sx-data parse error:",$,q),J={}}let Q=this.root.getAttribute(Z$);if(Q)try{let q=localStorage.getItem(Q);if(q){let W=JSON.parse(q);Object.assign(J,W)}}catch(q){console.error("SpruceX sx-local load error:",q)}Object.defineProperty(J,"$emit",{value:this.emit,enumerable:!1}),Object.defineProperty(J,"$store",{value:(q)=>{let W=h(q);if(W&&_[q])_[q].add(this);return W},enumerable:!1});let{proxy:Z}=f$(J,()=>{if(Q)try{localStorage.setItem(Q,JSON.stringify(Z))}catch(q){console.error("SpruceX sx-local save error:",q)}this.scheduleUpdate()});this.state=Z}collectRefs(){this.refs={},this.root.querySelectorAll("[sx-ref]").forEach(($)=>{let J=$.getAttribute("sx-ref");if(J)this.refs[J]=$})}setupDelegation(){n.forEach(($)=>{let J=(U)=>this.handleDelegatedEvent(U);if(this.root.addEventListener($,J),!this._delegatedCleanups)this._delegatedCleanups=[];this._delegatedCleanups.push(()=>this.root.removeEventListener($,J))})}handleDelegatedEvent($){let J=$.target,U=!1,Y=$.stopPropagation;$.stopPropagation=function(){U=!0,Y.apply(this,arguments)};while(J&&J.nodeType===1){if(J.__sx_handlers&&J.__sx_handlers[$.type])J.__sx_handlers[$.type].forEach(({handler:Q,component:Z})=>{if(Z!==this)return;if(!U)Q($)});if(U)break;if(J===this.root)break;J=J.parentNode}}scan($){let J=this;k($,(U)=>{if(U!==$&&U.hasAttribute(j))return!1;if(U.tagName==="TEMPLATE"&&U.hasAttribute(T)){let Y=U.getAttribute(T)||"",Q=U.parentElement;if(!Q)return;let Z=document.createComment("sx-for");Q.insertBefore(Z,U),U.remove();let q=q$(Y);if(!q){console.error("SpruceX invalid sx-for expression:",Y);return}if(J.forBlocks.push({template:U,parent:Q,marker:Z,expr:Y,def:q,instances:[],autoAnimate:Q.hasAttribute(x)}),Q.hasAttribute(x)){let W=Q.getAttribute(x),z={};if(W&&W!=="true"&&W!=="")try{z=JSON.parse(W)}catch(P){let K=parseInt(W,10);if(!isNaN(K))z={duration:K}}J.setupAutoAnimate(Q,z)}}}),k($,(U)=>{if(U.nodeType!==1)return;if(U!==$&&U.hasAttribute(j))return!1;if(U.tagName==="TEMPLATE"&&U.hasAttribute(T))return;this.scanElement(U,null)}),this.setupNetworkBindings()}scanElement($,J){let U=this,Y=$.hasAttribute(c),Q=$.getAttribute(m);if(Q&&!Y)U.bindings.push({el:$,type:"text",expr:Q,errorFallback:$.getAttribute(I),locals:J});let Z=$.getAttribute(g);if(Z&&!Y)U.bindings.push({el:$,type:"html",expr:Z,errorFallback:$.getAttribute(I),locals:J});let q=$.getAttribute(e);if(q)U.bindings.push({el:$,type:"show",expr:q,errorFallback:$.getAttribute(I),locals:J});let W=$.getAttribute(J$);if(W){if(!U.originalClasses.has($))U.originalClasses.set($,new Set(Array.from($.classList)));U.bindings.push({el:$,type:"class",expr:W,errorFallback:$.getAttribute(I),locals:J})}let z=$.getAttribute(D$);if(z){let G=()=>{this.state[z]=!this.state[z]};$.addEventListener("click",G),U.eventHandlers.push({el:$,event:"click",handler:G})}for(let G of Array.from($.attributes))if(G.name.startsWith(v)){let F=G.name.slice(v.length);U.bindings.push({el:$,type:"bind",attr:F,expr:G.value,errorFallback:$.getAttribute(I),locals:J})}let P=$.getAttribute(c),K=$.getAttribute(m),L=$.getAttribute(g);if(P&&(K||L)){let G=[];try{let V=new Function(`return (${P});`)();if(Array.isArray(V))G=V}catch(F){console.error("SpruceX sx-memo parse error:",P,F)}U.memoBindings.push({el:$,expr:K||L,type:K?"text":"html",deps:G,lastVals:null,lastResult:null,locals:J})}this.setupModelBinding($,J);for(let G of Array.from($.attributes))if(G.name.startsWith(p)){let F=G.name.slice(p.length),[V,...D]=F.split("."),O=G.value,H=(X)=>{if(D.includes("prevent"))X.preventDefault();if(D.includes("stop"))X.stopPropagation();if(D.includes("self")&&X.target!==X.currentTarget)return;if(D.includes("window")&&X.target!==window)return;if(D.includes("document")&&X.target!==document)return;if(X instanceof KeyboardEvent){let w=D.filter((S)=>!["prevent","stop","self","window","document"].includes(S));if(w.length>0){let S=X.key.toLowerCase();if(!w.includes(S))return}}this.lastEvent=X;let N=this.locals;if(J)this.locals=J;C(O,this),this.locals=N};if(n.has(V)){if(!$.__sx_handlers)$.__sx_handlers={};if(!$.__sx_handlers[V])$.__sx_handlers[V]=[];$.__sx_handlers[V].push({handler:H,component:this})}else $.addEventListener(V,H),U.eventHandlers.push({el:$,event:V,handler:H})}if(!J)for(let G of O$){let F=`sx-${G}`,V=$.getAttribute(F);if(V){let D=$.getAttribute(K$)||"click",O=$.getAttribute(L$)||null,H=$.getAttribute(F$)||"innerHTML",X=$.getAttribute(w$),N=$.getAttribute(N$),w=$.getAttribute(S$),S=$.getAttribute(M$),M=$.getAttribute(j$),y=$.getAttribute(B$),A=$.getAttribute(I$),f={el:$,method:G.toUpperCase(),urlTpl:V,trigger:D,target:O,swap:H,varsExpr:X,jsonInto:N,optimistic:w,revertOnError:S,poll:M?Number(M):null,pollWhile:y,includeSelector:A};U.netBindings.push(f)}}if($.hasAttribute(x)){let G=$.getAttribute(x);queueMicrotask(()=>this.setupAutoAnimate($,G||{}))}}setupModelBinding($,J=null){let U=$.getAttribute($$),Y=Array.from($.attributes).filter((O)=>O.name.startsWith(d));if(!U&&Y.length===0)return;let Q=U||Y[0].value,Z=new Set,q=null;Y.forEach((O)=>{let H=O.name.slice(d.length);if(H.startsWith("debounce-ms"))q=Number(O.value||"200");else Z.add(H)});let W=($.type||"").toLowerCase(),z=W==="checkbox",P=W==="radio",K=$.tagName==="SELECT",L=()=>{let O=this.locals;if(J)this.locals=J;try{let H=B(Q,this);if(z)if(Array.isArray(H))$.checked=H.includes($.value);else $.checked=!!H;else if(P)$.checked=String(H)===String($.value);else if(K)$.value=H??"";else if(H!==null&&H!==void 0&&typeof H==="object")$.value=JSON.stringify(H);else $.value=H??""}finally{this.locals=O}},G=(O)=>{if(Z.has("trim")&&typeof O==="string")O=O.trim();if(Z.has("number")){let H=Number(O);if(!Number.isNaN(H))O=H}return O},F=()=>{let O=this.locals;if(J)this.locals=J;try{let H;if(z){let X=B(Q,this);if(Array.isArray(X)){let N=[...X],w=N.indexOf($.value);if($.checked&&w===-1)N.push($.value);if(!$.checked&&w!==-1)N.splice(w,1);H=N}else H=$.checked}else if(P){if(!$.checked)return;H=$.value}else if(K)H=$.value;else H=$.value;H=G(H),C(`${Q} = value`,this,{value:H})}finally{this.locals=O}},V="input";if(Z.has("lazy"))V="change";let D=F;if(q!=null&&q>0){let O=null;D=()=>{clearTimeout(O),O=setTimeout(F,q)}}$.addEventListener(V,D),this.eventHandlers.push({el:$,event:V,handler:D}),this.modelBindings.push({updateDom:L,locals:J})}setupNetworkBindings(){for(let $ of this.netBindings){let{el:J,trigger:U,poll:Y,pollWhile:Q}=$,Z=(W)=>{if(W)this.lastEvent=W;this.performRequest($)};J.addEventListener(U,Z),this.eventHandlers.push({el:J,event:U,handler:Z});let q=()=>this.performRequest($);if(this.emitter.addEventListener(U,q),Y&&!Number.isNaN(Y)){let W=setInterval(()=>{if(Q){if(!B(Q,this))return}this.performRequest($)},Y);this.pollTimers.push(W)}}}setupAutoAnimate($,J={}){let U=o();if(!U)return null;if(typeof J==="string"&&J.trim())try{J=new Function(`return (${J})`)()}catch(Z){console.error("SpruceX sx-animate options parse error:",Z),J={}}let Q={...{duration:250,easing:"ease-in-out"},...J};try{let Z=U($,Q);return this.animatedElements.set($,Z),Z}catch(Z){return console.error("SpruceX auto-animate error:",Z),null}}disableAutoAnimate($){let J=this.animatedElements.get($);if(J&&typeof J==="function")J.disable?.();this.animatedElements.delete($)}buildUrl($){let{urlTpl:J,varsExpr:U}=$;if(!U)return J;let Y=B(U,this)||{};try{return new Function("vars","with(vars){ return `"+J+"`; }")(Y)}catch(Q){return console.error("SpruceX url template error:",J,Q),J}}buildBody($){let{el:J,method:U,includeSelector:Y}=$;if(!["POST","PUT","DELETE"].includes(U))return null;if(J.tagName==="FORM"){let Q=new FormData(J);if(Y)document.querySelectorAll(Y).forEach((Z)=>{if(Z.tagName==="FORM")new FormData(Z).forEach((q,W)=>Q.append(W,q))});return Q}return null}async performRequest($){let J=this.buildUrl($),U=this.buildBody($),{el:Y,method:Q,target:Z,swap:q,jsonInto:W,optimistic:z,revertOnError:P}=$;if(z)C(z,this);try{let K=await fetch(J,{method:Q,body:U});if(!K.ok)throw new Error(`HTTP ${K.status}: ${K.statusText}`);let L=await K.text(),G=null;if(W&&L.trim().length)try{G=JSON.parse(L)}catch(V){console.error("SpruceX JSON parse error:",V)}if(W&&G!=null)C(`${W} = value`,this,{value:G});else this.applySwap(Z||Y,L,q);let F={response:K,text:L,json:G};Y.dispatchEvent(new CustomEvent("success",{detail:F,bubbles:!0})),Y.dispatchEvent(new CustomEvent("sprucex:success",{detail:F,bubbles:!0}))}catch(K){if(P)C(P,this);let L={error:K};Y.dispatchEvent(new CustomEvent("error",{detail:L,bubbles:!0})),Y.dispatchEvent(new CustomEvent("sprucex:error",{detail:L,bubbles:!0}))}}applySwap($,J,U){let Y=typeof $==="string"?document.querySelector($):$;if(!Y)return;switch(U){case"outerHTML":Y.outerHTML=J;break;case"before":Y.insertAdjacentHTML("beforebegin",J);break;case"after":Y.insertAdjacentHTML("afterend",J);break;case"prepend":Y.insertAdjacentHTML("afterbegin",J);break;case"append":Y.insertAdjacentHTML("beforeend",J);break;case"morph":{let q=new DOMParser().parseFromString(`<div>${J}</div>`,"text/html").body.firstChild;if(q)u(Y,q);break}case"id-map":{let q=new DOMParser().parseFromString(`<div>${J}</div>`,"text/html").body.firstChild;if(q)u(Y,q);break}case"innerHTML":default:Y.innerHTML=J}}renderForBlocks(){this.forBlocks.forEach(($)=>{let{def:J,template:U,parent:Y,marker:Q,instances:Z,parentLocals:q}=$,W=this.locals;if(q)this.locals=q;let z=B(J.iterable,this)||[],P=Array.from(z);this.locals=W;let K=new Map;Z.forEach((V)=>{let D=V.itemKey;if(D!==void 0)K.set(D,V)});let L=[],G=new Set;for(let V=0;V<P.length;V++){let D=P[V],O=J.index||"$index",H=D;if(typeof D==="object"&&D!==null)H=D;let X=K.get(H);if(X&&!G.has(H))G.add(H),X.scopeLocals[O]=V,L.push(X);else{let N=q?{...q}:{};N[J.item]=D,N[O]=V;let w=U.content?U.content.cloneNode(!0):_$(U),S=[];while(w.firstChild){let A=w.firstChild;S.push(A),w.removeChild(A)}let M={bindings:[],memoBindings:[],modelBindings:[],eventHandlers:[],nestedForBlocks:[]};S.forEach((A)=>{let f=this.scanFragmentBindings(A,N);if(M.bindings.push(...f.bindings),M.memoBindings.push(...f.memoBindings),M.modelBindings.push(...f.modelBindings),M.eventHandlers.push(...f.eventHandlers),f.nestedForBlocks)M.nestedForBlocks.push(...f.nestedForBlocks)});let y={scopeLocals:N,elements:S,bindings:M,itemKey:H};L.push(y),G.add(H)}}Z.forEach((V)=>{if(!G.has(V.itemKey)){if(V.elements)V.elements.forEach((D)=>D.remove());else if(V.fragmentRoot)V.fragmentRoot.remove();this.cleanupInstanceBindings(V.bindings)}});let F=Q;for(let V=L.length-1;V>=0;V--){let D=L[V];if(D.elements.forEach((O)=>{Y.insertBefore(O,F)}),D.elements.length>0)F=D.elements[0]}$.instances.length=0,$.instances.push(...L)})}scanFragmentBindings($,J){let U=this,Y={bindings:[],memoBindings:[],modelBindings:[],eventHandlers:[],nestedForBlocks:[]};return k($,(Q)=>{if(Q.nodeType!==1)return;if(Q.hasAttribute(j))return!1;if(Q.tagName==="TEMPLATE"&&Q.hasAttribute(T)){let V=Q.getAttribute(T)||"",D=Q.parentElement;if(!D)return;let O=document.createComment("sx-for");D.insertBefore(O,Q),Q.remove();let H=q$(V);if(!H)return console.error("SpruceX invalid nested sx-for expression:",V),!1;let X={template:Q,parent:D,marker:O,expr:V,def:H,instances:[],parentLocals:J,autoAnimate:D.hasAttribute(x)};if(U.forBlocks.push(X),Y.nestedForBlocks.push(X),D.hasAttribute(x)){let N=D.getAttribute(x),w={};if(N&&N!=="true"&&N!=="")try{w=JSON.parse(N)}catch(S){let M=parseInt(N,10);if(!isNaN(M))w={duration:M}}U.setupAutoAnimate(D,w)}return!1}let Z=Q.hasAttribute(c),q=Q.getAttribute(m);if(q&&!Z){let V={el:Q,type:"text",expr:q,errorFallback:Q.getAttribute(I),locals:J};U.bindings.push(V),Y.bindings.push(V)}let W=Q.getAttribute(g);if(W&&!Z){let V={el:Q,type:"html",expr:W,errorFallback:Q.getAttribute(I),locals:J};U.bindings.push(V),Y.bindings.push(V)}let z=Q.getAttribute(e);if(z){let V={el:Q,type:"show",expr:z,errorFallback:Q.getAttribute(I),locals:J};U.bindings.push(V),Y.bindings.push(V)}let P=Q.getAttribute(J$);if(P){if(!U.originalClasses.has(Q))U.originalClasses.set(Q,new Set(Array.from(Q.classList)));let V={el:Q,type:"class",expr:P,errorFallback:Q.getAttribute(I),locals:J};U.bindings.push(V),Y.bindings.push(V)}for(let V of Array.from(Q.attributes))if(V.name.startsWith(v)){let D=V.name.slice(v.length),O={el:Q,type:"bind",attr:D,expr:V.value,errorFallback:Q.getAttribute(I),locals:J};U.bindings.push(O),Y.bindings.push(O)}let K=Q.getAttribute(c),L=Q.getAttribute(m),G=Q.getAttribute(g);if(K&&(L||G)){let V=[];try{let H=new Function(`return (${K});`)();if(Array.isArray(H))V=H}catch(O){console.error("SpruceX sx-memo parse error:",K,O)}let D={el:Q,expr:L||G,type:L?"text":"html",deps:V,lastVals:null,lastResult:null,locals:J};U.memoBindings.push(D),Y.memoBindings.push(D)}let F=this.setupModelBindingWithReturn(Q,J);if(F)Y.modelBindings.push(F);for(let V of Array.from(Q.attributes))if(V.name.startsWith(p)){let D=V.name.slice(p.length),[O,...H]=D.split("."),X=V.value,N=(w)=>{if(H.includes("prevent"))w.preventDefault();if(H.includes("stop"))w.stopPropagation();if(H.includes("self")&&w.target!==w.currentTarget)return;if(H.includes("window")&&w.target!==window)return;if(H.includes("document")&&w.target!==document)return;if(w instanceof KeyboardEvent){let M=H.filter((y)=>!["prevent","stop","self","window","document"].includes(y));if(M.length>0){let y=w.key.toLowerCase();if(!M.includes(y))return}}this.lastEvent=w;let S=this.locals;this.locals=J,C(X,this),this.locals=S};if(n.has(O)){if(!Q.__sx_handlers)Q.__sx_handlers={};if(!Q.__sx_handlers[O])Q.__sx_handlers[O]=[];Q.__sx_handlers[O].push({handler:N,component:this})}else Q.addEventListener(O,N),U.eventHandlers.push({el:Q,event:O,handler:N}),Y.eventHandlers.push({el:Q,event:O,handler:N})}if(Q.hasAttribute(x)){let V=Q.getAttribute(x);queueMicrotask(()=>this.setupAutoAnimate(Q,V||{}))}}),Y}setupModelBindingWithReturn($,J=null){let U=$.getAttribute($$),Y=Array.from($.attributes).filter((H)=>H.name.startsWith(d));if(!U&&Y.length===0)return null;let Q=U||Y[0].value,Z=new Set,q=null;Y.forEach((H)=>{let X=H.name.slice(d.length);if(X.startsWith("debounce-ms"))q=Number(H.value||"200");else Z.add(X)});let W=($.type||"").toLowerCase(),z=W==="checkbox",P=W==="radio",K=$.tagName==="SELECT",L=()=>{let H=this.locals;if(J)this.locals=J;try{let X=B(Q,this);if(z)if(Array.isArray(X))$.checked=X.includes($.value);else $.checked=!!X;else if(P)$.checked=String(X)===String($.value);else if(K)$.value=X??"";else if(X!==null&&X!==void 0&&typeof X==="object")$.value=JSON.stringify(X);else $.value=X??""}finally{this.locals=H}},G=(H)=>{if(Z.has("trim")&&typeof H==="string")H=H.trim();if(Z.has("number")){let X=Number(H);if(!Number.isNaN(X))H=X}return H},F=()=>{let H=this.locals;if(J)this.locals=J;try{let X;if(z){let N=B(Q,this);if(Array.isArray(N)){let w=[...N],S=w.indexOf($.value);if($.checked&&S===-1)w.push($.value);if(!$.checked&&S!==-1)w.splice(S,1);X=w}else X=$.checked}else if(P){if(!$.checked)return;X=$.value}else if(K)X=$.value;else X=$.value;X=G(X),C(`${Q} = value`,this,{value:X})}finally{this.locals=H}},V="input";if(Z.has("lazy"))V="change";let D=F;if(q!=null&&q>0){let H=null;D=()=>{clearTimeout(H),H=setTimeout(F,q)}}$.addEventListener(V,D);let O={updateDom:L,locals:J,el:$,event:V,handler:D};return this.eventHandlers.push({el:$,event:V,handler:D}),this.modelBindings.push(O),O}cleanupInstanceBindings($){$.bindings.forEach((J)=>{let U=this.bindings.indexOf(J);if(U!==-1)this.bindings.splice(U,1)}),$.memoBindings.forEach((J)=>{let U=this.memoBindings.indexOf(J);if(U!==-1)this.memoBindings.splice(U,1)}),$.modelBindings.forEach((J)=>{let U=this.modelBindings.indexOf(J);if(U!==-1)this.modelBindings.splice(U,1)}),$.eventHandlers.forEach(({el:J,event:U,handler:Y})=>{J.removeEventListener(U,Y);let Q=this.eventHandlers.findIndex((Z)=>Z.el===J&&Z.event===U&&Z.handler===Y);if(Q!==-1)this.eventHandlers.splice(Q,1)})}applyInitialRender(){this.updateBindings(),this.modelBindings.forEach(($)=>$.updateDom()),this.updateMemoBindings()}updateBindings(){for(let $ of this.bindings){let{el:J,type:U,expr:Y,attr:Q,errorFallback:Z,locals:q}=$,W=this.locals;if(q)this.locals=q;try{switch(U){case"text":{let z=B(Y,this,Z);if(z!==null&&z!==void 0&&typeof z==="object")J.textContent=JSON.stringify(z);else J.textContent=z??"";break}case"html":{let z=B(Y,this,Z);if(z!==null&&z!==void 0&&typeof z==="object")J.innerHTML=JSON.stringify(z);else J.innerHTML=z??"";break}case"show":{let z=!!B(Y,this,Z);J.style.display=z?"":"none";break}case"bind":{let z=B(Y,this,Z);if(z===!1||z===null||z===void 0)J.removeAttribute(Q);else J.setAttribute(Q,z);break}case"class":{let z=B(Y,this,Z),P=this.originalClasses.get(J)||new Set,K=new Set(Array.from(J.classList));if(typeof z==="string"){let L=new Set(z.split(/\s+/).filter(Boolean));K.forEach((G)=>{if(!P.has(G))J.classList.remove(G)}),L.forEach((G)=>J.classList.add(G))}else if(z&&typeof z==="object")Object.keys(z).forEach((L)=>{L.split(/\s+/).filter(Boolean).forEach((G)=>{if(z[L])J.classList.add(G);else J.classList.remove(G)})});break}}}finally{this.locals=W}}}updateMemoBindings(){this.memoBindings.forEach(($)=>{let{el:J,expr:U,type:Y,deps:Q,locals:Z}=$,q=this.locals;if(Z)this.locals=Z;try{let W=Q.map((P)=>{if(Z&&P in Z)return Z[P];if(P in this.state)return this.state[P];return this.state[P]});if($.lastVals&&$.lastVals.length===W.length&&$.lastVals.every((P,K)=>P===W[K]))return;$.lastVals=W;let z=B(U,this);if($.lastResult=z,Y==="text")J.textContent=z??"";else J.innerHTML=z??""}finally{this.locals=q}})}callHook($){let J=this.state&&this.state[$];if(typeof J==="function")try{J.call(this.state)}catch(U){console.error(`SpruceX ${$}() hook error:`,U)}}refresh(){this.bindings=[],this.memoBindings=[],this.modelBindings=[],this.netBindings=[],this.forBlocks=[],this.eventHandlers.forEach(({el:$,event:J,handler:U})=>{$.removeEventListener(J,U)}),this.eventHandlers=[],k(this.root,($)=>{if($!==this.root&&$.hasAttribute(j))return!1;if($.__sx_handlers)delete $.__sx_handlers}),this.animatedElements.forEach(($,J)=>{this.disableAutoAnimate(J)}),this.animatedElements.clear(),this.pollTimers.forEach(($)=>clearInterval($)),this.pollTimers=[],this.collectRefs(),this.scan(this.root),this.renderForBlocks(),this.applyInitialRender()}destroy(){if(this.callHook("destroyed"),Object.keys(_).forEach(($)=>{_[$].delete(this)}),this.animatedElements.forEach(($,J)=>{this.disableAutoAnimate(J)}),this.animatedElements.clear(),this.eventHandlers.forEach(({el:$,event:J,handler:U})=>{$.removeEventListener(J,U)}),this._delegatedCleanups)this._delegatedCleanups.forEach(($)=>$());if(this.pollTimers.forEach(($)=>clearInterval($)),this.rafId)cancelAnimationFrame(this.rafId);this.bindings=[],this.memoBindings=[],this.modelBindings=[],this.eventHandlers=[],this.netBindings=[],this.forBlocks=[],this.pollTimers=[],delete this.root.__sprucex}}var t=new Map,a=new Map,n$=30000,h$={init:s,store:C$,inspect(){let $=document.querySelectorAll(`[${j}]`);return Array.from($).map((J)=>({el:J,state:J.__sprucex?.state||null}))},config($){},navigate($){let U=document.querySelector(`[${R}]`)?.getAttribute(R),Y=U?document.querySelector(U):document.body;return X$($,Y)},prefetch($){return r($)},clearCache(){t.clear()},morph($,J){if(typeof $==="string")$=document.querySelector($);if(typeof J==="string")J=new DOMParser().parseFromString(`<div>${J}</div>`,"text/html").body.firstChild;if($&&J)u($,J)},animate($,J={}){if(typeof $==="string")$=document.querySelector($);if(!$)return null;let U=o();if(!U)return console.warn("SpruceX: auto-animate library not found. Include it via script tag or npm."),null;return U($,J)},setAutoAnimate:y$};if(typeof window!=="undefined")window.SpruceX=h$;function E$($){if($.__sprucex)return $.__sprucex;let J=new H$($);return $.__sprucex=J,J}function s(){document.querySelectorAll(`[${j}]`).forEach((U)=>{if(!U.hasAttribute(Y$))E$(U);else{let Q=new IntersectionObserver((Z)=>{Z.forEach((q)=>{if(q.isIntersecting)E$(U),Q.disconnect()})});Q.observe(U)}});let J=document.querySelector(`[${R}]`);if(J&&!J.__sprucex_page)J.__sprucex_page=!0,a$(J);u$(),o$(),Array.from(document.scripts).forEach((U)=>{U.__sprucex_executed=!0})}var G$=null;function o$(){if(G$)return;if(G$=new MutationObserver(($)=>{for(let J of $)J.removedNodes.forEach((U)=>{if(U.nodeType!==1)return;if(U.__sprucex)U.__sprucex.destroy();U.querySelectorAll(`[${j}]`).forEach((Y)=>{if(Y.__sprucex)Y.__sprucex.destroy()})})}),document.body)G$.observe(document.body,{childList:!0,subtree:!0})}var A$=!1;function a$($){let J=$.getAttribute(R);if(J===null)return;let U=J?document.querySelector(J):document.body;if(!U){console.error("SpruceX sx-page target not found:",J);return}if(A$)return;A$=!0,document.addEventListener("click",async(Y)=>{let Q=Y.target.closest("a[href]");if(!Q)return;let Z=Q.getAttribute("href");if(!Z||Z.startsWith("#")||Z.startsWith("javascript:"))return;if(Q.hasAttribute("download")||Q.getAttribute("target")==="_blank")return;try{let q=new URL(Z,window.location.origin);if(q.origin!==window.location.origin)return;Y.preventDefault(),await X$(q.href,U)}catch{return}}),window.addEventListener("popstate",async()=>{await X$(window.location.href,U,!1)})}function u$(){document.querySelectorAll(`[${U$}]`).forEach(($)=>{if($.__sprucex_boost)return;$.__sprucex_boost=!0;let U=($.getAttribute(Q$)||"mouseenter").split(/\s+/);if($.tagName==="A")U.forEach((Y)=>{$.addEventListener(Y,()=>r($.href),{passive:!0,once:!0})});else U.forEach((Y)=>{$.addEventListener(Y,(Q)=>{let Z=Q.target.closest("a[href]");if(Z&&!Z.__sprucex_prefetched)Z.__sprucex_prefetched=!0,r(Z.href)},{passive:!0})}),$.addEventListener("focusin",(Y)=>{let Q=Y.target.closest("a[href]");if(Q&&!Q.__sprucex_prefetched)Q.__sprucex_prefetched=!0,r(Q.href)},{passive:!0})})}async function X$($,J,U=!0){let Y=performance.now(),Q=new CustomEvent("sprucex:page-before",{detail:{url:$},bubbles:!0,cancelable:!0});if(!document.dispatchEvent(Q))return;try{let Z=g$($);if(!Z){if(J)J.style.opacity=J.style.opacity||"1";Z=await m$($)}if(!Z)throw new Error("Empty response");let W=new DOMParser().parseFromString(Z,"text/html"),z,K=document.querySelector("[sx-page]")?.getAttribute(R);if(K)z=W.querySelector(K);if(!z)z=W.body;let L=W.querySelector("title");if(L)document.title=L.textContent;if(T$(J),J&&z)u(J,z),J.querySelectorAll("script").forEach((V)=>{if(!V.__sprucex_executed)r$(V)});if(U)history.pushState({url:$},"",$);T$(J),s();let G=J.parentElement;while(G){if(G.__sprucex)G.__sprucex.refresh();G=G.parentElement}u$();let F=new URL($).hash;if(F){let V=document.querySelector(F);if(V)V.scrollIntoView()}else window.scrollTo(0,0);document.dispatchEvent(new CustomEvent("sprucex:page-after",{detail:{url:$,duration:performance.now()-Y},bubbles:!0}))}catch(Z){console.error("SpruceX page navigation error:",Z),document.dispatchEvent(new CustomEvent("sprucex:page-error",{detail:{url:$,error:Z},bubbles:!0})),window.location.href=$}}function T$($){if(!$)return;if($.querySelectorAll(`[${j}]`).forEach((J)=>{if(J.__sprucex)J.__sprucex.destroy()}),$.hasAttribute(j)&&$.__sprucex)$.__sprucex.destroy()}async function r($){if(!$)return;try{let J=new URL($,window.location.origin);if(J.origin!==window.location.origin)return;if(J.href===window.location.href)return;await m$(J.href)}catch{}}async function m$($){let J=g$($);if(J)return J;if(a.has($))return a.get($);let U=(async()=>{try{let Y=await fetch($,{headers:{"X-SpruceX-Request":"true"}});if(!Y.ok)throw new Error(`HTTP ${Y.status}`);let Q=await Y.text();return t.set($,{html:Q,timestamp:Date.now()}),Q}finally{a.delete($)}})();return a.set($,U),U}function g$($){let J=t.get($);if(!J)return null;if(Date.now()-J.timestamp>n$)return t.delete($),null;return J.html}if(typeof document!=="undefined")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",s);else s();function r$($){if($.type&&$.type!=="text/javascript"&&$.type!=="application/javascript"&&$.type!=="module")return;let J=document.createElement("script");Array.from($.attributes).forEach((U)=>{J.setAttribute(U.name,U.value)}),J.textContent=$.textContent,J.__sprucex_executed=!0,$.replaceWith(J)}})();

(()=>{var{defineProperty:U$,getOwnPropertyNames:RZ,getOwnPropertyDescriptor:EZ}=Object,yZ=Object.prototype.hasOwnProperty;var C$=new WeakMap,TZ=($)=>{var Z=C$.get($),Y;if(Z)return Z;if(Z=U$({},"__esModule",{value:!0}),$&&typeof $==="object"||typeof $==="function")RZ($).map((J)=>!yZ.call(Z,J)&&U$(Z,J,{get:()=>$[J],enumerable:!(Y=EZ($,J))||Y.enumerable}));return C$.set($,Z),Z};var kZ=($,Z)=>{for(var Y in Z)U$($,Y,{get:Z[Y],enumerable:!0,configurable:!0,set:(J)=>Z[Y]=()=>J})};var cZ={};kZ(cZ,{initSpruceX:()=>l,SpruceX:()=>BZ});var S="sx-data",d="sx-text",s="sx-html",Q$="sx-show",i="sx-bind:",n="sx-on:",V$="sx-model",o="sx-model.",q$="sx-class",x$="sx-toggle",w="sx-error-fallback",u="sx-for",r="sx-memo",T="sx-page",W$="sx-boost",G$="sx-boost-on",A$=["get","post","put","delete"],f$="sx-trigger",R$="sx-trigger-debounce",E$="sx-target",y$="sx-swap",T$="sx-vars",k$="sx-json-into",h$="sx-optimistic",b$="sx-revert-on-error",m$="sx-poll",g$="sx-poll-while",p$="sx-include",u$="sx-body",v$="sx-body-type",c$="sx-headers",d$="sx-loading-into",s$="sx-error-into",i$="sx-disable-while-request",n$="sx-text-while-request",o$="sx-confirm",r$="sx-chart",t$="sx-chart-type",a$="sx-chart-options",H$="sx-gridstack",l$="sx-gridstack-options",X$="sx-gridstack-option:",e$="sx-gridstack-on-change",$Z="sx-gridstack-on-added",ZZ="sx-gridstack-on-removed",YZ="sx-gridstack-on-dragstop",zZ="sx-gridstack-on-resizestop",P$="sx-lazy",K$="sx-local",I="sx-animate",e=new Set(["click","dblclick","mousedown","mouseup","input","change","submit","keydown","keyup","keypress","focusin","focusout"]);var k=($,Z)=>{if(Z($)===!1)return;let Y=$.firstElementChild;while(Y){let J=Y.nextElementSibling;k(Y,Z),Y=J}};function JZ($){return typeof $==="function"&&/^class\s/.test($.toString())}function O$($){let Z=$.match(/^\s*(.*?)\s+(in|of)\s+(.*)\s*$/);if(!Z)return null;let Y=Z[1].trim(),J=Z[3].trim();if(Y.startsWith("(")){let z=Y.slice(1,-1),[U,Q]=z.split(",").map((V)=>V.trim());return{item:U,index:Q,iterable:J}}return{item:Y,index:null,iterable:J}}function UZ($){let Z=document.createDocumentFragment(),Y=$.firstChild;while(Y)Z.appendChild(Y.cloneNode(!0)),Y=Y.nextSibling;return Z}function h($,Z,Y=new WeakSet){if($===null||typeof $!=="object")return $;if(Y.has($))return $;if(Y.add($),Array.isArray($))["push","pop","shift","unshift","splice","sort","reverse"].forEach((U)=>{let Q=$[U];if(typeof Q==="function")$[U]=function(...V){let q=Q.apply(this,V);return Z(),q}}),$.forEach((U,Q)=>{if(U&&typeof U==="object")$[Q]=h(U,Z,Y)});else Object.keys($).forEach((z)=>{if($[z]&&typeof $[z]==="object")$[z]=h($[z],Z,Y)});return new Proxy($,{get(z,U,Q){let V=Reflect.get(z,U,Q);if(typeof V==="function"&&!JZ(V))return V.bind(Q);return V},set(z,U,Q,V){let q=z[U];if(Q&&typeof Q==="object")Q=h(Q,Z,new WeakSet);let P=Reflect.set(z,U,Q,V);if(q!==Q)Z(U,Q,q);return P},deleteProperty(z,U){let Q=Reflect.deleteProperty(z,U);return Z(),Q}})}function QZ($,Z){let Y=$.watch||{};if(Y&&typeof Y==="object")delete $.watch;let z=h($,(U,Q,V)=>{if(Z(U,Q,V),Y&&typeof Y[U]==="function")try{Y[U].call(z,Q,V)}catch(q){console.error("SpruceX watcher error on",U,q)}});return{proxy:z,watchers:Y}}var b=Object.create(null),x=Object.create(null);function v($){return b[$]}function VZ($,Z,Y={}){if(!b[$]){let J=Z||{};if(Y.persist)try{let Q=localStorage.getItem(`sprucex-store-${$}`);if(Q)Object.assign(J,JSON.parse(Q))}catch(Q){console.error(`SpruceX store "${$}" load error:`,Q)}let z=new Set;x[$]=z;let U=()=>{if(Y.persist)try{localStorage.setItem(`sprucex-store-${$}`,JSON.stringify(b[$]))}catch(Q){console.error(`SpruceX store "${$}" save error:`,Q)}z.forEach((Q)=>Q.scheduleUpdate())};b[$]=h(J,U)}return b[$]}var t=null,D$=!1;function $$(){if(D$)return t;if(D$=!0,window.autoAnimate)t=window.autoAnimate;else if(window.AutoAnimate?.default)t=window.AutoAnimate.default;return t}function qZ($){t=$,D$=!0}var WZ=new Map,GZ=new Map;function L$($,Z,Y={}){let J=Z.locals||{},z=Object.keys(Y),U=$+"|"+z.join(","),Q=WZ.get(U);if(!Q)try{Q=new Function("$state","$event","$refs","$emit","$store","$locals",...z,`with($state){ with($locals){ return (${$}); } }`),WZ.set(U,Q)}catch(V){if(Z.debug)console.error("SpruceX expression compile error:",$,V);throw V}try{return Q(Z.state,Z.lastEvent||null,Z.refs,Z.emit,v,J,...Object.values(Y))}catch(V){if(Z.debug)console.error("SpruceX expression error:",$,V);throw V}}function _($,Z,Y){try{return L$($,Z)}catch(J){if(Y)try{return L$(Y,Z)}catch(z){console.error("SpruceX fallback expression error:",Y,z)}return}}function A($,Z,Y={}){let J=Z.locals||{},z=Object.keys(Y),U=$+"|"+z.join(","),Q=GZ.get(U);if(!Q)try{Q=new Function("$state","$event","$refs","$emit","$store","$locals",...z,`with($state){ with($locals){ ${$} } }`),GZ.set(U,Q)}catch(V){console.error("SpruceX statement compile error:",$,V);return}try{Q(Z.state,Z.lastEvent||null,Z.refs,Z.emit,v,J,...Object.values(Y))}catch(V){console.error("SpruceX statement error:",$,V)}}function c($,Z){let Y=new Map;Z.querySelectorAll("[id]").forEach((J)=>{Y.set(J.id,J)}),Y.forEach((J,z)=>{let U=$.querySelector(`#${CSS.escape(z)}`);if(U)HZ(U,J),J.__morphed=!0}),j$($,Z)}function HZ($,Z){if($===Z)return;if($.isEqualNode(Z))return;if($.tagName!==Z.tagName){$.replaceWith(Z.cloneNode(!0));return}if(hZ($,Z),$.tagName==="INPUT"||$.tagName==="TEXTAREA"){if($.value!==Z.value)$.value=Z.value;if($.checked!==Z.checked)$.checked=Z.checked;return}if($.tagName==="SELECT"){if(j$($,Z),$.value!==Z.value)$.value=Z.value;return}if($.hasAttribute("sx-preserve"))return;j$($,Z)}function j$($,Z){let Y=Array.from($.childNodes),J=Array.from(Z.childNodes),z=new Map,U=new Map;Y.forEach((V,q)=>{if(V.nodeType===1){let P=V.getAttribute?.("sx-key")||V.getAttribute?.("key");if(P)z.set(P,{el:V,index:q});let O=V.id;if(O)U.set(O,{el:V,index:q})}});let Q=0;for(let V=0;V<J.length;V++){let q=J[V];if(q.nodeType===3||q.nodeType===8){let P=Y[Q];if(P&&P.nodeType===q.nodeType){if(P.nodeValue!==q.nodeValue)P.nodeValue=q.nodeValue;Q++}else{let O=q.cloneNode(!0);if(P)$.insertBefore(O,P);else $.appendChild(O)}continue}if(q.nodeType===1){if(q.__morphed){delete q.__morphed,Q++;continue}let P=q.getAttribute?.("sx-key")||q.getAttribute?.("key"),O=q.id,D=null;if(P&&z.has(P))D=z.get(P).el,z.delete(P);else if(O&&U.has(O))D=U.get(O).el,U.delete(O);else{let K=Y[Q];if(K?.nodeType===1&&K.tagName===q.tagName){if(!(K.getAttribute?.("sx-key")||K.getAttribute?.("key")))D=K}}if(D){HZ(D,q);let K=Array.from($.childNodes).indexOf(D),j=V;if(K!==j&&K!==-1){let G=$.childNodes[j];if(G&&G!==D)$.insertBefore(D,G)}Q++}else{let K=q.cloneNode(!0),j=Y[Q];if(j)$.insertBefore(K,j);else $.appendChild(K)}}}while($.childNodes.length>J.length){let V=$.childNodes[J.length];if(V){if(V.__sprucex)V.__sprucex.destroy();if(V.nodeType===1)V.querySelectorAll?.(`[${S}]`).forEach((q)=>{if(q.__sprucex)q.__sprucex.destroy()});V.remove()}}}function hZ($,Z){let Y=Array.from($.attributes);for(let z of Y)if(!Z.hasAttribute(z.name))$.removeAttribute(z.name);let J=Array.from(Z.attributes);for(let z of J)if($.getAttribute(z.name)!==z.value)$.setAttribute(z.name,z.value)}var XZ="SPRUCEX_DATA_FACTORY_NOT_READY",B$=Object.create(null);function E($){if(!$||typeof $!=="string")return;return B$[$]}function F$($,Z){if($&&typeof $==="object"&&!Array.isArray($))return Object.entries($).forEach(([Y,J])=>{F$(Y,J)}),B$;if(typeof $!=="string"||!$.trim())return;if(arguments.length===1)return E($);return B$[$]=Z,Z}function _$($){let Z=String($||"").trim();if(!Z)return null;if(/^[A-Za-z_$][A-Za-z0-9_$]*(?:\.[A-Za-z_$][A-Za-z0-9_$]*)*$/.test(Z))return Z;let J=Z.match(/^([A-Za-z_$][A-Za-z0-9_$]*(?:\.[A-Za-z_$][A-Za-z0-9_$]*)*)\s*\(/);if(J)return J[1];return null}function PZ($){return!!_$($)}function KZ($){if(!$||typeof $!=="string")return;let Y=typeof window!=="undefined"?window:globalThis;for(let J of $.split(".")){if(Y==null)return;Y=Y[J]}return Y}function OZ($,Z=null){let Y=new Error(`SpruceX sx-data factory not ready: ${$}`);if(Y.code="SPRUCEX_DATA_FACTORY_NOT_READY",Y.rawExpr=$,Z)Y.cause=Z;return Y}class M${constructor($){this.root=$,this.bindings=[],this.memoBindings=[],this.eventHandlers=[],this.emitterHandlers=[],this.netBindings=[],this.modelBindings=[],this.chartBindings=[],this.gridBindings=[],this.forBlocks=[],this.pollTimers=[],this.debounceTimers=new Set,this.chartInstances=new Map,this.chartSnapshots=new WeakMap,this.gridInstances=new Map,this.requestUiState=new WeakMap,this.warnedMissingChart=!1,this.warnedMissingGridStack=!1,this.lastEvent=null,this.debug=!1,this.locals={},this.updatePending=!1,this.originalClasses=new WeakMap,this.animatedElements=new Map,this.refs={},this.emitter=document.createElement("div"),this.emit=(Z,Y)=>{let J=new CustomEvent(Z,{detail:Y,bubbles:!1});this.emitter.dispatchEvent(J)},this.initState(),this.collectRefs(),this.setupDelegation(),this.scan($),this.renderForBlocks(),this.applyInitialRender(),this.callHook("init"),queueMicrotask(()=>this.callHook("mounted"))}scheduleUpdate(){if(this.updatePending)return;this.updatePending=!0,this.rafId=requestAnimationFrame(()=>{this.updatePending=!1,this.rafId=null;let $=document.activeElement,Z=$&&$.tagName==="INPUT"&&!["checkbox","radio","button","submit","reset","file","color","range","hidden"].includes(($.type||"text").toLowerCase()),J=$&&(Z||$.tagName==="TEXTAREA"||$.isContentEditable)&&this.root.contains($)?$:null;this.renderForBlocks(J),this.updateBindings(),this.modelBindings.forEach((z)=>z.updateDom()),this.updateMemoBindings(),this.updateChartBindings(),this.initGridBindings()})}initState(){let $=(this.root.getAttribute(S)||"{}").trim(),Z=(V)=>{let q=v(V);if(q&&x[V])x[V].add(this);return q},Y,J=this.root.querySelector("script[sx-init-data]"),z=/^[A-Za-z_$][A-Za-z0-9_$]*$/.test($);if(J&&z)try{Y=JSON.parse(J.textContent.trim()||"{}")}catch(V){console.error("SpruceX sx-init-data JSON parse error:",V),Y={}}else{let V=_$($),q=V?E(V):void 0,P=V?KZ(V):void 0,O=q!==void 0?q:P;try{if(V&&O!==void 0){let D=$.match(/^([A-Za-z_$][A-Za-z0-9_$]*(?:\.[A-Za-z_$][A-Za-z0-9_$]*)*)\s*\(([\s\S]*)\)$/);if(!!D&&D[1]===V&&typeof O==="function"){let j=D[2].trim(),G=j?new Function("$store","$data",`return [${j}];`)(Z,E):[];Y=O.apply(this.root,G)}else if($===V&&typeof O==="function")Y=O.call(this.root);else if($===V)Y=O;else Y=new Function("$store","$data",`return (${$});`)(Z,E)}else Y=new Function("$store","$data",`return (${$});`)(Z,E)}catch(D){if((D instanceof ReferenceError||/is not defined/.test(String(D&&D.message?D.message:"")))&&PZ($))throw OZ($,D);console.error("SpruceX sx-data parse error:",$,D),Y={}}}if(typeof Y==="function")try{Y=Y.call(this.root)}catch(V){console.error("SpruceX sx-data factory execution error:",$,V),Y={}}if(Y==null||typeof Y!=="object")Y={};let U=this.root.getAttribute(K$);if(U)try{let V=localStorage.getItem(U);if(V){let q=JSON.parse(V);Object.assign(Y,q)}}catch(V){console.error("SpruceX sx-local load error:",V)}Object.defineProperty(Y,"$emit",{value:this.emit,enumerable:!1}),Object.defineProperty(Y,"$store",{value:(V)=>{let q=v(V);if(q&&x[V])x[V].add(this);return q},enumerable:!1});let{proxy:Q}=QZ(Y,()=>{if(U)try{localStorage.setItem(U,JSON.stringify(Q))}catch(V){console.error("SpruceX sx-local save error:",V)}this.scheduleUpdate()});this.state=Q}collectRefs(){this.refs={},this.root.querySelectorAll("[sx-ref]").forEach(($)=>{let Z=$.getAttribute("sx-ref");if(Z)this.refs[Z]=$})}setupDelegation(){e.forEach(($)=>{let Z=(Y)=>this.handleDelegatedEvent(Y);if(this.root.addEventListener($,Z),!this._delegatedCleanups)this._delegatedCleanups=[];this._delegatedCleanups.push(()=>this.root.removeEventListener($,Z))})}handleDelegatedEvent($){let Z=$.target,Y=!1,J=$.stopPropagation;$.stopPropagation=function(){Y=!0,J.apply(this,arguments)};while(Z&&Z.nodeType===1){if(Z.__sx_handlers&&Z.__sx_handlers[$.type])Z.__sx_handlers[$.type].forEach(({handler:z,component:U})=>{if(U!==this)return;if(!Y)z($)});if(Y)break;if(Z===this.root)break;Z=Z.parentNode}}scan($){let Z=this;k($,(Y)=>{if(Y!==$&&Y.hasAttribute(S))return!1;if(Y.tagName==="TEMPLATE"&&Y.hasAttribute(u)){let J=Y.getAttribute(u)||"",z=Y.parentElement;if(!z)return;let U=document.createComment("sx-for");z.insertBefore(U,Y),Y.remove();let Q=O$(J);if(!Q){console.error("SpruceX invalid sx-for expression:",J);return}if(Z.forBlocks.push({template:Y,parent:z,marker:U,expr:J,def:Q,instances:[],autoAnimate:z.hasAttribute(I)}),z.hasAttribute(I)){let V=z.getAttribute(I),q={};if(V&&V!=="true"&&V!=="")try{q=JSON.parse(V)}catch(P){let O=parseInt(V,10);if(!isNaN(O))q={duration:O}}Z.setupAutoAnimate(z,q)}}}),k($,(Y)=>{if(Y.nodeType!==1)return;if(Y!==$&&Y.hasAttribute(S))return!1;if(Y.tagName==="TEMPLATE"&&Y.hasAttribute(u))return;this.scanElement(Y,null)}),this.setupNetworkBindings()}scanElement($,Z){let Y=this,J=$.hasAttribute(r),z=$.getAttribute(d);if(z&&!J)Y.bindings.push({el:$,type:"text",expr:z,errorFallback:$.getAttribute(w),locals:Z});let U=$.getAttribute(s);if(U&&!J)Y.bindings.push({el:$,type:"html",expr:U,errorFallback:$.getAttribute(w),locals:Z});let Q=$.getAttribute(Q$);if(Q)Y.bindings.push({el:$,type:"show",expr:Q,errorFallback:$.getAttribute(w),locals:Z});let V=$.getAttribute(q$);if(V){if(!Y.originalClasses.has($))Y.originalClasses.set($,new Set(Array.from($.classList)));Y.bindings.push({el:$,type:"class",expr:V,errorFallback:$.getAttribute(w),locals:Z})}let q=$.getAttribute(x$);if(q){let K=()=>{this.state[q]=!this.state[q]};$.addEventListener("click",K),Y.eventHandlers.push({el:$,event:"click",handler:K})}for(let K of Array.from($.attributes))if(K.name.startsWith(i)){let j=K.name.slice(i.length);Y.bindings.push({el:$,type:"bind",attr:j,expr:K.value,errorFallback:$.getAttribute(w),locals:Z})}let P=$.getAttribute(r),O=$.getAttribute(d),D=$.getAttribute(s);if(P&&(O||D)){let K=[];try{let G=new Function(`return (${P});`)();if(Array.isArray(G))K=G}catch(j){console.error("SpruceX sx-memo parse error:",P,j)}Y.memoBindings.push({el:$,expr:O||D,type:O?"text":"html",deps:K,lastVals:null,lastResult:null,locals:Z})}this.setupModelBinding($,Z);for(let K of Array.from($.attributes))if(K.name.startsWith(n)){let j=K.name.slice(n.length),[G,...L]=j.split("."),X=K.value,W=(H)=>{if(L.includes("prevent"))H.preventDefault();if(L.includes("stop"))H.stopPropagation();if(L.includes("self")&&H.target!==H.currentTarget)return;if(L.includes("window")&&H.target!==window)return;if(L.includes("document")&&H.target!==document)return;if(H instanceof KeyboardEvent){let B=L.filter((M)=>!["prevent","stop","self","window","document"].includes(M));if(B.length>0){let M=H.key.toLowerCase();if(!B.includes(M))return}}this.lastEvent=H;let F=this.locals;if(Z)this.locals=Z;A(X,this),this.locals=F};if(e.has(G)){if(!$.__sx_handlers)$.__sx_handlers={};if(!$.__sx_handlers[G])$.__sx_handlers[G]=[];$.__sx_handlers[G].push({handler:W,component:this})}else $.addEventListener(G,W),Y.eventHandlers.push({el:$,event:G,handler:W})}if(!Z){for(let j of A$){let G=`sx-${j}`,L=$.getAttribute(G);if(L){let X=$.getAttribute(f$)||($.tagName==="FORM"?"submit":"click"),W=$.getAttribute(R$),H=$.getAttribute(E$)||null,F=$.getAttribute(y$)||"innerHTML",B=$.getAttribute(T$),M=$.getAttribute(k$),N=$.getAttribute(h$),C=$.getAttribute(b$),g=$.getAttribute(m$),f=$.getAttribute(g$),J$=$.getAttribute(p$),p=$.getAttribute(u$),R=$.getAttribute(v$),NZ=$.getAttribute(c$),wZ=$.getAttribute(d$),IZ=$.getAttribute(s$),CZ=$.hasAttribute(i$),xZ=$.getAttribute(n$),AZ=$.getAttribute(o$),fZ={el:$,method:j.toUpperCase(),urlTpl:L,trigger:X,triggerDebounce:W,target:H,swap:F,varsExpr:B,jsonInto:M,optimistic:N,revertOnError:C,poll:g?Number(g):null,pollWhile:f,includeSelector:J$,bodyExpr:p,bodyType:R,headersExpr:NZ,loadingInto:wZ,errorInto:IZ,disableWhileRequest:CZ,textWhileRequest:xZ,confirmExpr:AZ};Y.netBindings.push(fZ)}}let K=$.getAttribute(r$);if(K)Y.chartBindings.push({el:$,chartExpr:K,chartTypeExpr:$.getAttribute(t$),chartOptionsExpr:$.getAttribute(a$)});if($.hasAttribute(H$))Y.gridBindings.push({el:$,gridExpr:$.getAttribute(H$),gridOptionsExpr:$.getAttribute(l$),onChangeInto:$.getAttribute(e$),onAddedInto:$.getAttribute($Z),onRemovedInto:$.getAttribute(ZZ),onDragstopInto:$.getAttribute(YZ),onResizestopInto:$.getAttribute(zZ)})}if($.hasAttribute(I)){let K=$.getAttribute(I);queueMicrotask(()=>this.setupAutoAnimate($,K||{}))}}setupModelBinding($,Z=null){let Y=$.getAttribute(V$),J=Array.from($.attributes).filter((X)=>X.name.startsWith(o));if(!Y&&J.length===0)return;let z=Y||J[0].value,U=new Set,Q=null;J.forEach((X)=>{let W=X.name.slice(o.length);if(W.startsWith("debounce-ms"))Q=Number(X.value||"200");else U.add(W)});let V=($.type||"").toLowerCase(),q=V==="checkbox",P=V==="radio",O=$.tagName==="SELECT",D=()=>{let X=this.locals;if(Z)this.locals=Z;try{let W=_(z,this);if(q)if(Array.isArray(W))$.checked=W.includes($.value);else $.checked=!!W;else if(P)$.checked=String(W)===String($.value);else if(O)$.value=W??"";else if(W!==null&&W!==void 0&&typeof W==="object")$.value=JSON.stringify(W);else $.value=W??""}finally{this.locals=X}},K=(X)=>{if(U.has("trim")&&typeof X==="string")X=X.trim();if(U.has("number")){let W=Number(X);if(!Number.isNaN(W))X=W}return X},j=()=>{let X=this.locals;if(Z)this.locals=Z;try{let W;if(q){let H=_(z,this);if(Array.isArray(H)){let F=[...H],B=F.indexOf($.value);if($.checked&&B===-1)F.push($.value);if(!$.checked&&B!==-1)F.splice(B,1);W=F}else W=$.checked}else if(P){if(!$.checked)return;W=$.value}else if(O)W=$.value;else W=$.value;W=K(W),A(`${z} = value`,this,{value:W})}finally{this.locals=X}},G="input";if(U.has("lazy"))G="change";let L=j;if(Q!=null&&Q>0){let X=null;L=()=>{clearTimeout(X),X=setTimeout(j,Q)}}$.addEventListener(G,L),this.eventHandlers.push({el:$,event:G,handler:L}),this.modelBindings.push({updateDom:D,locals:Z})}setupNetworkBindings(){for(let $ of this.netBindings){let{el:Z,poll:Y,pollWhile:J}=$,z=this.parseNetworkTriggers($),U=(Q=null)=>{if(Q){if(this.lastEvent=Q,Q.type==="submit")Q.preventDefault()}if(!this.confirmRequest($))return;this.performRequest($)};if(z.forEach(({eventName:Q,debounceMs:V})=>{if(Q==="load"){queueMicrotask(()=>U());return}let q=this.wrapDebounced(U,V);Z.addEventListener(Q,q),this.eventHandlers.push({el:Z,event:Q,handler:q});let P=this.wrapDebounced(()=>this.performRequest($),V);this.emitter.addEventListener(Q,P),this.emitterHandlers.push({event:Q,handler:P})}),Y&&!Number.isNaN(Y)&&Y>0){let Q=setInterval(()=>{if(J){if(!_(J,this))return}this.performRequest($)},Y);this.pollTimers.push(Q)}}}parseNetworkTriggers($){let Z=Number($.triggerDebounce),Y=Number.isFinite(Z)&&Z>0?Z:null,J=($.trigger||"").trim(),z=$.el.tagName==="FORM"?"submit":"click",U=(J||z).split(",").flatMap((Q)=>Q.trim().split(/\s+/)).filter(Boolean);if(!U.length)return[{eventName:z,debounceMs:Y}];return U.map((Q)=>{let V=Q.split("."),q=V[0]||z,P=Y,O=V.indexOf("debounce");if(O!==-1){let D=Number(V[O+1]);if(Number.isFinite(D)&&D>0)P=D}return{eventName:q,debounceMs:P}})}wrapDebounced($,Z){if(!Z||Z<=0)return $;let Y=null;return(...J)=>{if(Y)clearTimeout(Y),this.debounceTimers.delete(Y);Y=setTimeout(()=>{this.debounceTimers.delete(Y),Y=null,$(...J)},Z),this.debounceTimers.add(Y)}}confirmRequest($){if($.confirmExpr==null)return!0;if(typeof window==="undefined"||typeof window.confirm!=="function")return!0;let Z=String($.confirmExpr).trim(),Y=Z||"Are you sure?";if(Z){let J=_(Z,this);if(typeof J==="string")Y=J;else if(J!==void 0&&J!==null)Y=String(J)}return window.confirm(Y)}setupAutoAnimate($,Z={}){let Y=$$();if(!Y)return null;if(typeof Z==="string"&&Z.trim())try{Z=new Function(`return (${Z})`)()}catch(U){console.error("SpruceX sx-animate options parse error:",U),Z={}}let z={...{duration:250,easing:"ease-in-out"},...Z};try{let U=Y($,z);return this.animatedElements.set($,U),U}catch(U){return console.error("SpruceX auto-animate error:",U),null}}disableAutoAnimate($){let Z=this.animatedElements.get($);if(Z&&typeof Z==="function")Z.disable?.();this.animatedElements.delete($)}buildUrl($){let{urlTpl:Z,varsExpr:Y}=$;if(!Y)return Z;let J=_(Y,this)||{};try{return new Function("vars","with(vars){ return `"+Z+"`; }")(J)}catch(z){return console.error("SpruceX url template error:",Z,z),Z}}buildBody($){let{el:Z,method:Y,includeSelector:J,bodyExpr:z,bodyType:U}=$;if(!["POST","PUT","DELETE"].includes(Y))return{body:null,bodyKind:null};if(z){let Q=this.evaluateExpressionOrLiteral(z),V=this.resolveBodyType(U,Q);if(V==="json")return{body:typeof Q==="string"?Q:JSON.stringify(Q??{}),bodyKind:"json"};if(V==="form"){let q=this.toFormData(Q);if(q instanceof FormData&&J)this.appendIncludeData(q,J);return{body:q,bodyKind:"form"}}return{body:Q??null,bodyKind:null}}if(Z.tagName==="FORM"){let Q=new FormData(Z);if(J)this.appendIncludeData(Q,J);if((U||"").toLowerCase()==="json")return{body:JSON.stringify(this.formDataToJson(Q)),bodyKind:"json"};return{body:Q,bodyKind:"form"}}return{body:null,bodyKind:null}}resolveBodyType($,Z){let Y=($||"").toLowerCase();if(Y==="json"||Y==="form")return Y;if(Z instanceof FormData||Z instanceof URLSearchParams)return"form";if(Z&&typeof Z==="object"&&!(Z instanceof Blob)&&!(Z instanceof ArrayBuffer))return"json";return null}toFormData($){if($ instanceof FormData)return $;if($ instanceof URLSearchParams){let Y=new FormData;return $.forEach((J,z)=>Y.append(z,J)),Y}let Z=new FormData;if($==null)return Z;if(typeof $==="string"){let Y=new URLSearchParams($),J=!1;if(Y.forEach((z,U)=>{Z.append(U,z),J=!0}),!J)Z.append("value",$);return Z}if(typeof $!=="object")return Z.append("value",String($)),Z;return Object.entries($).forEach(([Y,J])=>{this.appendFormValue(Z,Y,J)}),Z}appendFormValue($,Z,Y){if(Array.isArray(Y)){Y.forEach((J)=>this.appendFormValue($,Z,J));return}if(Y instanceof Blob){$.append(Z,Y);return}if(Y&&typeof Y==="object"){$.append(Z,JSON.stringify(Y));return}$.append(Z,Y==null?"":String(Y))}appendIncludeData($,Z){document.querySelectorAll(Z).forEach((Y)=>{if(Y.tagName==="FORM"){new FormData(Y).forEach((J,z)=>$.append(z,J));return}if(this.appendElementValue($,Y),Y.querySelectorAll)Y.querySelectorAll("input[name], select[name], textarea[name]").forEach((J)=>this.appendElementValue($,J))})}appendElementValue($,Z){if(!("name"in Z)||!Z.name)return;if("disabled"in Z&&Z.disabled)return;let Y=(Z.type||"").toLowerCase();if((Y==="checkbox"||Y==="radio")&&!Z.checked)return;if(Z.tagName==="SELECT"&&Z.multiple){Array.from(Z.selectedOptions||[]).forEach((J)=>$.append(Z.name,J.value));return}$.append(Z.name,Z.value??"")}formDataToJson($){let Z={};return $.forEach((Y,J)=>{let z=Y instanceof File?Y.name:Y;if(J in Z)if(Array.isArray(Z[J]))Z[J].push(z);else Z[J]=[Z[J],z];else Z[J]=z}),Z}buildHeaders($,Z,Y){let J=new Headers,z=$.headersExpr?_($.headersExpr,this):void 0;if(z instanceof Headers)z.forEach((U,Q)=>J.set(Q,U));else if(Array.isArray(z))z.forEach((U)=>{if(Array.isArray(U)&&U.length>=2)J.set(String(U[0]),String(U[1]))});else if(z&&typeof z==="object")Object.entries(z).forEach(([U,Q])=>{if(Q!=null)J.set(U,String(Q))});if(Z==="json"&&Y&&!J.has("Content-Type"))J.set("Content-Type","application/json");return J}evaluateExpressionOrLiteral($){let Z=String($??"").trim();if(!Z)return"";let Y=_(Z,this);return Y===void 0?Z:Y}assignStateValue($,Z){if(!$)return;A(`${$} = __sx_value`,this,{__sx_value:Z})}serializeError($){if(!$)return null;if(typeof $==="string")return{message:$};return{name:$.name||"Error",message:$.message||String($),status:$.status}}beginRequestUiState($){let{el:Z,disableWhileRequest:Y,textWhileRequest:J}=$;if(!Y&&J==null)return()=>{};let z=this.requestUiState.get(Z)||{count:0,restoreFns:[]};if(z.count===0)z.restoreFns=this.applyRequestUiState($);return z.count+=1,this.requestUiState.set(Z,z),()=>{let U=this.requestUiState.get(Z);if(!U)return;if(U.count-=1,U.count<=0)U.restoreFns.forEach((Q)=>Q()),this.requestUiState.delete(Z);else this.requestUiState.set(Z,U)}}applyRequestUiState($){let Z=[],{el:Y,disableWhileRequest:J,textWhileRequest:z}=$;if(J)this.getDisableTargets(Y).forEach((U)=>{let Q=!!U.disabled;U.disabled=!0,Z.push(()=>{U.disabled=Q})});if(z!=null){let U=this.getTextWhileRequestTarget(Y);if(U){let Q=String(this.evaluateExpressionOrLiteral(z));if(U.tagName==="INPUT"){let V=U.value;U.value=Q,Z.push(()=>{U.value=V})}else{let V=U.textContent;U.textContent=Q,Z.push(()=>{U.textContent=V})}}}return Z}getDisableTargets($){if($.tagName==="FORM")return Array.from($.elements||[]).filter((Z)=>Z&&("disabled"in Z)&&Z.type!=="hidden");return"disabled"in $?[$]:[]}getTextWhileRequestTarget($){if($.tagName!=="FORM")return $;return $.querySelector("button[type='submit']")||$.querySelector("button:not([type])")||$.querySelector("input[type='submit']")}clearDebounceTimers(){this.debounceTimers.forEach(($)=>clearTimeout($)),this.debounceTimers.clear()}clearEmitterHandlers(){this.emitterHandlers.forEach(({event:$,handler:Z})=>{this.emitter.removeEventListener($,Z)}),this.emitterHandlers=[]}async performRequest($){let Z=this.buildUrl($),{body:Y,bodyKind:J}=this.buildBody($),z=this.buildHeaders($,J,Y!=null),{el:U,method:Q,target:V,swap:q,jsonInto:P,optimistic:O,revertOnError:D,loadingInto:K,errorInto:j}=$,G=this.beginRequestUiState($);if(this.assignStateValue(K,!0),this.assignStateValue(j,null),O)A(O,this);try{let L={method:Q};if(Y!=null)L.body=Y;if(Array.from(z.keys()).length>0)L.headers=z;let X=await fetch(Z,L);if(!X.ok)throw new Error(`HTTP ${X.status}: ${X.statusText}`);let W=await X.text(),H=null;if(P&&W.trim().length)try{H=JSON.parse(W)}catch(B){console.error("SpruceX JSON parse error:",B)}if(P&&H!=null)A(`${P} = value`,this,{value:H});else this.applySwap(V||U,W,q);let F={response:X,text:W,json:H};U.dispatchEvent(new CustomEvent("success",{detail:F,bubbles:!0})),U.dispatchEvent(new CustomEvent("sprucex:success",{detail:F,bubbles:!0}))}catch(L){if(D)A(D,this);this.assignStateValue(j,this.serializeError(L));let X={error:L};U.dispatchEvent(new CustomEvent("error",{detail:X,bubbles:!0})),U.dispatchEvent(new CustomEvent("sprucex:error",{detail:X,bubbles:!0}))}finally{this.assignStateValue(K,!1),G()}}getChartConstructor(){if(typeof window==="undefined")return null;let $=window.Chart;return $&&typeof $==="object"?$.Chart||$:$}updateChartBindings(){this.chartBindings.forEach(($)=>this.syncChartBinding($))}syncChartBinding($){let{el:Z,chartExpr:Y,chartTypeExpr:J,chartOptionsExpr:z}=$;if(!Z.isConnected){this.destroyChartInstance(Z);return}let U=_(Y,this);if(U==null){this.destroyChartInstance(Z);return}let Q=this.getChartConstructor();if(!Q){if(!this.warnedMissingChart)this.warnedMissingChart=!0,console.warn("SpruceX: sx-chart requires Chart.js to be loaded on window.Chart.");return}let q=this.getChartCanvas(Z)?.getContext?.("2d");if(!q)return;let P=J!=null?this.evaluateExpressionOrLiteral(J):null,O=z!=null?this.evaluateExpressionOrLiteral(z):null,D=U&&typeof U==="object"&&"data"in U?U.data:U,K=typeof P==="string"&&P.trim()||(U&&typeof U==="object"?U.type:null)||"line",j=O&&typeof O==="object"?O:U&&typeof U==="object"&&U.options&&typeof U.options==="object"?U.options:{},G=this.cloneChartConfigValue(D),L=this.cloneChartConfigValue(j),X=this.chartInstances.get(Z);if(X&&X.config?.type!==K)X.destroy(),this.chartInstances.delete(Z),X=null;if(!X){X=new Q(q,{type:K,data:G,options:L}),this.chartInstances.set(Z,X),this.chartSnapshots.set(Z,{type:K,data:G,options:L});return}let W=this.chartSnapshots.get(Z),H={type:K,data:G,options:L};if(W&&this.areChartValuesEqual(W,H))return;X.data=G,X.options=L,X.update(),this.chartSnapshots.set(Z,H)}cloneChartConfigValue($,Z=new WeakMap){if($==null||typeof $!=="object")return $;if(Z.has($))return Z.get($);if(Array.isArray($)){let z=[];return Z.set($,z),$.forEach((U)=>z.push(this.cloneChartConfigValue(U,Z))),z}let Y=Object.getPrototypeOf($);if(Y!==Object.prototype&&Y!==null)return $;let J={};return Z.set($,J),Object.keys($).forEach((z)=>{J[z]=this.cloneChartConfigValue($[z],Z)}),J}areChartValuesEqual($,Z,Y=new WeakMap){if(Object.is($,Z))return!0;if(typeof $!==typeof Z)return!1;if($==null||Z==null)return!1;if(typeof $!=="object")return!1;let J=Y.get($);if(J&&J.has(Z))return!0;if(J)J.add(Z);else Y.set($,new WeakSet([Z]));if(Array.isArray($)){if(!Array.isArray(Z)||$.length!==Z.length)return!1;for(let q=0;q<$.length;q+=1)if(!this.areChartValuesEqual($[q],Z[q],Y))return!1;return!0}if(Array.isArray(Z))return!1;let z=Object.getPrototypeOf($),U=Object.getPrototypeOf(Z);if(z!==U)return!1;if(z!==Object.prototype&&z!==null)return!1;let Q=Object.keys($),V=Object.keys(Z);if(Q.length!==V.length)return!1;for(let q=0;q<Q.length;q+=1){let P=Q[q];if(!Object.prototype.hasOwnProperty.call(Z,P))return!1;if(!this.areChartValuesEqual($[P],Z[P],Y))return!1}return!0}getChartCanvas($){if($.tagName==="CANVAS")return $;let Z=$.querySelector("canvas");if(Z)return Z;let Y=document.createElement("canvas");return $.appendChild(Y),Y}destroyChartInstance($){let Z=this.chartInstances.get($);if(!Z)return;try{Z.destroy()}catch(Y){console.error("SpruceX sx-chart destroy error:",Y)}this.chartInstances.delete($),this.chartSnapshots.delete($)}teardownChartBindings(){this.chartInstances.forEach(($,Z)=>this.destroyChartInstance(Z)),this.chartInstances.clear()}initGridBindings(){this.gridBindings.forEach(($)=>{let{el:Z}=$;if(!Z.isConnected||this.gridInstances.has(Z))return;if(typeof window==="undefined"||!window.GridStack||typeof window.GridStack.init!=="function"){if(!this.warnedMissingGridStack)this.warnedMissingGridStack=!0,console.warn("SpruceX: sx-gridstack requires GridStack on window.GridStack.");return}let Y=this.buildGridOptions($),J=window.GridStack.init(Y,Z),z=[],U=(Q,V)=>{if(!V)return;let q=(P,O=[])=>{let D=this.serializeGridNodes(O);this.assignStateValue(V,D),Z.dispatchEvent(new CustomEvent(`sprucex:gridstack:${Q}`,{detail:D,bubbles:!0}))};J.on(Q,q),z.push(()=>{if(typeof J.off==="function")J.off(Q,q)})};U("change",$.onChangeInto),U("added",$.onAddedInto),U("removed",$.onRemovedInto),U("dragstop",$.onDragstopInto),U("resizestop",$.onResizestopInto),this.gridInstances.set(Z,{grid:J,cleanups:z})})}buildGridOptions($){let Z={},{el:Y,gridExpr:J,gridOptionsExpr:z}=$;if(J&&J.trim()&&J.trim()!=="true"){let U=_(J,this);if(U&&typeof U==="object"&&!Array.isArray(U))Object.assign(Z,U)}if(z){let U=_(z,this);if(U&&typeof U==="object"&&!Array.isArray(U))Object.assign(Z,U)}return Array.from(Y.attributes).filter((U)=>U.name.startsWith(X$)).forEach((U)=>{let Q=U.name.slice(X$.length);if(!Q)return;let V=Q.replace(/-([a-z])/g,(q,P)=>P.toUpperCase());Z[V]=this.parseGridOptionValue(U.value)}),Z}parseGridOptionValue($){let Z=String($||"").trim();if(!Z)return!0;if(Z==="true")return!0;if(Z==="false")return!1;let Y=Number(Z);if(Number.isFinite(Y))return Y;let J=_(Z,this);return J===void 0?Z:J}serializeGridNodes($){if(!Array.isArray($))return[];return $.map((Z)=>({id:Z?.id??Z?.el?.id??null,x:Z?.x,y:Z?.y,w:Z?.w,h:Z?.h,minW:Z?.minW,minH:Z?.minH,maxW:Z?.maxW,maxH:Z?.maxH}))}teardownGridBindings(){this.gridInstances.forEach(({grid:$,cleanups:Z})=>{if(Z.forEach((Y)=>Y()),$&&typeof $.destroy==="function")$.destroy(!1)}),this.gridInstances.clear()}applySwap($,Z,Y){let J=typeof $==="string"?document.querySelector($):$;if(!J)return;switch(Y){case"outerHTML":J.outerHTML=Z;break;case"before":J.insertAdjacentHTML("beforebegin",Z);break;case"after":J.insertAdjacentHTML("afterend",Z);break;case"prepend":J.insertAdjacentHTML("afterbegin",Z);break;case"append":J.insertAdjacentHTML("beforeend",Z);break;case"morph":{let Q=new DOMParser().parseFromString(`<div>${Z}</div>`,"text/html").body.firstChild;if(Q)c(J,Q);break}case"id-map":{let Q=new DOMParser().parseFromString(`<div>${Z}</div>`,"text/html").body.firstChild;if(Q)c(J,Q);break}case"innerHTML":default:J.innerHTML=Z}}isForBlockDetached($){if(!$)return!0;let{parent:Z,marker:Y}=$;if(!Z||!Y)return!0;if(!Z.isConnected||!Y.isConnected)return!0;if(Y.parentNode!==Z)return!0;return!1}teardownForBlock($){if(!$)return;if((Array.isArray($.instances)?[...$.instances]:[]).forEach((J)=>{if(J.elements)J.elements.forEach((z)=>z.remove());else if(J.fragmentRoot)J.fragmentRoot.remove();this.cleanupInstanceBindings(J.bindings)}),$.instances)$.instances.length=0;let Y=this.forBlocks.indexOf($);if(Y!==-1)this.forBlocks.splice(Y,1)}teardownDetachedForBlocks(){this.forBlocks.slice().forEach(($)=>{if(this.isForBlockDetached($))this.teardownForBlock($)})}teardownAllForBlocks(){this.forBlocks.slice().forEach(($)=>this.teardownForBlock($)),this.forBlocks=[]}renderForBlocks($=null){this.teardownDetachedForBlocks();let Z=0;while(Z<this.forBlocks.length){let Y=this.forBlocks[Z];if(!Y){Z+=1;continue}if(this.isForBlockDetached(Y)){this.teardownForBlock(Y);continue}let{def:J,template:z,parent:U,marker:Q,instances:V,parentLocals:q}=Y;if($&&Y.instances.some((W)=>W.elements&&W.elements.some((H)=>H.contains($)))){Z+=1;continue}let O=this.locals;if(q)this.locals=q;let D=_(J.iterable,this)||[],K=Array.from(D);this.locals=O;let j=new Map;V.forEach((W)=>{let H=W.itemKey;if(H!==void 0)j.set(H,W)});let G=[],L=new Set;for(let W=0;W<K.length;W++){let H=K[W],F=J.index||"$index",B=H;if(typeof H==="object"&&H!==null)B=H;let M=j.get(B);if(M&&!L.has(B))L.add(B),M.scopeLocals[F]=W,G.push(M);else{let N=q?{...q}:{};N[J.item]=H,N[F]=W;let C=z.content?z.content.cloneNode(!0):UZ(z),g=[];while(C.firstChild){let p=C.firstChild;g.push(p),C.removeChild(p)}let f={bindings:[],memoBindings:[],modelBindings:[],eventHandlers:[],nestedForBlocks:[]};g.forEach((p)=>{let R=this.scanFragmentBindings(p,N);if(f.bindings.push(...R.bindings),f.memoBindings.push(...R.memoBindings),f.modelBindings.push(...R.modelBindings),f.eventHandlers.push(...R.eventHandlers),R.nestedForBlocks)f.nestedForBlocks.push(...R.nestedForBlocks)});let J$={scopeLocals:N,elements:g,bindings:f,itemKey:B};G.push(J$),L.add(B)}}V.forEach((W)=>{if(!L.has(W.itemKey)){if(W.elements)W.elements.forEach((H)=>H.remove());else if(W.fragmentRoot)W.fragmentRoot.remove();this.cleanupInstanceBindings(W.bindings)}});let X=Q;for(let W=G.length-1;W>=0;W--){let H=G[W];if(H.elements.forEach((F)=>{U.insertBefore(F,X)}),H.elements.length>0)X=H.elements[0]}Y.instances.length=0,Y.instances.push(...G),Z+=1}}scanFragmentBindings($,Z){let Y=this,J={bindings:[],memoBindings:[],modelBindings:[],eventHandlers:[],nestedForBlocks:[]};return k($,(z)=>{if(z.nodeType!==1)return;if(z.hasAttribute(S))return!1;if(z.tagName==="TEMPLATE"&&z.hasAttribute(u)){let G=z.getAttribute(u)||"",L=z.parentElement;if(!L)return;let X=document.createComment("sx-for");L.insertBefore(X,z),z.remove();let W=O$(G);if(!W)return console.error("SpruceX invalid nested sx-for expression:",G),!1;let H={template:z,parent:L,marker:X,expr:G,def:W,instances:[],parentLocals:Z,autoAnimate:L.hasAttribute(I)};if(Y.forBlocks.push(H),J.nestedForBlocks.push(H),L.hasAttribute(I)){let F=L.getAttribute(I),B={};if(F&&F!=="true"&&F!=="")try{B=JSON.parse(F)}catch(M){let N=parseInt(F,10);if(!isNaN(N))B={duration:N}}Y.setupAutoAnimate(L,B)}return!1}let U=z.hasAttribute(r),Q=z.getAttribute(d);if(Q&&!U){let G={el:z,type:"text",expr:Q,errorFallback:z.getAttribute(w),locals:Z};Y.bindings.push(G),J.bindings.push(G)}let V=z.getAttribute(s);if(V&&!U){let G={el:z,type:"html",expr:V,errorFallback:z.getAttribute(w),locals:Z};Y.bindings.push(G),J.bindings.push(G)}let q=z.getAttribute(Q$);if(q){let G={el:z,type:"show",expr:q,errorFallback:z.getAttribute(w),locals:Z};Y.bindings.push(G),J.bindings.push(G)}let P=z.getAttribute(q$);if(P){if(!Y.originalClasses.has(z))Y.originalClasses.set(z,new Set(Array.from(z.classList)));let G={el:z,type:"class",expr:P,errorFallback:z.getAttribute(w),locals:Z};Y.bindings.push(G),J.bindings.push(G)}for(let G of Array.from(z.attributes))if(G.name.startsWith(i)){let L=G.name.slice(i.length),X={el:z,type:"bind",attr:L,expr:G.value,errorFallback:z.getAttribute(w),locals:Z};Y.bindings.push(X),J.bindings.push(X)}let O=z.getAttribute(r),D=z.getAttribute(d),K=z.getAttribute(s);if(O&&(D||K)){let G=[];try{let W=new Function(`return (${O});`)();if(Array.isArray(W))G=W}catch(X){console.error("SpruceX sx-memo parse error:",O,X)}let L={el:z,expr:D||K,type:D?"text":"html",deps:G,lastVals:null,lastResult:null,locals:Z};Y.memoBindings.push(L),J.memoBindings.push(L)}let j=this.setupModelBindingWithReturn(z,Z);if(j)J.modelBindings.push(j);for(let G of Array.from(z.attributes))if(G.name.startsWith(n)){let L=G.name.slice(n.length),[X,...W]=L.split("."),H=G.value,F=(B)=>{if(W.includes("prevent"))B.preventDefault();if(W.includes("stop"))B.stopPropagation();if(W.includes("self")&&B.target!==B.currentTarget)return;if(W.includes("window")&&B.target!==window)return;if(W.includes("document")&&B.target!==document)return;if(B instanceof KeyboardEvent){let N=W.filter((C)=>!["prevent","stop","self","window","document"].includes(C));if(N.length>0){let C=B.key.toLowerCase();if(!N.includes(C))return}}this.lastEvent=B;let M=this.locals;this.locals=Z,A(H,this),this.locals=M};if(e.has(X)){if(!z.__sx_handlers)z.__sx_handlers={};if(!z.__sx_handlers[X])z.__sx_handlers[X]=[];z.__sx_handlers[X].push({handler:F,component:this})}else z.addEventListener(X,F),Y.eventHandlers.push({el:z,event:X,handler:F}),J.eventHandlers.push({el:z,event:X,handler:F})}if(z.hasAttribute(I)){let G=z.getAttribute(I);queueMicrotask(()=>this.setupAutoAnimate(z,G||{}))}}),J}setupModelBindingWithReturn($,Z=null){let Y=$.getAttribute(V$),J=Array.from($.attributes).filter((W)=>W.name.startsWith(o));if(!Y&&J.length===0)return null;let z=Y||J[0].value,U=new Set,Q=null;J.forEach((W)=>{let H=W.name.slice(o.length);if(H.startsWith("debounce-ms"))Q=Number(W.value||"200");else U.add(H)});let V=($.type||"").toLowerCase(),q=V==="checkbox",P=V==="radio",O=$.tagName==="SELECT",D=()=>{let W=this.locals;if(Z)this.locals=Z;try{let H=_(z,this);if(q)if(Array.isArray(H))$.checked=H.includes($.value);else $.checked=!!H;else if(P)$.checked=String(H)===String($.value);else if(O)$.value=H??"";else if(H!==null&&H!==void 0&&typeof H==="object")$.value=JSON.stringify(H);else $.value=H??""}finally{this.locals=W}},K=(W)=>{if(U.has("trim")&&typeof W==="string")W=W.trim();if(U.has("number")){let H=Number(W);if(!Number.isNaN(H))W=H}return W},j=()=>{let W=this.locals;if(Z)this.locals=Z;try{let H;if(q){let F=_(z,this);if(Array.isArray(F)){let B=[...F],M=B.indexOf($.value);if($.checked&&M===-1)B.push($.value);if(!$.checked&&M!==-1)B.splice(M,1);H=B}else H=$.checked}else if(P){if(!$.checked)return;H=$.value}else if(O)H=$.value;else H=$.value;H=K(H),A(`${z} = value`,this,{value:H})}finally{this.locals=W}},G="input";if(U.has("lazy"))G="change";let L=j;if(Q!=null&&Q>0){let W=null;L=()=>{clearTimeout(W),W=setTimeout(j,Q)}}$.addEventListener(G,L);let X={updateDom:D,locals:Z,el:$,event:G,handler:L};return this.eventHandlers.push({el:$,event:G,handler:L}),this.modelBindings.push(X),X}cleanupInstanceBindings($){if(!$)return;($.bindings||[]).forEach((Z)=>{let Y=this.bindings.indexOf(Z);if(Y!==-1)this.bindings.splice(Y,1)}),($.memoBindings||[]).forEach((Z)=>{let Y=this.memoBindings.indexOf(Z);if(Y!==-1)this.memoBindings.splice(Y,1)}),($.modelBindings||[]).forEach((Z)=>{let Y=this.modelBindings.indexOf(Z);if(Y!==-1)this.modelBindings.splice(Y,1)}),($.eventHandlers||[]).forEach(({el:Z,event:Y,handler:J})=>{Z.removeEventListener(Y,J);let z=this.eventHandlers.findIndex((U)=>U.el===Z&&U.event===Y&&U.handler===J);if(z!==-1)this.eventHandlers.splice(z,1)}),$.nestedForBlocks?.forEach((Z)=>{this.teardownForBlock(Z)})}applyInitialRender(){this.updateBindings(),this.modelBindings.forEach(($)=>$.updateDom()),this.updateMemoBindings(),this.updateChartBindings(),this.initGridBindings()}updateBindings(){for(let $ of this.bindings){let{el:Z,type:Y,expr:J,attr:z,errorFallback:U,locals:Q}=$,V=this.locals;if(Q)this.locals=Q;try{switch(Y){case"text":{let q=_(J,this,U);if(q!==null&&q!==void 0&&typeof q==="object")Z.textContent=JSON.stringify(q);else Z.textContent=q??"";break}case"html":{let q=_(J,this,U);if(q!==null&&q!==void 0&&typeof q==="object")Z.innerHTML=JSON.stringify(q);else Z.innerHTML=q??"";break}case"show":{let q=!!_(J,this,U);Z.style.display=q?"":"none";break}case"bind":{let q=_(J,this,U);if(q===!1||q===null||q===void 0)Z.removeAttribute(z);else Z.setAttribute(z,q);break}case"class":{let q=_(J,this,U),P=this.originalClasses.get(Z)||new Set,O=new Set(Array.from(Z.classList));if(typeof q==="string"){let D=new Set(q.split(/\s+/).filter(Boolean));O.forEach((K)=>{if(!P.has(K))Z.classList.remove(K)}),D.forEach((K)=>Z.classList.add(K))}else if(q&&typeof q==="object")Object.keys(q).forEach((D)=>{D.split(/\s+/).filter(Boolean).forEach((K)=>{if(q[D])Z.classList.add(K);else Z.classList.remove(K)})});break}}}finally{this.locals=V}}}updateMemoBindings(){this.memoBindings.forEach(($)=>{let{el:Z,expr:Y,type:J,deps:z,locals:U}=$,Q=this.locals;if(U)this.locals=U;try{let V=z.map((P)=>{if(U&&P in U)return U[P];if(P in this.state)return this.state[P];return this.state[P]});if($.lastVals&&$.lastVals.length===V.length&&$.lastVals.every((P,O)=>P===V[O]))return;$.lastVals=V;let q=_(Y,this);if($.lastResult=q,J==="text")Z.textContent=q??"";else Z.innerHTML=q??""}finally{this.locals=Q}})}callHook($){let Z=this.state&&this.state[$];if(typeof Z==="function")try{Z.call(this.state)}catch(Y){console.error(`SpruceX ${$}() hook error:`,Y)}}refresh(){this.teardownChartBindings(),this.teardownGridBindings(),this.clearDebounceTimers(),this.clearEmitterHandlers(),this.teardownAllForBlocks(),this.bindings=[],this.memoBindings=[],this.modelBindings=[],this.netBindings=[],this.chartBindings=[],this.gridBindings=[],this.forBlocks=[],this.eventHandlers.forEach(({el:$,event:Z,handler:Y})=>{$.removeEventListener(Z,Y)}),this.eventHandlers=[],k(this.root,($)=>{if($!==this.root&&$.hasAttribute(S))return!1;if($.__sx_handlers)delete $.__sx_handlers}),this.animatedElements.forEach(($,Z)=>{this.disableAutoAnimate(Z)}),this.animatedElements.clear(),this.pollTimers.forEach(($)=>clearInterval($)),this.pollTimers=[],this.collectRefs(),this.scan(this.root),this.renderForBlocks(),this.applyInitialRender()}destroy(){if(this.callHook("destroyed"),Object.keys(x).forEach(($)=>{x[$].delete(this)}),this.animatedElements.forEach(($,Z)=>{this.disableAutoAnimate(Z)}),this.animatedElements.clear(),this.teardownChartBindings(),this.teardownGridBindings(),this.teardownAllForBlocks(),this.eventHandlers.forEach(({el:$,event:Z,handler:Y})=>{$.removeEventListener(Z,Y)}),this.clearEmitterHandlers(),this._delegatedCleanups)this._delegatedCleanups.forEach(($)=>$());if(this.pollTimers.forEach(($)=>clearInterval($)),this.clearDebounceTimers(),this.rafId)cancelAnimationFrame(this.rafId);this.bindings=[],this.memoBindings=[],this.modelBindings=[],this.eventHandlers=[],this.chartBindings=[],this.gridBindings=[],this.netBindings=[],this.forBlocks=[],this.pollTimers=[],delete this.root.__sprucex}}var z$=new Map,Z$=new Map,bZ=30000,m=new Set,S$=!1,a=null;function mZ(){if(a||m.size===0)return;a=setInterval(()=>{y()},100)}function y(){if(m.forEach(($)=>{if(!$||!$.isConnected||$.__sprucex){m.delete($);return}if(w$($))m.delete($)}),m.size===0&&a)clearInterval(a),a=null}function gZ($){if(!$||$.__sprucex)return;let Z=m.has($);if(m.add($),mZ(),Z||S$)return;S$=!0,queueMicrotask(()=>{S$=!1,y()})}var BZ={init:l,store:VZ,data($,Z){if(arguments.length===1&&typeof $==="string")return E($);let Y=F$($,Z);return y(),Y},inspect(){let $=document.querySelectorAll(`[${S}]`);return Array.from($).map((Z)=>({el:Z,state:Z.__sprucex?.state||null}))},config($){},navigate($){let Y=document.querySelector(`[${T}]`)?.getAttribute(T),J=Y?document.querySelector(Y):document.body;return I$($,J)},prefetch($){return Y$($)},clearCache(){z$.clear()},morph($,Z){if(typeof $==="string")$=document.querySelector($);if(typeof Z==="string")Z=new DOMParser().parseFromString(`<div>${Z}</div>`,"text/html").body.firstChild;if($&&Z)c($,Z)},animate($,Z={}){if(typeof $==="string")$=document.querySelector($);if(!$)return null;let Y=$$();if(!Y)return console.warn("SpruceX: auto-animate library not found. Include it via script tag or npm."),null;return Y($,Z)},setAutoAnimate:qZ};if(typeof window!=="undefined"){if(window.SpruceX=BZ,!window.SpruceXBoot)window.SpruceXBoot={}}var DZ=!1;function FZ(){if(DZ||typeof window==="undefined")return;DZ=!0;let $=window.SpruceXBoot;if($&&typeof $.initTheme==="function")try{$.initTheme()}catch(Z){console.error("SpruceX boot hook error:",Z)}}function w$($){if($.__sprucex)return $.__sprucex;try{let Z=new M$($);return $.__sprucex=Z,Z}catch(Z){if(Z&&Z.code===XZ)return gZ($),null;return console.error("SpruceX component init error:",Z),null}}function l(){FZ(),document.querySelectorAll(`[${S}]`).forEach((Y)=>{if(!Y.hasAttribute(P$))w$(Y);else{let z=new IntersectionObserver((U)=>{U.forEach((Q)=>{if(Q.isIntersecting)w$(Y),z.disconnect()})});z.observe(Y)}});let Z=document.querySelector(`[${T}]`);if(Z&&!Z.__sprucex_page)Z.__sprucex_page=!0,uZ(Z);_Z(),pZ(),y(),Array.from(document.scripts).forEach((Y)=>{Y.__sprucex_executed=!0})}var N$=null;function pZ(){if(N$)return;if(N$=new MutationObserver(($)=>{for(let Z of $)Z.removedNodes.forEach((Y)=>{if(Y.nodeType!==1)return;if(Y.__sprucex)Y.__sprucex.destroy();Y.querySelectorAll(`[${S}]`).forEach((J)=>{if(J.__sprucex)J.__sprucex.destroy()})})}),document.body)N$.observe(document.body,{childList:!0,subtree:!0})}var LZ=!1;function uZ($){let Z=$.getAttribute(T);if(Z===null)return;let Y=Z?document.querySelector(Z):document.body;if(!Y){console.error("SpruceX sx-page target not found:",Z);return}if(LZ)return;LZ=!0,document.addEventListener("click",async(J)=>{let z=J.target.closest("a[href]");if(!z)return;let U=z.getAttribute("href");if(!U||U.startsWith("#")||U.startsWith("javascript:"))return;if(z.hasAttribute("download")||z.getAttribute("target")==="_blank")return;try{let Q=new URL(U,window.location.origin);if(Q.origin!==window.location.origin)return;J.preventDefault(),await I$(Q.href,Y)}catch{return}}),window.addEventListener("popstate",async()=>{await I$(window.location.href,Y,!1)})}function _Z(){document.querySelectorAll(`[${W$}]`).forEach(($)=>{if($.__sprucex_boost)return;$.__sprucex_boost=!0;let Y=($.getAttribute(G$)||"mouseenter").split(/\s+/);if($.tagName==="A")Y.forEach((J)=>{$.addEventListener(J,()=>Y$($.href),{passive:!0,once:!0})});else Y.forEach((J)=>{$.addEventListener(J,(z)=>{let U=z.target.closest("a[href]");if(U&&!U.__sprucex_prefetched)U.__sprucex_prefetched=!0,Y$(U.href)},{passive:!0})}),$.addEventListener("focusin",(J)=>{let z=J.target.closest("a[href]");if(z&&!z.__sprucex_prefetched)z.__sprucex_prefetched=!0,Y$(z.href)},{passive:!0})})}async function I$($,Z,Y=!0){let J=performance.now(),z=new CustomEvent("sprucex:page-before",{detail:{url:$},bubbles:!0,cancelable:!0});if(!document.dispatchEvent(z))return;try{let U=SZ($);if(!U){if(Z)Z.style.opacity=Z.style.opacity||"1";U=await MZ($)}if(!U)throw new Error("Empty response");let V=new DOMParser().parseFromString(U,"text/html"),q,O=document.querySelector("[sx-page]")?.getAttribute(T);if(O)q=V.querySelector(O);if(!q)q=V.body;let D=V.querySelector("title");if(D)document.title=D.textContent;if(jZ(Z),Z&&q)c(Z,q),Z.querySelectorAll("script").forEach((G)=>{if(!G.__sprucex_executed)vZ(G)});if(Y)history.pushState({url:$},"",$);jZ(Z),l();let K=Z.parentElement;while(K){if(K.__sprucex)K.__sprucex.refresh();K=K.parentElement}_Z();let j=new URL($).hash;if(j){let G=document.querySelector(j);if(G)G.scrollIntoView()}else window.scrollTo(0,0);document.dispatchEvent(new CustomEvent("sprucex:page-after",{detail:{url:$,duration:performance.now()-J},bubbles:!0}))}catch(U){console.error("SpruceX page navigation error:",U),document.dispatchEvent(new CustomEvent("sprucex:page-error",{detail:{url:$,error:U},bubbles:!0})),window.location.href=$}}function jZ($){if(!$)return;if($.querySelectorAll(`[${S}]`).forEach((Z)=>{if(Z.__sprucex)Z.__sprucex.destroy()}),$.hasAttribute(S)&&$.__sprucex)$.__sprucex.destroy()}async function Y$($){if(!$)return;try{let Z=new URL($,window.location.origin);if(Z.origin!==window.location.origin)return;if(Z.href===window.location.href)return;await MZ(Z.href)}catch{}}async function MZ($){let Z=SZ($);if(Z)return Z;if(Z$.has($))return Z$.get($);let Y=(async()=>{try{let J=await fetch($,{headers:{"X-SpruceX-Request":"true"}});if(!J.ok)throw new Error(`HTTP ${J.status}`);let z=await J.text();return z$.set($,{html:z,timestamp:Date.now()}),z}finally{Z$.delete($)}})();return Z$.set($,Y),Y}function SZ($){let Z=z$.get($);if(!Z)return null;if(Date.now()-Z.timestamp>bZ)return z$.delete($),null;return Z.html}if(typeof document!=="undefined")if(FZ(),window.addEventListener("load",()=>{y()}),document.readyState==="loading")document.addEventListener("DOMContentLoaded",l);else l();function vZ($){if($.type&&$.type!=="text/javascript"&&$.type!=="application/javascript"&&$.type!=="module")return;let Z=document.createElement("script");if(Array.from($.attributes).forEach((Y)=>{Z.setAttribute(Y.name,Y.value)}),Z.src)Z.addEventListener("load",()=>y(),{once:!0}),Z.addEventListener("error",()=>y(),{once:!0});if(Z.textContent=$.textContent,Z.__sprucex_executed=!0,$.replaceWith(Z),!Z.src)queueMicrotask(()=>y())}})();

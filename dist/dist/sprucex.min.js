(()=>{var{defineProperty:l,getOwnPropertyNames:j1,getOwnPropertyDescriptor:B1}=Object,w1=Object.prototype.hasOwnProperty;var D$=new WeakMap,M1=($)=>{var J=D$.get($),Q;if(J)return J;if(J=l({},"__esModule",{value:!0}),$&&typeof $==="object"||typeof $==="function")j1($).map((Y)=>!w1.call(J,Y)&&l(J,Y,{get:()=>$[Y],enumerable:!(Q=B1($,Y))||Q.enumerable}));return D$.set($,J),J};var S1=($,J)=>{for(var Q in J)l($,Q,{get:J[Q],enumerable:!0,configurable:!0,set:(Y)=>J[Q]=()=>Y})};var R1={};S1(R1,{initSpruceX:()=>i,SpruceX:()=>Y1});var N="sx-data",g="sx-text",p="sx-html",e="sx-show",u="sx-bind:",v="sx-on:",$$="sx-model",c="sx-model.",J$="sx-class",L$="sx-toggle",I="sx-error-fallback",b="sx-for",d="sx-memo",E="sx-page",Q$="sx-boost",U$="sx-boost-on",O$=["get","post","put","delete"],F$="sx-trigger",j$="sx-trigger-debounce",B$="sx-target",w$="sx-swap",M$="sx-vars",S$="sx-json-into",N$="sx-optimistic",I$="sx-revert-on-error",_$="sx-poll",x$="sx-poll-while",C$="sx-include",R$="sx-body",f$="sx-body-type",A$="sx-headers",E$="sx-loading-into",k$="sx-error-into",y$="sx-disable-while-request",T$="sx-text-while-request",b$="sx-confirm",h$="sx-chart",m$="sx-chart-type",g$="sx-chart-options",Y$="sx-gridstack",p$="sx-gridstack-options",Z$="sx-gridstack-option:",u$="sx-gridstack-on-change",v$="sx-gridstack-on-added",c$="sx-gridstack-on-removed",d$="sx-gridstack-on-dragstop",s$="sx-gridstack-on-resizestop",V$="sx-lazy",z$="sx-local",_="sx-animate",o=new Set(["click","dblclick","mousedown","mouseup","input","change","submit","keydown","keyup","keypress","focusin","focusout"]);var k=($,J)=>{if(J($)===!1)return;let Q=$.firstElementChild;while(Q){let Y=Q.nextElementSibling;k(Q,J),Q=Y}};function i$($){return typeof $==="function"&&/^class\s/.test($.toString())}function q$($){let J=$.match(/^\s*(.*?)\s+(in|of)\s+(.*)\s*$/);if(!J)return null;let Q=J[1].trim(),Y=J[3].trim();if(Q.startsWith("(")){let U=Q.slice(1,-1),[Z,V]=U.split(",").map((q)=>q.trim());return{item:Z,index:V,iterable:Y}}return{item:Q,index:null,iterable:Y}}function o$($){let J=document.createDocumentFragment(),Q=$.firstChild;while(Q)J.appendChild(Q.cloneNode(!0)),Q=Q.nextSibling;return J}function y($,J,Q=new WeakSet){if($===null||typeof $!=="object")return $;if(Q.has($))return $;if(Q.add($),Array.isArray($))["push","pop","shift","unshift","splice","sort","reverse"].forEach((Z)=>{let V=$[Z];if(typeof V==="function")$[Z]=function(...q){let z=V.apply(this,q);return J(),z}}),$.forEach((Z,V)=>{if(Z&&typeof Z==="object")$[V]=y(Z,J,Q)});else Object.keys($).forEach((U)=>{if($[U]&&typeof $[U]==="object")$[U]=y($[U],J,Q)});return new Proxy($,{get(U,Z,V){let q=Reflect.get(U,Z,V);if(typeof q==="function"&&!i$(q))return q.bind(V);return q},set(U,Z,V,q){let z=U[Z];if(V&&typeof V==="object")V=y(V,J,new WeakSet);let X=Reflect.set(U,Z,V,q);if(z!==V)J(Z,V,z);return X},deleteProperty(U,Z){let V=Reflect.deleteProperty(U,Z);return J(),V}})}function n$($,J){let Q=$.watch||{};if(Q&&typeof Q==="object")delete $.watch;let U=y($,(Z,V,q)=>{if(J(Z,V,q),Q&&typeof Q[Z]==="function")try{Q[Z].call(U,V,q)}catch(z){console.error("SpruceX watcher error on",Z,z)}});return{proxy:U,watchers:Q}}var T=Object.create(null),x=Object.create(null);function h($){return T[$]}function r$($,J,Q={}){if(!T[$]){let Y=J||{};if(Q.persist)try{let V=localStorage.getItem(`sprucex-store-${$}`);if(V)Object.assign(Y,JSON.parse(V))}catch(V){console.error(`SpruceX store "${$}" load error:`,V)}let U=new Set;x[$]=U;let Z=()=>{if(Q.persist)try{localStorage.setItem(`sprucex-store-${$}`,JSON.stringify(T[$]))}catch(V){console.error(`SpruceX store "${$}" save error:`,V)}U.forEach((V)=>V.scheduleUpdate())};T[$]=y(Y,Z)}return T[$]}var s=null,W$=!1;function n(){if(W$)return s;if(W$=!0,window.autoAnimate)s=window.autoAnimate;else if(window.AutoAnimate?.default)s=window.AutoAnimate.default;return s}function t$($){s=$,W$=!0}var a$=new Map,l$=new Map;function G$($,J,Q={}){let Y=J.locals||{},U=Object.keys(Q),Z=$+"|"+U.join(","),V=a$.get(Z);if(!V)try{V=new Function("$state","$event","$refs","$emit","$store","$locals",...U,`with($state){ with($locals){ return (${$}); } }`),a$.set(Z,V)}catch(q){if(J.debug)console.error("SpruceX expression compile error:",$,q);throw q}try{return V(J.state,J.lastEvent||null,J.refs,J.emit,h,Y,...Object.values(Q))}catch(q){if(J.debug)console.error("SpruceX expression error:",$,q);throw q}}function w($,J,Q){try{return G$($,J)}catch(Y){if(Q)try{return G$(Q,J)}catch(U){console.error("SpruceX fallback expression error:",Q,U)}return}}function C($,J,Q={}){let Y=J.locals||{},U=Object.keys(Q),Z=$+"|"+U.join(","),V=l$.get(Z);if(!V)try{V=new Function("$state","$event","$refs","$emit","$store","$locals",...U,`with($state){ with($locals){ ${$} } }`),l$.set(Z,V)}catch(q){console.error("SpruceX statement compile error:",$,q);return}try{V(J.state,J.lastEvent||null,J.refs,J.emit,h,Y,...Object.values(Q))}catch(q){console.error("SpruceX statement error:",$,q)}}function m($,J){let Q=new Map;J.querySelectorAll("[id]").forEach((Y)=>{Q.set(Y.id,Y)}),Q.forEach((Y,U)=>{let Z=$.querySelector(`#${CSS.escape(U)}`);if(Z)e$(Z,Y),Y.__morphed=!0}),H$($,J)}function e$($,J){if($===J)return;if($.isEqualNode(J))return;if($.tagName!==J.tagName){$.replaceWith(J.cloneNode(!0));return}if(N1($,J),$.tagName==="INPUT"||$.tagName==="TEXTAREA"){if($.value!==J.value)$.value=J.value;if($.checked!==J.checked)$.checked=J.checked;return}if($.tagName==="SELECT"){if(H$($,J),$.value!==J.value)$.value=J.value;return}if($.hasAttribute("sx-preserve"))return;H$($,J)}function H$($,J){let Q=Array.from($.childNodes),Y=Array.from(J.childNodes),U=new Map,Z=new Map;Q.forEach((q,z)=>{if(q.nodeType===1){let X=q.getAttribute?.("sx-key")||q.getAttribute?.("key");if(X)U.set(X,{el:q,index:z});let L=q.id;if(L)Z.set(L,{el:q,index:z})}});let V=0;for(let q=0;q<Y.length;q++){let z=Y[q];if(z.nodeType===3||z.nodeType===8){let X=Q[V];if(X&&X.nodeType===z.nodeType){if(X.nodeValue!==z.nodeValue)X.nodeValue=z.nodeValue;V++}else{let L=z.cloneNode(!0);if(X)$.insertBefore(L,X);else $.appendChild(L)}continue}if(z.nodeType===1){if(z.__morphed){delete z.__morphed,V++;continue}let X=z.getAttribute?.("sx-key")||z.getAttribute?.("key"),L=z.id,O=null;if(X&&U.has(X))O=U.get(X).el,U.delete(X);else if(L&&Z.has(L))O=Z.get(L).el,Z.delete(L);else{let P=Q[V];if(P?.nodeType===1&&P.tagName===z.tagName){if(!(P.getAttribute?.("sx-key")||P.getAttribute?.("key")))O=P}}if(O){e$(O,z);let P=Array.from($.childNodes).indexOf(O),F=q;if(P!==F&&P!==-1){let W=$.childNodes[F];if(W&&W!==O)$.insertBefore(O,W)}V++}else{let P=z.cloneNode(!0),F=Q[V];if(F)$.insertBefore(P,F);else $.appendChild(P)}}}while($.childNodes.length>Y.length){let q=$.childNodes[Y.length];if(q){if(q.__sprucex)q.__sprucex.destroy();if(q.nodeType===1)q.querySelectorAll?.(`[${N}]`).forEach((z)=>{if(z.__sprucex)z.__sprucex.destroy()});q.remove()}}}function N1($,J){let Q=Array.from($.attributes);for(let U of Q)if(!J.hasAttribute(U.name))$.removeAttribute(U.name);let Y=Array.from(J.attributes);for(let U of Y)if($.getAttribute(U.name)!==U.value)$.setAttribute(U.name,U.value)}class X${constructor($){this.root=$,this.bindings=[],this.memoBindings=[],this.eventHandlers=[],this.emitterHandlers=[],this.netBindings=[],this.modelBindings=[],this.chartBindings=[],this.gridBindings=[],this.forBlocks=[],this.pollTimers=[],this.debounceTimers=new Set,this.chartInstances=new Map,this.chartSnapshots=new WeakMap,this.gridInstances=new Map,this.requestUiState=new WeakMap,this.warnedMissingChart=!1,this.warnedMissingGridStack=!1,this.lastEvent=null,this.debug=!1,this.locals={},this.updatePending=!1,this.originalClasses=new WeakMap,this.animatedElements=new Map,this.refs={},this.emitter=document.createElement("div"),this.emit=(J,Q)=>{let Y=new CustomEvent(J,{detail:Q,bubbles:!1});this.emitter.dispatchEvent(Y)},this.initState(),this.collectRefs(),this.setupDelegation(),this.scan($),this.renderForBlocks(),this.applyInitialRender(),this.callHook("init"),queueMicrotask(()=>this.callHook("mounted"))}scheduleUpdate(){if(this.updatePending)return;this.updatePending=!0,this.rafId=requestAnimationFrame(()=>{this.updatePending=!1,this.rafId=null;let $=document.activeElement;if(!($&&($.tagName==="INPUT"||$.tagName==="TEXTAREA"||$.tagName==="SELECT"||$.isContentEditable)&&this.root.contains($)&&this.forBlocks.some((Y)=>{return Y.instances.some((U)=>U.elements&&U.elements.some((Z)=>Z.contains($)))})))this.renderForBlocks();this.updateBindings(),this.modelBindings.forEach((Y)=>Y.updateDom()),this.updateMemoBindings(),this.updateChartBindings(),this.initGridBindings()})}initState(){let $=this.root.getAttribute(N)||"{}",J,Q=this.root.querySelector("script[sx-init-data]"),Y=/^[A-Za-z_$][A-Za-z0-9_$]*$/.test($);if(Q&&Y)try{J=JSON.parse(Q.textContent.trim()||"{}")}catch(V){console.error("SpruceX sx-init-data JSON parse error:",V),J={}}else try{J=new Function("$store",`return (${$});`)((q)=>{let z=h(q);if(z&&x[q])x[q].add(this);return z})}catch(V){console.error("SpruceX sx-data parse error:",$,V),J={}}let U=this.root.getAttribute(z$);if(U)try{let V=localStorage.getItem(U);if(V){let q=JSON.parse(V);Object.assign(J,q)}}catch(V){console.error("SpruceX sx-local load error:",V)}Object.defineProperty(J,"$emit",{value:this.emit,enumerable:!1}),Object.defineProperty(J,"$store",{value:(V)=>{let q=h(V);if(q&&x[V])x[V].add(this);return q},enumerable:!1});let{proxy:Z}=n$(J,()=>{if(U)try{localStorage.setItem(U,JSON.stringify(Z))}catch(V){console.error("SpruceX sx-local save error:",V)}this.scheduleUpdate()});this.state=Z}collectRefs(){this.refs={},this.root.querySelectorAll("[sx-ref]").forEach(($)=>{let J=$.getAttribute("sx-ref");if(J)this.refs[J]=$})}setupDelegation(){o.forEach(($)=>{let J=(Q)=>this.handleDelegatedEvent(Q);if(this.root.addEventListener($,J),!this._delegatedCleanups)this._delegatedCleanups=[];this._delegatedCleanups.push(()=>this.root.removeEventListener($,J))})}handleDelegatedEvent($){let J=$.target,Q=!1,Y=$.stopPropagation;$.stopPropagation=function(){Q=!0,Y.apply(this,arguments)};while(J&&J.nodeType===1){if(J.__sx_handlers&&J.__sx_handlers[$.type])J.__sx_handlers[$.type].forEach(({handler:U,component:Z})=>{if(Z!==this)return;if(!Q)U($)});if(Q)break;if(J===this.root)break;J=J.parentNode}}scan($){let J=this;k($,(Q)=>{if(Q!==$&&Q.hasAttribute(N))return!1;if(Q.tagName==="TEMPLATE"&&Q.hasAttribute(b)){let Y=Q.getAttribute(b)||"",U=Q.parentElement;if(!U)return;let Z=document.createComment("sx-for");U.insertBefore(Z,Q),Q.remove();let V=q$(Y);if(!V){console.error("SpruceX invalid sx-for expression:",Y);return}if(J.forBlocks.push({template:Q,parent:U,marker:Z,expr:Y,def:V,instances:[],autoAnimate:U.hasAttribute(_)}),U.hasAttribute(_)){let q=U.getAttribute(_),z={};if(q&&q!=="true"&&q!=="")try{z=JSON.parse(q)}catch(X){let L=parseInt(q,10);if(!isNaN(L))z={duration:L}}J.setupAutoAnimate(U,z)}}}),k($,(Q)=>{if(Q.nodeType!==1)return;if(Q!==$&&Q.hasAttribute(N))return!1;if(Q.tagName==="TEMPLATE"&&Q.hasAttribute(b))return;this.scanElement(Q,null)}),this.setupNetworkBindings()}scanElement($,J){let Q=this,Y=$.hasAttribute(d),U=$.getAttribute(g);if(U&&!Y)Q.bindings.push({el:$,type:"text",expr:U,errorFallback:$.getAttribute(I),locals:J});let Z=$.getAttribute(p);if(Z&&!Y)Q.bindings.push({el:$,type:"html",expr:Z,errorFallback:$.getAttribute(I),locals:J});let V=$.getAttribute(e);if(V)Q.bindings.push({el:$,type:"show",expr:V,errorFallback:$.getAttribute(I),locals:J});let q=$.getAttribute(J$);if(q){if(!Q.originalClasses.has($))Q.originalClasses.set($,new Set(Array.from($.classList)));Q.bindings.push({el:$,type:"class",expr:q,errorFallback:$.getAttribute(I),locals:J})}let z=$.getAttribute(L$);if(z){let P=()=>{this.state[z]=!this.state[z]};$.addEventListener("click",P),Q.eventHandlers.push({el:$,event:"click",handler:P})}for(let P of Array.from($.attributes))if(P.name.startsWith(u)){let F=P.name.slice(u.length);Q.bindings.push({el:$,type:"bind",attr:F,expr:P.value,errorFallback:$.getAttribute(I),locals:J})}let X=$.getAttribute(d),L=$.getAttribute(g),O=$.getAttribute(p);if(X&&(L||O)){let P=[];try{let W=new Function(`return (${X});`)();if(Array.isArray(W))P=W}catch(F){console.error("SpruceX sx-memo parse error:",X,F)}Q.memoBindings.push({el:$,expr:L||O,type:L?"text":"html",deps:P,lastVals:null,lastResult:null,locals:J})}this.setupModelBinding($,J);for(let P of Array.from($.attributes))if(P.name.startsWith(v)){let F=P.name.slice(v.length),[W,...K]=F.split("."),H=P.value,G=(D)=>{if(K.includes("prevent"))D.preventDefault();if(K.includes("stop"))D.stopPropagation();if(K.includes("self")&&D.target!==D.currentTarget)return;if(K.includes("window")&&D.target!==window)return;if(K.includes("document")&&D.target!==document)return;if(D instanceof KeyboardEvent){let j=K.filter((M)=>!["prevent","stop","self","window","document"].includes(M));if(j.length>0){let M=D.key.toLowerCase();if(!j.includes(M))return}}this.lastEvent=D;let B=this.locals;if(J)this.locals=J;C(H,this),this.locals=B};if(o.has(W)){if(!$.__sx_handlers)$.__sx_handlers={};if(!$.__sx_handlers[W])$.__sx_handlers[W]=[];$.__sx_handlers[W].push({handler:G,component:this})}else $.addEventListener(W,G),Q.eventHandlers.push({el:$,event:W,handler:G})}if(!J){for(let F of O$){let W=`sx-${F}`,K=$.getAttribute(W);if(K){let H=$.getAttribute(F$)||($.tagName==="FORM"?"submit":"click"),G=$.getAttribute(j$),D=$.getAttribute(B$)||null,B=$.getAttribute(w$)||"innerHTML",j=$.getAttribute(M$),M=$.getAttribute(S$),S=$.getAttribute(N$),f=$.getAttribute(I$),A=$.getAttribute(_$),R=$.getAttribute(x$),W1=$.getAttribute(C$),G1=$.getAttribute(R$),H1=$.getAttribute(f$),X1=$.getAttribute(A$),P1=$.getAttribute(E$),K1=$.getAttribute(k$),D1=$.hasAttribute(y$),L1=$.getAttribute(T$),O1=$.getAttribute(b$),F1={el:$,method:F.toUpperCase(),urlTpl:K,trigger:H,triggerDebounce:G,target:D,swap:B,varsExpr:j,jsonInto:M,optimistic:S,revertOnError:f,poll:A?Number(A):null,pollWhile:R,includeSelector:W1,bodyExpr:G1,bodyType:H1,headersExpr:X1,loadingInto:P1,errorInto:K1,disableWhileRequest:D1,textWhileRequest:L1,confirmExpr:O1};Q.netBindings.push(F1)}}let P=$.getAttribute(h$);if(P)Q.chartBindings.push({el:$,chartExpr:P,chartTypeExpr:$.getAttribute(m$),chartOptionsExpr:$.getAttribute(g$)});if($.hasAttribute(Y$))Q.gridBindings.push({el:$,gridExpr:$.getAttribute(Y$),gridOptionsExpr:$.getAttribute(p$),onChangeInto:$.getAttribute(u$),onAddedInto:$.getAttribute(v$),onRemovedInto:$.getAttribute(c$),onDragstopInto:$.getAttribute(d$),onResizestopInto:$.getAttribute(s$)})}if($.hasAttribute(_)){let P=$.getAttribute(_);queueMicrotask(()=>this.setupAutoAnimate($,P||{}))}}setupModelBinding($,J=null){let Q=$.getAttribute($$),Y=Array.from($.attributes).filter((H)=>H.name.startsWith(c));if(!Q&&Y.length===0)return;let U=Q||Y[0].value,Z=new Set,V=null;Y.forEach((H)=>{let G=H.name.slice(c.length);if(G.startsWith("debounce-ms"))V=Number(H.value||"200");else Z.add(G)});let q=($.type||"").toLowerCase(),z=q==="checkbox",X=q==="radio",L=$.tagName==="SELECT",O=()=>{let H=this.locals;if(J)this.locals=J;try{let G=w(U,this);if(z)if(Array.isArray(G))$.checked=G.includes($.value);else $.checked=!!G;else if(X)$.checked=String(G)===String($.value);else if(L)$.value=G??"";else if(G!==null&&G!==void 0&&typeof G==="object")$.value=JSON.stringify(G);else $.value=G??""}finally{this.locals=H}},P=(H)=>{if(Z.has("trim")&&typeof H==="string")H=H.trim();if(Z.has("number")){let G=Number(H);if(!Number.isNaN(G))H=G}return H},F=()=>{let H=this.locals;if(J)this.locals=J;try{let G;if(z){let D=w(U,this);if(Array.isArray(D)){let B=[...D],j=B.indexOf($.value);if($.checked&&j===-1)B.push($.value);if(!$.checked&&j!==-1)B.splice(j,1);G=B}else G=$.checked}else if(X){if(!$.checked)return;G=$.value}else if(L)G=$.value;else G=$.value;G=P(G),C(`${U} = value`,this,{value:G})}finally{this.locals=H}},W="input";if(Z.has("lazy"))W="change";let K=F;if(V!=null&&V>0){let H=null;K=()=>{clearTimeout(H),H=setTimeout(F,V)}}$.addEventListener(W,K),this.eventHandlers.push({el:$,event:W,handler:K}),this.modelBindings.push({updateDom:O,locals:J})}setupNetworkBindings(){for(let $ of this.netBindings){let{el:J,poll:Q,pollWhile:Y}=$,U=this.parseNetworkTriggers($),Z=(V=null)=>{if(V){if(this.lastEvent=V,V.type==="submit")V.preventDefault()}if(!this.confirmRequest($))return;this.performRequest($)};if(U.forEach(({eventName:V,debounceMs:q})=>{if(V==="load"){queueMicrotask(()=>Z());return}let z=this.wrapDebounced(Z,q);J.addEventListener(V,z),this.eventHandlers.push({el:J,event:V,handler:z});let X=this.wrapDebounced(()=>this.performRequest($),q);this.emitter.addEventListener(V,X),this.emitterHandlers.push({event:V,handler:X})}),Q&&!Number.isNaN(Q)&&Q>0){let V=setInterval(()=>{if(Y){if(!w(Y,this))return}this.performRequest($)},Q);this.pollTimers.push(V)}}}parseNetworkTriggers($){let J=Number($.triggerDebounce),Q=Number.isFinite(J)&&J>0?J:null,Y=($.trigger||"").trim(),U=$.el.tagName==="FORM"?"submit":"click",Z=(Y||U).split(",").flatMap((V)=>V.trim().split(/\s+/)).filter(Boolean);if(!Z.length)return[{eventName:U,debounceMs:Q}];return Z.map((V)=>{let q=V.split("."),z=q[0]||U,X=Q,L=q.indexOf("debounce");if(L!==-1){let O=Number(q[L+1]);if(Number.isFinite(O)&&O>0)X=O}return{eventName:z,debounceMs:X}})}wrapDebounced($,J){if(!J||J<=0)return $;let Q=null;return(...Y)=>{if(Q)clearTimeout(Q),this.debounceTimers.delete(Q);Q=setTimeout(()=>{this.debounceTimers.delete(Q),Q=null,$(...Y)},J),this.debounceTimers.add(Q)}}confirmRequest($){if($.confirmExpr==null)return!0;if(typeof window==="undefined"||typeof window.confirm!=="function")return!0;let J=String($.confirmExpr).trim(),Q=J||"Are you sure?";if(J){let Y=w(J,this);if(typeof Y==="string")Q=Y;else if(Y!==void 0&&Y!==null)Q=String(Y)}return window.confirm(Q)}setupAutoAnimate($,J={}){let Q=n();if(!Q)return null;if(typeof J==="string"&&J.trim())try{J=new Function(`return (${J})`)()}catch(Z){console.error("SpruceX sx-animate options parse error:",Z),J={}}let U={...{duration:250,easing:"ease-in-out"},...J};try{let Z=Q($,U);return this.animatedElements.set($,Z),Z}catch(Z){return console.error("SpruceX auto-animate error:",Z),null}}disableAutoAnimate($){let J=this.animatedElements.get($);if(J&&typeof J==="function")J.disable?.();this.animatedElements.delete($)}buildUrl($){let{urlTpl:J,varsExpr:Q}=$;if(!Q)return J;let Y=w(Q,this)||{};try{return new Function("vars","with(vars){ return `"+J+"`; }")(Y)}catch(U){return console.error("SpruceX url template error:",J,U),J}}buildBody($){let{el:J,method:Q,includeSelector:Y,bodyExpr:U,bodyType:Z}=$;if(!["POST","PUT","DELETE"].includes(Q))return{body:null,bodyKind:null};if(U){let V=this.evaluateExpressionOrLiteral(U),q=this.resolveBodyType(Z,V);if(q==="json")return{body:typeof V==="string"?V:JSON.stringify(V??{}),bodyKind:"json"};if(q==="form"){let z=this.toFormData(V);if(z instanceof FormData&&Y)this.appendIncludeData(z,Y);return{body:z,bodyKind:"form"}}return{body:V??null,bodyKind:null}}if(J.tagName==="FORM"){let V=new FormData(J);if(Y)this.appendIncludeData(V,Y);if((Z||"").toLowerCase()==="json")return{body:JSON.stringify(this.formDataToJson(V)),bodyKind:"json"};return{body:V,bodyKind:"form"}}return{body:null,bodyKind:null}}resolveBodyType($,J){let Q=($||"").toLowerCase();if(Q==="json"||Q==="form")return Q;if(J instanceof FormData||J instanceof URLSearchParams)return"form";if(J&&typeof J==="object"&&!(J instanceof Blob)&&!(J instanceof ArrayBuffer))return"json";return null}toFormData($){if($ instanceof FormData)return $;if($ instanceof URLSearchParams){let Q=new FormData;return $.forEach((Y,U)=>Q.append(U,Y)),Q}let J=new FormData;if($==null)return J;if(typeof $==="string"){let Q=new URLSearchParams($),Y=!1;if(Q.forEach((U,Z)=>{J.append(Z,U),Y=!0}),!Y)J.append("value",$);return J}if(typeof $!=="object")return J.append("value",String($)),J;return Object.entries($).forEach(([Q,Y])=>{this.appendFormValue(J,Q,Y)}),J}appendFormValue($,J,Q){if(Array.isArray(Q)){Q.forEach((Y)=>this.appendFormValue($,J,Y));return}if(Q instanceof Blob){$.append(J,Q);return}if(Q&&typeof Q==="object"){$.append(J,JSON.stringify(Q));return}$.append(J,Q==null?"":String(Q))}appendIncludeData($,J){document.querySelectorAll(J).forEach((Q)=>{if(Q.tagName==="FORM"){new FormData(Q).forEach((Y,U)=>$.append(U,Y));return}if(this.appendElementValue($,Q),Q.querySelectorAll)Q.querySelectorAll("input[name], select[name], textarea[name]").forEach((Y)=>this.appendElementValue($,Y))})}appendElementValue($,J){if(!("name"in J)||!J.name)return;if("disabled"in J&&J.disabled)return;let Q=(J.type||"").toLowerCase();if((Q==="checkbox"||Q==="radio")&&!J.checked)return;if(J.tagName==="SELECT"&&J.multiple){Array.from(J.selectedOptions||[]).forEach((Y)=>$.append(J.name,Y.value));return}$.append(J.name,J.value??"")}formDataToJson($){let J={};return $.forEach((Q,Y)=>{let U=Q instanceof File?Q.name:Q;if(Y in J)if(Array.isArray(J[Y]))J[Y].push(U);else J[Y]=[J[Y],U];else J[Y]=U}),J}buildHeaders($,J,Q){let Y=new Headers,U=$.headersExpr?w($.headersExpr,this):void 0;if(U instanceof Headers)U.forEach((Z,V)=>Y.set(V,Z));else if(Array.isArray(U))U.forEach((Z)=>{if(Array.isArray(Z)&&Z.length>=2)Y.set(String(Z[0]),String(Z[1]))});else if(U&&typeof U==="object")Object.entries(U).forEach(([Z,V])=>{if(V!=null)Y.set(Z,String(V))});if(J==="json"&&Q&&!Y.has("Content-Type"))Y.set("Content-Type","application/json");return Y}evaluateExpressionOrLiteral($){let J=String($??"").trim();if(!J)return"";let Q=w(J,this);return Q===void 0?J:Q}assignStateValue($,J){if(!$)return;C(`${$} = __sx_value`,this,{__sx_value:J})}serializeError($){if(!$)return null;if(typeof $==="string")return{message:$};return{name:$.name||"Error",message:$.message||String($),status:$.status}}beginRequestUiState($){let{el:J,disableWhileRequest:Q,textWhileRequest:Y}=$;if(!Q&&Y==null)return()=>{};let U=this.requestUiState.get(J)||{count:0,restoreFns:[]};if(U.count===0)U.restoreFns=this.applyRequestUiState($);return U.count+=1,this.requestUiState.set(J,U),()=>{let Z=this.requestUiState.get(J);if(!Z)return;if(Z.count-=1,Z.count<=0)Z.restoreFns.forEach((V)=>V()),this.requestUiState.delete(J);else this.requestUiState.set(J,Z)}}applyRequestUiState($){let J=[],{el:Q,disableWhileRequest:Y,textWhileRequest:U}=$;if(Y)this.getDisableTargets(Q).forEach((Z)=>{let V=!!Z.disabled;Z.disabled=!0,J.push(()=>{Z.disabled=V})});if(U!=null){let Z=this.getTextWhileRequestTarget(Q);if(Z){let V=String(this.evaluateExpressionOrLiteral(U));if(Z.tagName==="INPUT"){let q=Z.value;Z.value=V,J.push(()=>{Z.value=q})}else{let q=Z.textContent;Z.textContent=V,J.push(()=>{Z.textContent=q})}}}return J}getDisableTargets($){if($.tagName==="FORM")return Array.from($.elements||[]).filter((J)=>J&&("disabled"in J)&&J.type!=="hidden");return"disabled"in $?[$]:[]}getTextWhileRequestTarget($){if($.tagName!=="FORM")return $;return $.querySelector("button[type='submit']")||$.querySelector("button:not([type])")||$.querySelector("input[type='submit']")}clearDebounceTimers(){this.debounceTimers.forEach(($)=>clearTimeout($)),this.debounceTimers.clear()}clearEmitterHandlers(){this.emitterHandlers.forEach(({event:$,handler:J})=>{this.emitter.removeEventListener($,J)}),this.emitterHandlers=[]}async performRequest($){let J=this.buildUrl($),{body:Q,bodyKind:Y}=this.buildBody($),U=this.buildHeaders($,Y,Q!=null),{el:Z,method:V,target:q,swap:z,jsonInto:X,optimistic:L,revertOnError:O,loadingInto:P,errorInto:F}=$,W=this.beginRequestUiState($);if(this.assignStateValue(P,!0),this.assignStateValue(F,null),L)C(L,this);try{let K={method:V};if(Q!=null)K.body=Q;if(Array.from(U.keys()).length>0)K.headers=U;let H=await fetch(J,K);if(!H.ok)throw new Error(`HTTP ${H.status}: ${H.statusText}`);let G=await H.text(),D=null;if(X&&G.trim().length)try{D=JSON.parse(G)}catch(j){console.error("SpruceX JSON parse error:",j)}if(X&&D!=null)C(`${X} = value`,this,{value:D});else this.applySwap(q||Z,G,z);let B={response:H,text:G,json:D};Z.dispatchEvent(new CustomEvent("success",{detail:B,bubbles:!0})),Z.dispatchEvent(new CustomEvent("sprucex:success",{detail:B,bubbles:!0}))}catch(K){if(O)C(O,this);this.assignStateValue(F,this.serializeError(K));let H={error:K};Z.dispatchEvent(new CustomEvent("error",{detail:H,bubbles:!0})),Z.dispatchEvent(new CustomEvent("sprucex:error",{detail:H,bubbles:!0}))}finally{this.assignStateValue(P,!1),W()}}getChartConstructor(){if(typeof window==="undefined")return null;let $=window.Chart;return $&&typeof $==="object"?$.Chart||$:$}updateChartBindings(){this.chartBindings.forEach(($)=>this.syncChartBinding($))}syncChartBinding($){let{el:J,chartExpr:Q,chartTypeExpr:Y,chartOptionsExpr:U}=$;if(!J.isConnected){this.destroyChartInstance(J);return}let Z=w(Q,this);if(Z==null){this.destroyChartInstance(J);return}let V=this.getChartConstructor();if(!V){if(!this.warnedMissingChart)this.warnedMissingChart=!0,console.warn("SpruceX: sx-chart requires Chart.js to be loaded on window.Chart.");return}let z=this.getChartCanvas(J)?.getContext?.("2d");if(!z)return;let X=Y!=null?this.evaluateExpressionOrLiteral(Y):null,L=U!=null?this.evaluateExpressionOrLiteral(U):null,O=Z&&typeof Z==="object"&&"data"in Z?Z.data:Z,P=typeof X==="string"&&X.trim()||(Z&&typeof Z==="object"?Z.type:null)||"line",F=L&&typeof L==="object"?L:Z&&typeof Z==="object"&&Z.options&&typeof Z.options==="object"?Z.options:{},W=this.cloneChartConfigValue(O),K=this.cloneChartConfigValue(F),H=this.chartInstances.get(J);if(H&&H.config?.type!==P)H.destroy(),this.chartInstances.delete(J),H=null;if(!H){H=new V(z,{type:P,data:W,options:K}),this.chartInstances.set(J,H),this.chartSnapshots.set(J,{type:P,data:W,options:K});return}let G=this.chartSnapshots.get(J),D={type:P,data:W,options:K};if(G&&this.areChartValuesEqual(G,D))return;H.data=W,H.options=K,H.update(),this.chartSnapshots.set(J,D)}cloneChartConfigValue($,J=new WeakMap){if($==null||typeof $!=="object")return $;if(J.has($))return J.get($);if(Array.isArray($)){let U=[];return J.set($,U),$.forEach((Z)=>U.push(this.cloneChartConfigValue(Z,J))),U}let Q=Object.getPrototypeOf($);if(Q!==Object.prototype&&Q!==null)return $;let Y={};return J.set($,Y),Object.keys($).forEach((U)=>{Y[U]=this.cloneChartConfigValue($[U],J)}),Y}areChartValuesEqual($,J,Q=new WeakMap){if(Object.is($,J))return!0;if(typeof $!==typeof J)return!1;if($==null||J==null)return!1;if(typeof $!=="object")return!1;let Y=Q.get($);if(Y&&Y.has(J))return!0;if(Y)Y.add(J);else Q.set($,new WeakSet([J]));if(Array.isArray($)){if(!Array.isArray(J)||$.length!==J.length)return!1;for(let z=0;z<$.length;z+=1)if(!this.areChartValuesEqual($[z],J[z],Q))return!1;return!0}if(Array.isArray(J))return!1;let U=Object.getPrototypeOf($),Z=Object.getPrototypeOf(J);if(U!==Z)return!1;if(U!==Object.prototype&&U!==null)return!1;let V=Object.keys($),q=Object.keys(J);if(V.length!==q.length)return!1;for(let z=0;z<V.length;z+=1){let X=V[z];if(!Object.prototype.hasOwnProperty.call(J,X))return!1;if(!this.areChartValuesEqual($[X],J[X],Q))return!1}return!0}getChartCanvas($){if($.tagName==="CANVAS")return $;let J=$.querySelector("canvas");if(J)return J;let Q=document.createElement("canvas");return $.appendChild(Q),Q}destroyChartInstance($){let J=this.chartInstances.get($);if(!J)return;try{J.destroy()}catch(Q){console.error("SpruceX sx-chart destroy error:",Q)}this.chartInstances.delete($),this.chartSnapshots.delete($)}teardownChartBindings(){this.chartInstances.forEach(($,J)=>this.destroyChartInstance(J)),this.chartInstances.clear()}initGridBindings(){this.gridBindings.forEach(($)=>{let{el:J}=$;if(!J.isConnected||this.gridInstances.has(J))return;if(typeof window==="undefined"||!window.GridStack||typeof window.GridStack.init!=="function"){if(!this.warnedMissingGridStack)this.warnedMissingGridStack=!0,console.warn("SpruceX: sx-gridstack requires GridStack on window.GridStack.");return}let Q=this.buildGridOptions($),Y=window.GridStack.init(Q,J),U=[],Z=(V,q)=>{if(!q)return;let z=(X,L=[])=>{let O=this.serializeGridNodes(L);this.assignStateValue(q,O),J.dispatchEvent(new CustomEvent(`sprucex:gridstack:${V}`,{detail:O,bubbles:!0}))};Y.on(V,z),U.push(()=>{if(typeof Y.off==="function")Y.off(V,z)})};Z("change",$.onChangeInto),Z("added",$.onAddedInto),Z("removed",$.onRemovedInto),Z("dragstop",$.onDragstopInto),Z("resizestop",$.onResizestopInto),this.gridInstances.set(J,{grid:Y,cleanups:U})})}buildGridOptions($){let J={},{el:Q,gridExpr:Y,gridOptionsExpr:U}=$;if(Y&&Y.trim()&&Y.trim()!=="true"){let Z=w(Y,this);if(Z&&typeof Z==="object"&&!Array.isArray(Z))Object.assign(J,Z)}if(U){let Z=w(U,this);if(Z&&typeof Z==="object"&&!Array.isArray(Z))Object.assign(J,Z)}return Array.from(Q.attributes).filter((Z)=>Z.name.startsWith(Z$)).forEach((Z)=>{let V=Z.name.slice(Z$.length);if(!V)return;let q=V.replace(/-([a-z])/g,(z,X)=>X.toUpperCase());J[q]=this.parseGridOptionValue(Z.value)}),J}parseGridOptionValue($){let J=String($||"").trim();if(!J)return!0;if(J==="true")return!0;if(J==="false")return!1;let Q=Number(J);if(Number.isFinite(Q))return Q;let Y=w(J,this);return Y===void 0?J:Y}serializeGridNodes($){if(!Array.isArray($))return[];return $.map((J)=>({id:J?.id??J?.el?.id??null,x:J?.x,y:J?.y,w:J?.w,h:J?.h,minW:J?.minW,minH:J?.minH,maxW:J?.maxW,maxH:J?.maxH}))}teardownGridBindings(){this.gridInstances.forEach(({grid:$,cleanups:J})=>{if(J.forEach((Q)=>Q()),$&&typeof $.destroy==="function")$.destroy(!1)}),this.gridInstances.clear()}applySwap($,J,Q){let Y=typeof $==="string"?document.querySelector($):$;if(!Y)return;switch(Q){case"outerHTML":Y.outerHTML=J;break;case"before":Y.insertAdjacentHTML("beforebegin",J);break;case"after":Y.insertAdjacentHTML("afterend",J);break;case"prepend":Y.insertAdjacentHTML("afterbegin",J);break;case"append":Y.insertAdjacentHTML("beforeend",J);break;case"morph":{let V=new DOMParser().parseFromString(`<div>${J}</div>`,"text/html").body.firstChild;if(V)m(Y,V);break}case"id-map":{let V=new DOMParser().parseFromString(`<div>${J}</div>`,"text/html").body.firstChild;if(V)m(Y,V);break}case"innerHTML":default:Y.innerHTML=J}}renderForBlocks(){this.forBlocks.forEach(($)=>{let{def:J,template:Q,parent:Y,marker:U,instances:Z,parentLocals:V}=$,q=this.locals;if(V)this.locals=V;let z=w(J.iterable,this)||[],X=Array.from(z);this.locals=q;let L=new Map;Z.forEach((W)=>{let K=W.itemKey;if(K!==void 0)L.set(K,W)});let O=[],P=new Set;for(let W=0;W<X.length;W++){let K=X[W],H=J.index||"$index",G=K;if(typeof K==="object"&&K!==null)G=K;let D=L.get(G);if(D&&!P.has(G))P.add(G),D.scopeLocals[H]=W,O.push(D);else{let B=V?{...V}:{};B[J.item]=K,B[H]=W;let j=Q.content?Q.content.cloneNode(!0):o$(Q),M=[];while(j.firstChild){let A=j.firstChild;M.push(A),j.removeChild(A)}let S={bindings:[],memoBindings:[],modelBindings:[],eventHandlers:[],nestedForBlocks:[]};M.forEach((A)=>{let R=this.scanFragmentBindings(A,B);if(S.bindings.push(...R.bindings),S.memoBindings.push(...R.memoBindings),S.modelBindings.push(...R.modelBindings),S.eventHandlers.push(...R.eventHandlers),R.nestedForBlocks)S.nestedForBlocks.push(...R.nestedForBlocks)});let f={scopeLocals:B,elements:M,bindings:S,itemKey:G};O.push(f),P.add(G)}}Z.forEach((W)=>{if(!P.has(W.itemKey)){if(W.elements)W.elements.forEach((K)=>K.remove());else if(W.fragmentRoot)W.fragmentRoot.remove();this.cleanupInstanceBindings(W.bindings)}});let F=U;for(let W=O.length-1;W>=0;W--){let K=O[W];if(K.elements.forEach((H)=>{Y.insertBefore(H,F)}),K.elements.length>0)F=K.elements[0]}$.instances.length=0,$.instances.push(...O)})}scanFragmentBindings($,J){let Q=this,Y={bindings:[],memoBindings:[],modelBindings:[],eventHandlers:[],nestedForBlocks:[]};return k($,(U)=>{if(U.nodeType!==1)return;if(U.hasAttribute(N))return!1;if(U.tagName==="TEMPLATE"&&U.hasAttribute(b)){let W=U.getAttribute(b)||"",K=U.parentElement;if(!K)return;let H=document.createComment("sx-for");K.insertBefore(H,U),U.remove();let G=q$(W);if(!G)return console.error("SpruceX invalid nested sx-for expression:",W),!1;let D={template:U,parent:K,marker:H,expr:W,def:G,instances:[],parentLocals:J,autoAnimate:K.hasAttribute(_)};if(Q.forBlocks.push(D),Y.nestedForBlocks.push(D),K.hasAttribute(_)){let B=K.getAttribute(_),j={};if(B&&B!=="true"&&B!=="")try{j=JSON.parse(B)}catch(M){let S=parseInt(B,10);if(!isNaN(S))j={duration:S}}Q.setupAutoAnimate(K,j)}return!1}let Z=U.hasAttribute(d),V=U.getAttribute(g);if(V&&!Z){let W={el:U,type:"text",expr:V,errorFallback:U.getAttribute(I),locals:J};Q.bindings.push(W),Y.bindings.push(W)}let q=U.getAttribute(p);if(q&&!Z){let W={el:U,type:"html",expr:q,errorFallback:U.getAttribute(I),locals:J};Q.bindings.push(W),Y.bindings.push(W)}let z=U.getAttribute(e);if(z){let W={el:U,type:"show",expr:z,errorFallback:U.getAttribute(I),locals:J};Q.bindings.push(W),Y.bindings.push(W)}let X=U.getAttribute(J$);if(X){if(!Q.originalClasses.has(U))Q.originalClasses.set(U,new Set(Array.from(U.classList)));let W={el:U,type:"class",expr:X,errorFallback:U.getAttribute(I),locals:J};Q.bindings.push(W),Y.bindings.push(W)}for(let W of Array.from(U.attributes))if(W.name.startsWith(u)){let K=W.name.slice(u.length),H={el:U,type:"bind",attr:K,expr:W.value,errorFallback:U.getAttribute(I),locals:J};Q.bindings.push(H),Y.bindings.push(H)}let L=U.getAttribute(d),O=U.getAttribute(g),P=U.getAttribute(p);if(L&&(O||P)){let W=[];try{let G=new Function(`return (${L});`)();if(Array.isArray(G))W=G}catch(H){console.error("SpruceX sx-memo parse error:",L,H)}let K={el:U,expr:O||P,type:O?"text":"html",deps:W,lastVals:null,lastResult:null,locals:J};Q.memoBindings.push(K),Y.memoBindings.push(K)}let F=this.setupModelBindingWithReturn(U,J);if(F)Y.modelBindings.push(F);for(let W of Array.from(U.attributes))if(W.name.startsWith(v)){let K=W.name.slice(v.length),[H,...G]=K.split("."),D=W.value,B=(j)=>{if(G.includes("prevent"))j.preventDefault();if(G.includes("stop"))j.stopPropagation();if(G.includes("self")&&j.target!==j.currentTarget)return;if(G.includes("window")&&j.target!==window)return;if(G.includes("document")&&j.target!==document)return;if(j instanceof KeyboardEvent){let S=G.filter((f)=>!["prevent","stop","self","window","document"].includes(f));if(S.length>0){let f=j.key.toLowerCase();if(!S.includes(f))return}}this.lastEvent=j;let M=this.locals;this.locals=J,C(D,this),this.locals=M};if(o.has(H)){if(!U.__sx_handlers)U.__sx_handlers={};if(!U.__sx_handlers[H])U.__sx_handlers[H]=[];U.__sx_handlers[H].push({handler:B,component:this})}else U.addEventListener(H,B),Q.eventHandlers.push({el:U,event:H,handler:B}),Y.eventHandlers.push({el:U,event:H,handler:B})}if(U.hasAttribute(_)){let W=U.getAttribute(_);queueMicrotask(()=>this.setupAutoAnimate(U,W||{}))}}),Y}setupModelBindingWithReturn($,J=null){let Q=$.getAttribute($$),Y=Array.from($.attributes).filter((G)=>G.name.startsWith(c));if(!Q&&Y.length===0)return null;let U=Q||Y[0].value,Z=new Set,V=null;Y.forEach((G)=>{let D=G.name.slice(c.length);if(D.startsWith("debounce-ms"))V=Number(G.value||"200");else Z.add(D)});let q=($.type||"").toLowerCase(),z=q==="checkbox",X=q==="radio",L=$.tagName==="SELECT",O=()=>{let G=this.locals;if(J)this.locals=J;try{let D=w(U,this);if(z)if(Array.isArray(D))$.checked=D.includes($.value);else $.checked=!!D;else if(X)$.checked=String(D)===String($.value);else if(L)$.value=D??"";else if(D!==null&&D!==void 0&&typeof D==="object")$.value=JSON.stringify(D);else $.value=D??""}finally{this.locals=G}},P=(G)=>{if(Z.has("trim")&&typeof G==="string")G=G.trim();if(Z.has("number")){let D=Number(G);if(!Number.isNaN(D))G=D}return G},F=()=>{let G=this.locals;if(J)this.locals=J;try{let D;if(z){let B=w(U,this);if(Array.isArray(B)){let j=[...B],M=j.indexOf($.value);if($.checked&&M===-1)j.push($.value);if(!$.checked&&M!==-1)j.splice(M,1);D=j}else D=$.checked}else if(X){if(!$.checked)return;D=$.value}else if(L)D=$.value;else D=$.value;D=P(D),C(`${U} = value`,this,{value:D})}finally{this.locals=G}},W="input";if(Z.has("lazy"))W="change";let K=F;if(V!=null&&V>0){let G=null;K=()=>{clearTimeout(G),G=setTimeout(F,V)}}$.addEventListener(W,K);let H={updateDom:O,locals:J,el:$,event:W,handler:K};return this.eventHandlers.push({el:$,event:W,handler:K}),this.modelBindings.push(H),H}cleanupInstanceBindings($){$.bindings.forEach((J)=>{let Q=this.bindings.indexOf(J);if(Q!==-1)this.bindings.splice(Q,1)}),$.memoBindings.forEach((J)=>{let Q=this.memoBindings.indexOf(J);if(Q!==-1)this.memoBindings.splice(Q,1)}),$.modelBindings.forEach((J)=>{let Q=this.modelBindings.indexOf(J);if(Q!==-1)this.modelBindings.splice(Q,1)}),$.eventHandlers.forEach(({el:J,event:Q,handler:Y})=>{J.removeEventListener(Q,Y);let U=this.eventHandlers.findIndex((Z)=>Z.el===J&&Z.event===Q&&Z.handler===Y);if(U!==-1)this.eventHandlers.splice(U,1)})}applyInitialRender(){this.updateBindings(),this.modelBindings.forEach(($)=>$.updateDom()),this.updateMemoBindings(),this.updateChartBindings(),this.initGridBindings()}updateBindings(){for(let $ of this.bindings){let{el:J,type:Q,expr:Y,attr:U,errorFallback:Z,locals:V}=$,q=this.locals;if(V)this.locals=V;try{switch(Q){case"text":{let z=w(Y,this,Z);if(z!==null&&z!==void 0&&typeof z==="object")J.textContent=JSON.stringify(z);else J.textContent=z??"";break}case"html":{let z=w(Y,this,Z);if(z!==null&&z!==void 0&&typeof z==="object")J.innerHTML=JSON.stringify(z);else J.innerHTML=z??"";break}case"show":{let z=!!w(Y,this,Z);J.style.display=z?"":"none";break}case"bind":{let z=w(Y,this,Z);if(z===!1||z===null||z===void 0)J.removeAttribute(U);else J.setAttribute(U,z);break}case"class":{let z=w(Y,this,Z),X=this.originalClasses.get(J)||new Set,L=new Set(Array.from(J.classList));if(typeof z==="string"){let O=new Set(z.split(/\s+/).filter(Boolean));L.forEach((P)=>{if(!X.has(P))J.classList.remove(P)}),O.forEach((P)=>J.classList.add(P))}else if(z&&typeof z==="object")Object.keys(z).forEach((O)=>{O.split(/\s+/).filter(Boolean).forEach((P)=>{if(z[O])J.classList.add(P);else J.classList.remove(P)})});break}}}finally{this.locals=q}}}updateMemoBindings(){this.memoBindings.forEach(($)=>{let{el:J,expr:Q,type:Y,deps:U,locals:Z}=$,V=this.locals;if(Z)this.locals=Z;try{let q=U.map((X)=>{if(Z&&X in Z)return Z[X];if(X in this.state)return this.state[X];return this.state[X]});if($.lastVals&&$.lastVals.length===q.length&&$.lastVals.every((X,L)=>X===q[L]))return;$.lastVals=q;let z=w(Q,this);if($.lastResult=z,Y==="text")J.textContent=z??"";else J.innerHTML=z??""}finally{this.locals=V}})}callHook($){let J=this.state&&this.state[$];if(typeof J==="function")try{J.call(this.state)}catch(Q){console.error(`SpruceX ${$}() hook error:`,Q)}}refresh(){this.teardownChartBindings(),this.teardownGridBindings(),this.clearDebounceTimers(),this.clearEmitterHandlers(),this.bindings=[],this.memoBindings=[],this.modelBindings=[],this.netBindings=[],this.chartBindings=[],this.gridBindings=[],this.forBlocks=[],this.eventHandlers.forEach(({el:$,event:J,handler:Q})=>{$.removeEventListener(J,Q)}),this.eventHandlers=[],k(this.root,($)=>{if($!==this.root&&$.hasAttribute(N))return!1;if($.__sx_handlers)delete $.__sx_handlers}),this.animatedElements.forEach(($,J)=>{this.disableAutoAnimate(J)}),this.animatedElements.clear(),this.pollTimers.forEach(($)=>clearInterval($)),this.pollTimers=[],this.collectRefs(),this.scan(this.root),this.renderForBlocks(),this.applyInitialRender()}destroy(){if(this.callHook("destroyed"),Object.keys(x).forEach(($)=>{x[$].delete(this)}),this.animatedElements.forEach(($,J)=>{this.disableAutoAnimate(J)}),this.animatedElements.clear(),this.teardownChartBindings(),this.teardownGridBindings(),this.eventHandlers.forEach(({el:$,event:J,handler:Q})=>{$.removeEventListener(J,Q)}),this.clearEmitterHandlers(),this._delegatedCleanups)this._delegatedCleanups.forEach(($)=>$());if(this.pollTimers.forEach(($)=>clearInterval($)),this.clearDebounceTimers(),this.rafId)cancelAnimationFrame(this.rafId);this.bindings=[],this.memoBindings=[],this.modelBindings=[],this.eventHandlers=[],this.chartBindings=[],this.gridBindings=[],this.netBindings=[],this.forBlocks=[],this.pollTimers=[],delete this.root.__sprucex}}var a=new Map,r=new Map,I1=30000,Y1={init:i,store:r$,inspect(){let $=document.querySelectorAll(`[${N}]`);return Array.from($).map((J)=>({el:J,state:J.__sprucex?.state||null}))},config($){},navigate($){let Q=document.querySelector(`[${E}]`)?.getAttribute(E),Y=Q?document.querySelector(Q):document.body;return K$($,Y)},prefetch($){return t($)},clearCache(){a.clear()},morph($,J){if(typeof $==="string")$=document.querySelector($);if(typeof J==="string")J=new DOMParser().parseFromString(`<div>${J}</div>`,"text/html").body.firstChild;if($&&J)m($,J)},animate($,J={}){if(typeof $==="string")$=document.querySelector($);if(!$)return null;let Q=n();if(!Q)return console.warn("SpruceX: auto-animate library not found. Include it via script tag or npm."),null;return Q($,J)},setAutoAnimate:t$};if(typeof window!=="undefined"){if(window.SpruceX=Y1,!window.SpruceXBoot)window.SpruceXBoot={}}var $1=!1;function Z1(){if($1||typeof window==="undefined")return;$1=!0;let $=window.SpruceXBoot;if($&&typeof $.initTheme==="function")try{$.initTheme()}catch(J){console.error("SpruceX boot hook error:",J)}}function J1($){if($.__sprucex)return $.__sprucex;let J=new X$($);return $.__sprucex=J,J}function i(){Z1(),document.querySelectorAll(`[${N}]`).forEach((Q)=>{if(!Q.hasAttribute(V$))J1(Q);else{let U=new IntersectionObserver((Z)=>{Z.forEach((V)=>{if(V.isIntersecting)J1(Q),U.disconnect()})});U.observe(Q)}});let J=document.querySelector(`[${E}]`);if(J&&!J.__sprucex_page)J.__sprucex_page=!0,x1(J);V1(),_1(),Array.from(document.scripts).forEach((Q)=>{Q.__sprucex_executed=!0})}var P$=null;function _1(){if(P$)return;if(P$=new MutationObserver(($)=>{for(let J of $)J.removedNodes.forEach((Q)=>{if(Q.nodeType!==1)return;if(Q.__sprucex)Q.__sprucex.destroy();Q.querySelectorAll(`[${N}]`).forEach((Y)=>{if(Y.__sprucex)Y.__sprucex.destroy()})})}),document.body)P$.observe(document.body,{childList:!0,subtree:!0})}var Q1=!1;function x1($){let J=$.getAttribute(E);if(J===null)return;let Q=J?document.querySelector(J):document.body;if(!Q){console.error("SpruceX sx-page target not found:",J);return}if(Q1)return;Q1=!0,document.addEventListener("click",async(Y)=>{let U=Y.target.closest("a[href]");if(!U)return;let Z=U.getAttribute("href");if(!Z||Z.startsWith("#")||Z.startsWith("javascript:"))return;if(U.hasAttribute("download")||U.getAttribute("target")==="_blank")return;try{let V=new URL(Z,window.location.origin);if(V.origin!==window.location.origin)return;Y.preventDefault(),await K$(V.href,Q)}catch{return}}),window.addEventListener("popstate",async()=>{await K$(window.location.href,Q,!1)})}function V1(){document.querySelectorAll(`[${Q$}]`).forEach(($)=>{if($.__sprucex_boost)return;$.__sprucex_boost=!0;let Q=($.getAttribute(U$)||"mouseenter").split(/\s+/);if($.tagName==="A")Q.forEach((Y)=>{$.addEventListener(Y,()=>t($.href),{passive:!0,once:!0})});else Q.forEach((Y)=>{$.addEventListener(Y,(U)=>{let Z=U.target.closest("a[href]");if(Z&&!Z.__sprucex_prefetched)Z.__sprucex_prefetched=!0,t(Z.href)},{passive:!0})}),$.addEventListener("focusin",(Y)=>{let U=Y.target.closest("a[href]");if(U&&!U.__sprucex_prefetched)U.__sprucex_prefetched=!0,t(U.href)},{passive:!0})})}async function K$($,J,Q=!0){let Y=performance.now(),U=new CustomEvent("sprucex:page-before",{detail:{url:$},bubbles:!0,cancelable:!0});if(!document.dispatchEvent(U))return;try{let Z=q1($);if(!Z){if(J)J.style.opacity=J.style.opacity||"1";Z=await z1($)}if(!Z)throw new Error("Empty response");let q=new DOMParser().parseFromString(Z,"text/html"),z,L=document.querySelector("[sx-page]")?.getAttribute(E);if(L)z=q.querySelector(L);if(!z)z=q.body;let O=q.querySelector("title");if(O)document.title=O.textContent;if(U1(J),J&&z)m(J,z),J.querySelectorAll("script").forEach((W)=>{if(!W.__sprucex_executed)C1(W)});if(Q)history.pushState({url:$},"",$);U1(J),i();let P=J.parentElement;while(P){if(P.__sprucex)P.__sprucex.refresh();P=P.parentElement}V1();let F=new URL($).hash;if(F){let W=document.querySelector(F);if(W)W.scrollIntoView()}else window.scrollTo(0,0);document.dispatchEvent(new CustomEvent("sprucex:page-after",{detail:{url:$,duration:performance.now()-Y},bubbles:!0}))}catch(Z){console.error("SpruceX page navigation error:",Z),document.dispatchEvent(new CustomEvent("sprucex:page-error",{detail:{url:$,error:Z},bubbles:!0})),window.location.href=$}}function U1($){if(!$)return;if($.querySelectorAll(`[${N}]`).forEach((J)=>{if(J.__sprucex)J.__sprucex.destroy()}),$.hasAttribute(N)&&$.__sprucex)$.__sprucex.destroy()}async function t($){if(!$)return;try{let J=new URL($,window.location.origin);if(J.origin!==window.location.origin)return;if(J.href===window.location.href)return;await z1(J.href)}catch{}}async function z1($){let J=q1($);if(J)return J;if(r.has($))return r.get($);let Q=(async()=>{try{let Y=await fetch($,{headers:{"X-SpruceX-Request":"true"}});if(!Y.ok)throw new Error(`HTTP ${Y.status}`);let U=await Y.text();return a.set($,{html:U,timestamp:Date.now()}),U}finally{r.delete($)}})();return r.set($,Q),Q}function q1($){let J=a.get($);if(!J)return null;if(Date.now()-J.timestamp>I1)return a.delete($),null;return J.html}if(typeof document!=="undefined")if(Z1(),document.readyState==="loading")document.addEventListener("DOMContentLoaded",i);else i();function C1($){if($.type&&$.type!=="text/javascript"&&$.type!=="application/javascript"&&$.type!=="module")return;let J=document.createElement("script");Array.from($.attributes).forEach((Q)=>{J.setAttribute(Q.name,Q.value)}),J.textContent=$.textContent,J.__sprucex_executed=!0,$.replaceWith(J)}})();

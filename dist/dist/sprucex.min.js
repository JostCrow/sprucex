(()=>{var{defineProperty:QG,getOwnPropertyNames:h$,getOwnPropertyDescriptor:b$}=Object,g$=Object.prototype.hasOwnProperty;var xG=new WeakMap,p$=(G)=>{var $=xG.get(G),Z;if($)return $;if($=QG({},"__esModule",{value:!0}),G&&typeof G==="object"||typeof G==="function")h$(G).map((z)=>!g$.call($,z)&&QG($,z,{get:()=>G[z],enumerable:!(Z=b$(G,z))||Z.enumerable}));return xG.set(G,$),$};var m$=(G,$)=>{for(var Z in $)QG(G,Z,{get:$[Z],enumerable:!0,configurable:!0,set:(z)=>$[Z]=()=>z})};var r$={};m$(r$,{initSpruceX:()=>$G,SpruceX:()=>F$});var N="sx-data",d="sx-text",i="sx-html",_G="sx-show",s="sx-bind:",n="sx-on:",PG="sx-model",o="sx-model.",VG="sx-class",fG="sx-toggle",F="sx-error-fallback",m="sx-for",t="sx-memo",y="sx-page",OG="sx-boost",qG="sx-boost-on",EG=["get","post","put","delete"],yG="sx-trigger",kG="sx-trigger-debounce",hG="sx-target",bG="sx-swap",gG="sx-vars",pG="sx-json-into",mG="sx-optimistic",uG="sx-revert-on-error",vG="sx-poll",cG="sx-poll-while",dG="sx-include",iG="sx-body",sG="sx-body-type",nG="sx-headers",oG="sx-loading-into",tG="sx-error-into",rG="sx-disable-while-request",aG="sx-text-while-request",lG="sx-confirm",eG="sx-chart",G$="sx-chart-type",$$="sx-chart-options",DG="sx-gridstack",Z$="sx-gridstack-options",XG="sx-gridstack-option:",Y$="sx-gridstack-on-change",z$="sx-gridstack-on-added",J$="sx-gridstack-on-removed",U$="sx-gridstack-on-dragstop",H$="sx-gridstack-on-resizestop",WG="sx-lazy",KG="sx-local",R="sx-animate",ZG=new Set(["click","dblclick","mousedown","mouseup","input","change","submit","keydown","keyup","keypress","focusin","focusout"]);var k=(G,$)=>{if($(G)===!1)return;let Z=G.firstElementChild;while(Z){let z=Z.nextElementSibling;k(Z,$),Z=z}};function Q$(G){return typeof G==="function"&&/^class\s/.test(G.toString())}function SG(G){let $=G.match(/^\s*(.*?)\s+(in|of)\s+(.*)\s*$/);if(!$)return null;let Z=$[1].trim(),z=$[3].trim();if(Z.startsWith("(")){let Y=Z.slice(1,-1),[J,U]=Y.split(",").map((H)=>H.trim());return{item:J,index:U,iterable:z}}return{item:Z,index:null,iterable:z}}function _$(G){let $=document.createDocumentFragment(),Z=G.firstChild;while(Z)$.appendChild(Z.cloneNode(!0)),Z=Z.nextSibling;return $}function h(G,$,Z=new WeakSet){if(G===null||typeof G!=="object")return G;if(Z.has(G))return G;if(Z.add(G),Array.isArray(G))["push","pop","shift","unshift","splice","sort","reverse"].forEach((J)=>{let U=G[J];if(typeof U==="function")G[J]=function(...H){let Q=U.apply(this,H);return $(),Q}}),G.forEach((J,U)=>{if(J&&typeof J==="object")G[U]=h(J,$,Z)});else Object.keys(G).forEach((Y)=>{if(G[Y]&&typeof G[Y]==="object")G[Y]=h(G[Y],$,Z)});return new Proxy(G,{get(Y,J,U){let H=Reflect.get(Y,J,U);if(typeof H==="function"&&!Q$(H))return H.bind(U);return H},set(Y,J,U,H){let Q=Y[J];if(U&&typeof U==="object")U=h(U,$,new WeakSet);let q=Reflect.set(Y,J,U,H);if(Q!==U)$(J,U,Q);return q},deleteProperty(Y,J){let U=Reflect.deleteProperty(Y,J);return $(),U}})}function P$(G,$){let Z=G.watch||{};if(Z&&typeof Z==="object")delete G.watch;let Y=h(G,(J,U,H)=>{if($(J,U,H),Z&&typeof Z[J]==="function")try{Z[J].call(Y,U,H)}catch(Q){console.error("SpruceX watcher error on",J,Q)}});return{proxy:Y,watchers:Z}}var b=Object.create(null),M=Object.create(null);function u(G){return b[G]}function V$(G,$,Z={}){if(!b[G]){let z=$||{};if(Z.persist)try{let U=localStorage.getItem(`sprucex-store-${G}`);if(U)Object.assign(z,JSON.parse(U))}catch(U){console.error(`SpruceX store "${G}" load error:`,U)}let Y=new Set;M[G]=Y;let J=()=>{if(Z.persist)try{localStorage.setItem(`sprucex-store-${G}`,JSON.stringify(b[G]))}catch(U){console.error(`SpruceX store "${G}" save error:`,U)}Y.forEach((U)=>U.scheduleUpdate())};b[G]=h(z,J)}return b[G]}var r=null,LG=!1;function YG(){if(LG)return r;if(LG=!0,window.autoAnimate)r=window.autoAnimate;else if(window.AutoAnimate?.default)r=window.AutoAnimate.default;return r}function O$(G){r=G,LG=!0}var q$=new Map,D$=new Map;function AG(G,$,Z={}){let z=$.locals||{},Y=Object.keys(Z),J=G+"|"+Y.join(","),U=q$.get(J);if(!U)try{U=new Function("$state","$event","$refs","$emit","$store","$locals",...Y,`with($state){ with($locals){ return (${G}); } }`),q$.set(J,U)}catch(H){if($.debug)console.error("SpruceX expression compile error:",G,H);throw H}try{return U($.state,$.lastEvent||null,$.refs,$.emit,u,z,...Object.values(Z))}catch(H){if($.debug)console.error("SpruceX expression error:",G,H);throw H}}function j(G,$,Z){try{return AG(G,$)}catch(z){if(Z)try{return AG(Z,$)}catch(Y){console.error("SpruceX fallback expression error:",Z,Y)}return}}function T(G,$,Z={}){let z=$.locals||{},Y=Object.keys(Z),J=G+"|"+Y.join(","),U=D$.get(J);if(!U)try{U=new Function("$state","$event","$refs","$emit","$store","$locals",...Y,`with($state){ with($locals){ ${G} } }`),D$.set(J,U)}catch(H){console.error("SpruceX statement compile error:",G,H);return}try{U($.state,$.lastEvent||null,$.refs,$.emit,u,z,...Object.values(Z))}catch(H){console.error("SpruceX statement error:",G,H)}}function v(G,$){let Z=new Map;$.querySelectorAll("[id]").forEach((z)=>{Z.set(z.id,z)}),Z.forEach((z,Y)=>{let J=G.querySelector(`#${CSS.escape(Y)}`);if(J)X$(J,z),z.__morphed=!0}),jG(G,$)}function X$(G,$){if(G===$)return;if(G.isEqualNode($))return;if(G.tagName!==$.tagName){G.replaceWith($.cloneNode(!0));return}if(u$(G,$),G.tagName==="INPUT"||G.tagName==="TEXTAREA"){if(G.value!==$.value)G.value=$.value;if(G.checked!==$.checked)G.checked=$.checked;return}if(G.tagName==="SELECT"){if(jG(G,$),G.value!==$.value)G.value=$.value;return}if(G.hasAttribute("sx-preserve"))return;jG(G,$)}function jG(G,$){let Z=Array.from(G.childNodes),z=Array.from($.childNodes),Y=new Map,J=new Map;Z.forEach((H,Q)=>{if(H.nodeType===1){let q=H.getAttribute?.("sx-key")||H.getAttribute?.("key");if(q)Y.set(q,{el:H,index:Q});let X=H.id;if(X)J.set(X,{el:H,index:Q})}});let U=0;for(let H=0;H<z.length;H++){let Q=z[H];if(Q.nodeType===3||Q.nodeType===8){let q=Z[U];if(q&&q.nodeType===Q.nodeType){if(q.nodeValue!==Q.nodeValue)q.nodeValue=Q.nodeValue;U++}else{let X=Q.cloneNode(!0);if(q)G.insertBefore(X,q);else G.appendChild(X)}continue}if(Q.nodeType===1){if(Q.__morphed){delete Q.__morphed,U++;continue}let q=Q.getAttribute?.("sx-key")||Q.getAttribute?.("key"),X=Q.id,W=null;if(q&&Y.has(q))W=Y.get(q).el,Y.delete(q);else if(X&&J.has(X))W=J.get(X).el,J.delete(X);else{let D=Z[U];if(D?.nodeType===1&&D.tagName===Q.tagName){if(!(D.getAttribute?.("sx-key")||D.getAttribute?.("key")))W=D}}if(W){X$(W,Q);let D=Array.from(G.childNodes).indexOf(W),S=H;if(D!==S&&D!==-1){let P=G.childNodes[S];if(P&&P!==W)G.insertBefore(W,P)}U++}else{let D=Q.cloneNode(!0),S=Z[U];if(S)G.insertBefore(D,S);else G.appendChild(D)}}}while(G.childNodes.length>z.length){let H=G.childNodes[z.length];if(H){if(H.__sprucex)H.__sprucex.destroy();if(H.nodeType===1)H.querySelectorAll?.(`[${N}]`).forEach((Q)=>{if(Q.__sprucex)Q.__sprucex.destroy()});H.remove()}}}function u$(G,$){let Z=Array.from(G.attributes);for(let Y of Z)if(!$.hasAttribute(Y.name))G.removeAttribute(Y.name);let z=Array.from($.attributes);for(let Y of z)if(G.getAttribute(Y.name)!==Y.value)G.setAttribute(Y.name,Y.value)}var W$="SPRUCEX_DATA_FACTORY_NOT_READY",BG=Object.create(null);function f(G){if(!G||typeof G!=="string")return;return BG[G]}function NG(G,$){if(G&&typeof G==="object"&&!Array.isArray(G))return Object.entries(G).forEach(([Z,z])=>{NG(Z,z)}),BG;if(typeof G!=="string"||!G.trim())return;if(arguments.length===1)return f(G);return BG[G]=$,$}function CG(G){let $=String(G||"").trim();if(!$)return null;if(/^[A-Za-z_$][A-Za-z0-9_$]*(?:\.[A-Za-z_$][A-Za-z0-9_$]*)*$/.test($))return $;let z=$.match(/^([A-Za-z_$][A-Za-z0-9_$]*(?:\.[A-Za-z_$][A-Za-z0-9_$]*)*)\s*\(/);if(z)return z[1];return null}function K$(G){return!!CG(G)}function S$(G){if(!G||typeof G!=="string")return;let Z=typeof window!=="undefined"?window:globalThis;for(let z of G.split(".")){if(Z==null)return;Z=Z[z]}return Z}function L$(G,$=null){let Z=new Error(`SpruceX sx-data factory not ready: ${G}`);if(Z.code="SPRUCEX_DATA_FACTORY_NOT_READY",Z.rawExpr=G,$)Z.cause=$;return Z}var FG=new Map;function A$(G){if(typeof G!=="string"||!G.trim())throw new Error("SpruceX integration name must be a non-empty string.")}function v$(G){if(!G||typeof G!=="object")throw new Error("SpruceX integration must be an object.")}function a(G,$){return A$(G),v$($),FG.set(G,$),$}function l(G){return A$(G),FG.get(G)}function e(){return Array.from(FG.values())}class RG{constructor(G){this.root=G,this.bindings=[],this.memoBindings=[],this.eventHandlers=[],this.emitterHandlers=[],this.netBindings=[],this.modelBindings=[],this.chartBindings=[],this.gridBindings=[],this.forBlocks=[],this.pollTimers=[],this.debounceTimers=new Set,this.chartInstances=new Map,this.chartSnapshots=new WeakMap,this.gridInstances=new Map,this.requestUiState=new WeakMap,this.warnedMissingChart=!1,this.warnedMissingGridStack=!1,this.lastEvent=null,this.debug=!1,this.locals={},this.updatePending=!1,this.originalClasses=new WeakMap,this.animatedElements=new Map,this.refs={},this.emitter=document.createElement("div"),this.emit=($,Z)=>{let z=new CustomEvent($,{detail:Z,bubbles:!1});this.emitter.dispatchEvent(z)},this.initState(),this.collectRefs(),this.initIntegrationBindings(),this.setupDelegation(),this.scan(G),this.renderForBlocks(),this.applyInitialRender(),this.callHook("init"),queueMicrotask(()=>this.callHook("mounted"))}scheduleUpdate(){if(this.updatePending)return;this.updatePending=!0,this.rafId=requestAnimationFrame(()=>{this.updatePending=!1,this.rafId=null;let G=document.activeElement,$=G&&G.tagName==="INPUT"&&!["checkbox","radio","button","submit","reset","file","color","range","hidden"].includes((G.type||"text").toLowerCase()),z=G&&($||G.tagName==="TEXTAREA"||G.isContentEditable)&&this.root.contains(G)?G:null;this.renderForBlocks(z),this.updateBindings(),this.modelBindings.forEach((Y)=>Y.updateDom()),this.updateMemoBindings(),this.updateIntegrations()})}initState(){let G=(this.root.getAttribute(N)||"{}").trim(),$=(H)=>{let Q=u(H);if(Q&&M[H])M[H].add(this);return Q},Z,z=this.root.querySelector("script[sx-init-data]"),Y=/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(G);if(z&&Y)try{Z=JSON.parse(z.textContent.trim()||"{}")}catch(H){console.error("SpruceX sx-init-data JSON parse error:",H),Z={}}else{let H=CG(G),Q=H?f(H):void 0,q=H?S$(H):void 0,X=Q!==void 0?Q:q;try{if(H&&X!==void 0){let W=G.match(/^([A-Za-z_$][A-Za-z0-9_$]*(?:\.[A-Za-z_$][A-Za-z0-9_$]*)*)\s*\(([\s\S]*)\)$/);if(!!W&&W[1]===H&&typeof X==="function"){let S=W[2].trim(),P=S?new Function("$store","$data",`return [${S}];`)($,f):[];Z=X.apply(this.root,P)}else if(G===H&&typeof X==="function")Z=X.call(this.root);else if(G===H)Z=X;else Z=new Function("$store","$data",`return (${G});`)($,f)}else Z=new Function("$store","$data",`return (${G});`)($,f)}catch(W){if((W instanceof ReferenceError||/is not defined/.test(String(W&&W.message?W.message:"")))&&K$(G))throw L$(G,W);console.error("SpruceX sx-data parse error:",G,W),Z={}}}if(typeof Z==="function")try{Z=Z.call(this.root)}catch(H){console.error("SpruceX sx-data factory execution error:",G,H),Z={}}if(Z==null||typeof Z!=="object")Z={};let J=this.root.getAttribute(KG);if(J)try{let H=localStorage.getItem(J);if(H){let Q=JSON.parse(H);Object.assign(Z,Q)}}catch(H){console.error("SpruceX sx-local load error:",H)}Object.defineProperty(Z,"$emit",{value:this.emit,enumerable:!1}),Object.defineProperty(Z,"$store",{value:(H)=>{let Q=u(H);if(Q&&M[H])M[H].add(this);return Q},enumerable:!1});let{proxy:U}=P$(Z,()=>{if(J)try{localStorage.setItem(J,JSON.stringify(U))}catch(H){console.error("SpruceX sx-local save error:",H)}this.scheduleUpdate()});this.state=U}collectRefs(){this.refs={},this.root.querySelectorAll("[sx-ref]").forEach((G)=>{let $=G.getAttribute("sx-ref");if($)this.refs[$]=G})}setupDelegation(){ZG.forEach((G)=>{let $=(Z)=>this.handleDelegatedEvent(Z);if(this.root.addEventListener(G,$),!this._delegatedCleanups)this._delegatedCleanups=[];this._delegatedCleanups.push(()=>this.root.removeEventListener(G,$))})}handleDelegatedEvent(G){let $=G.target,Z=!1,z=G.stopPropagation;G.stopPropagation=function(){Z=!0,z.apply(this,arguments)};while($&&$.nodeType===1){if($.__sx_handlers&&$.__sx_handlers[G.type])$.__sx_handlers[G.type].forEach(({handler:Y,component:J})=>{if(J!==this)return;if(!Z)Y(G)});if(Z)break;if($===this.root)break;$=$.parentNode}}scan(G){let $=this;k(G,(Z)=>{if(Z!==G&&Z.hasAttribute(N))return!1;if(Z.tagName==="TEMPLATE"&&Z.hasAttribute(m)){let z=Z.getAttribute(m)||"",Y=Z.parentElement;if(!Y)return;let J=document.createComment("sx-for");Y.insertBefore(J,Z),Z.remove();let U=SG(z);if(!U){console.error("SpruceX invalid sx-for expression:",z);return}if($.forBlocks.push({template:Z,parent:Y,marker:J,expr:z,def:U,instances:[],autoAnimate:Y.hasAttribute(R)}),Y.hasAttribute(R)){let H=Y.getAttribute(R),Q={};if(H&&H!=="true"&&H!=="")try{Q=JSON.parse(H)}catch(q){let X=parseInt(H,10);if(!isNaN(X))Q={duration:X}}$.setupAutoAnimate(Y,Q)}}}),k(G,(Z)=>{if(Z.nodeType!==1)return;if(Z!==G&&Z.hasAttribute(N))return!1;if(Z.tagName==="TEMPLATE"&&Z.hasAttribute(m))return;this.scanElement(Z,null)}),this.setupNetworkBindings()}scanElement(G,$){let Z=this,z=G.hasAttribute(t),Y=G.getAttribute(d);if(Y&&!z)Z.bindings.push({el:G,type:"text",expr:Y,errorFallback:G.getAttribute(F),locals:$});let J=G.getAttribute(i);if(J&&!z)Z.bindings.push({el:G,type:"html",expr:J,errorFallback:G.getAttribute(F),locals:$});let U=G.getAttribute(_G);if(U)Z.bindings.push({el:G,type:"show",expr:U,errorFallback:G.getAttribute(F),locals:$});let H=G.getAttribute(VG);if(H){if(!Z.originalClasses.has(G))Z.originalClasses.set(G,new Set(Array.from(G.classList)));Z.bindings.push({el:G,type:"class",expr:H,errorFallback:G.getAttribute(F),locals:$})}let Q=G.getAttribute(fG);if(Q){let D=()=>{this.state[Q]=!this.state[Q]};G.addEventListener("click",D),Z.eventHandlers.push({el:G,event:"click",handler:D})}for(let D of Array.from(G.attributes))if(D.name.startsWith(s)){let S=D.name.slice(s.length);Z.bindings.push({el:G,type:"bind",attr:S,expr:D.value,errorFallback:G.getAttribute(F),locals:$})}let q=G.getAttribute(t),X=G.getAttribute(d),W=G.getAttribute(i);if(q&&(X||W)){let D=[];try{let P=new Function(`return (${q});`)();if(Array.isArray(P))D=P}catch(S){console.error("SpruceX sx-memo parse error:",q,S)}Z.memoBindings.push({el:G,expr:X||W,type:X?"text":"html",deps:D,lastVals:null,lastResult:null,locals:$})}this.setupModelBinding(G,$);for(let D of Array.from(G.attributes))if(D.name.startsWith(n)){let S=D.name.slice(n.length),[P,...K]=S.split("."),O=D.value,_=(V)=>{if(K.includes("prevent"))V.preventDefault();if(K.includes("stop"))V.stopPropagation();if(K.includes("self")&&V.target!==V.currentTarget)return;if(K.includes("window")&&V.target!==window)return;if(K.includes("document")&&V.target!==document)return;if(V instanceof KeyboardEvent){let L=K.filter((B)=>!["prevent","stop","self","window","document"].includes(B));if(L.length>0){let B=V.key.toLowerCase();if(!L.includes(B))return}}this.lastEvent=V;let A=this.locals;if($)this.locals=$;T(O,this),this.locals=A};if(ZG.has(P)){if(!G.__sx_handlers)G.__sx_handlers={};if(!G.__sx_handlers[P])G.__sx_handlers[P]=[];G.__sx_handlers[P].push({handler:_,component:this})}else G.addEventListener(P,_),Z.eventHandlers.push({el:G,event:P,handler:_})}if(!$){for(let D of EG){let S=`sx-${D}`,P=G.getAttribute(S);if(P){let K=G.getAttribute(yG)||(G.tagName==="FORM"?"submit":"click"),O=G.getAttribute(kG),_=G.getAttribute(hG)||null,V=G.getAttribute(bG)||"innerHTML",A=G.getAttribute(gG),L=G.getAttribute(pG),B=G.getAttribute(mG),C=G.getAttribute(uG),I=G.getAttribute(vG),c=G.getAttribute(cG),w=G.getAttribute(dG),HG=G.getAttribute(iG),p=G.getAttribute(sG),x=G.getAttribute(nG),w$=G.getAttribute(oG),x$=G.getAttribute(tG),f$=G.hasAttribute(rG),E$=G.getAttribute(aG),y$=G.getAttribute(lG),k$={el:G,method:D.toUpperCase(),urlTpl:P,trigger:K,triggerDebounce:O,target:_,swap:V,varsExpr:A,jsonInto:L,optimistic:B,revertOnError:C,poll:I?Number(I):null,pollWhile:c,includeSelector:w,bodyExpr:HG,bodyType:p,headersExpr:x,loadingInto:w$,errorInto:x$,disableWhileRequest:f$,textWhileRequest:E$,confirmExpr:y$};Z.netBindings.push(k$)}}this.scanIntegrations(G)}if(G.hasAttribute(R)){let D=G.getAttribute(R);queueMicrotask(()=>this.setupAutoAnimate(G,D||{}))}}setupModelBinding(G,$=null){let Z=G.getAttribute(PG),z=Array.from(G.attributes).filter((O)=>O.name.startsWith(o));if(!Z&&z.length===0)return;let Y=Z||z[0].value,J=new Set,U=null;z.forEach((O)=>{let _=O.name.slice(o.length);if(_.startsWith("debounce-ms"))U=Number(O.value||"200");else J.add(_)});let H=(G.type||"").toLowerCase(),Q=H==="checkbox",q=H==="radio",X=G.tagName==="SELECT",W=()=>{let O=this.locals;if($)this.locals=$;try{let _=j(Y,this);if(Q)if(Array.isArray(_))G.checked=_.includes(G.value);else G.checked=!!_;else if(q)G.checked=String(_)===String(G.value);else if(X)G.value=_??"";else if(_!==null&&_!==void 0&&typeof _==="object")G.value=JSON.stringify(_);else G.value=_??""}finally{this.locals=O}},D=(O)=>{if(J.has("trim")&&typeof O==="string")O=O.trim();if(J.has("number")){let _=Number(O);if(!Number.isNaN(_))O=_}return O},S=()=>{let O=this.locals;if($)this.locals=$;try{let _;if(Q){let V=j(Y,this);if(Array.isArray(V)){let A=[...V],L=A.indexOf(G.value);if(G.checked&&L===-1)A.push(G.value);if(!G.checked&&L!==-1)A.splice(L,1);_=A}else _=G.checked}else if(q){if(!G.checked)return;_=G.value}else if(X)_=G.value;else _=G.value;_=D(_),T(`${Y} = value`,this,{value:_})}finally{this.locals=O}},P="input";if(J.has("lazy"))P="change";let K=S;if(U!=null&&U>0){let O=null;K=()=>{clearTimeout(O),O=setTimeout(S,U)}}G.addEventListener(P,K),this.eventHandlers.push({el:G,event:P,handler:K}),this.modelBindings.push({updateDom:W,locals:$})}setupNetworkBindings(){for(let G of this.netBindings){let{el:$,poll:Z,pollWhile:z}=G,Y=this.parseNetworkTriggers(G),J=(U=null)=>{if(U){if(this.lastEvent=U,U.type==="submit")U.preventDefault()}if(!this.confirmRequest(G))return;this.performRequest(G)};if(Y.forEach(({eventName:U,debounceMs:H})=>{if(U==="load"){queueMicrotask(()=>J());return}let Q=this.wrapDebounced(J,H);$.addEventListener(U,Q),this.eventHandlers.push({el:$,event:U,handler:Q});let q=this.wrapDebounced(()=>this.performRequest(G),H);this.emitter.addEventListener(U,q),this.emitterHandlers.push({event:U,handler:q})}),Z&&!Number.isNaN(Z)&&Z>0){let U=setInterval(()=>{if(z){if(!j(z,this))return}this.performRequest(G)},Z);this.pollTimers.push(U)}}}parseNetworkTriggers(G){let $=Number(G.triggerDebounce),Z=Number.isFinite($)&&$>0?$:null,z=(G.trigger||"").trim(),Y=G.el.tagName==="FORM"?"submit":"click",J=(z||Y).split(",").flatMap((U)=>U.trim().split(/\s+/)).filter(Boolean);if(!J.length)return[{eventName:Y,debounceMs:Z}];return J.map((U)=>{let H=U.split("."),Q=H[0]||Y,q=Z,X=H.indexOf("debounce");if(X!==-1){let W=Number(H[X+1]);if(Number.isFinite(W)&&W>0)q=W}return{eventName:Q,debounceMs:q}})}wrapDebounced(G,$){if(!$||$<=0)return G;let Z=null;return(...z)=>{if(Z)clearTimeout(Z),this.debounceTimers.delete(Z);Z=setTimeout(()=>{this.debounceTimers.delete(Z),Z=null,G(...z)},$),this.debounceTimers.add(Z)}}confirmRequest(G){if(G.confirmExpr==null)return!0;if(typeof window==="undefined"||typeof window.confirm!=="function")return!0;let $=String(G.confirmExpr).trim(),Z=$||"Are you sure?";if($){let z=j($,this);if(typeof z==="string")Z=z;else if(z!==void 0&&z!==null)Z=String(z)}return window.confirm(Z)}setupAutoAnimate(G,$={}){let Z=YG();if(!Z)return null;if(typeof $==="string"&&$.trim())try{$=new Function(`return (${$})`)()}catch(J){console.error("SpruceX sx-animate options parse error:",J),$={}}let Y={...{duration:250,easing:"ease-in-out"},...$};try{let J=Z(G,Y);return this.animatedElements.set(G,J),J}catch(J){return console.error("SpruceX auto-animate error:",J),null}}disableAutoAnimate(G){let $=this.animatedElements.get(G);if($&&typeof $==="function")$.disable?.();this.animatedElements.delete(G)}buildUrl(G){let{urlTpl:$,varsExpr:Z}=G;if(!Z)return $;let z=j(Z,this)||{};try{return new Function("vars","with(vars){ return `"+$+"`; }")(z)}catch(Y){return console.error("SpruceX url template error:",$,Y),$}}buildBody(G){let{el:$,method:Z,includeSelector:z,bodyExpr:Y,bodyType:J}=G;if(!["POST","PUT","DELETE"].includes(Z))return{body:null,bodyKind:null};if(Y){let U=this.evaluateExpressionOrLiteral(Y),H=this.resolveBodyType(J,U);if(H==="json")return{body:typeof U==="string"?U:JSON.stringify(U??{}),bodyKind:"json"};if(H==="form"){let Q=this.toFormData(U);if(Q instanceof FormData&&z)this.appendIncludeData(Q,z);return{body:Q,bodyKind:"form"}}return{body:U??null,bodyKind:null}}if($.tagName==="FORM"){let U=new FormData($);if(z)this.appendIncludeData(U,z);if((J||"").toLowerCase()==="json")return{body:JSON.stringify(this.formDataToJson(U)),bodyKind:"json"};return{body:U,bodyKind:"form"}}return{body:null,bodyKind:null}}resolveBodyType(G,$){let Z=(G||"").toLowerCase();if(Z==="json"||Z==="form")return Z;if($ instanceof FormData||$ instanceof URLSearchParams)return"form";if($&&typeof $==="object"&&!($ instanceof Blob)&&!($ instanceof ArrayBuffer))return"json";return null}toFormData(G){if(G instanceof FormData)return G;if(G instanceof URLSearchParams){let Z=new FormData;return G.forEach((z,Y)=>Z.append(Y,z)),Z}let $=new FormData;if(G==null)return $;if(typeof G==="string"){let Z=new URLSearchParams(G),z=!1;if(Z.forEach((Y,J)=>{$.append(J,Y),z=!0}),!z)$.append("value",G);return $}if(typeof G!=="object")return $.append("value",String(G)),$;return Object.entries(G).forEach(([Z,z])=>{this.appendFormValue($,Z,z)}),$}appendFormValue(G,$,Z){if(Array.isArray(Z)){Z.forEach((z)=>this.appendFormValue(G,$,z));return}if(Z instanceof Blob){G.append($,Z);return}if(Z&&typeof Z==="object"){G.append($,JSON.stringify(Z));return}G.append($,Z==null?"":String(Z))}appendIncludeData(G,$){document.querySelectorAll($).forEach((Z)=>{if(Z.tagName==="FORM"){new FormData(Z).forEach((z,Y)=>G.append(Y,z));return}if(this.appendElementValue(G,Z),Z.querySelectorAll)Z.querySelectorAll("input[name], select[name], textarea[name]").forEach((z)=>this.appendElementValue(G,z))})}appendElementValue(G,$){if(!("name"in $)||!$.name)return;if("disabled"in $&&$.disabled)return;let Z=($.type||"").toLowerCase();if((Z==="checkbox"||Z==="radio")&&!$.checked)return;if($.tagName==="SELECT"&&$.multiple){Array.from($.selectedOptions||[]).forEach((z)=>G.append($.name,z.value));return}G.append($.name,$.value??"")}formDataToJson(G){let $={};return G.forEach((Z,z)=>{let Y=Z instanceof File?Z.name:Z;if(z in $)if(Array.isArray($[z]))$[z].push(Y);else $[z]=[$[z],Y];else $[z]=Y}),$}buildHeaders(G,$,Z){let z=new Headers,Y=G.headersExpr?j(G.headersExpr,this):void 0;if(Y instanceof Headers)Y.forEach((J,U)=>z.set(U,J));else if(Array.isArray(Y))Y.forEach((J)=>{if(Array.isArray(J)&&J.length>=2)z.set(String(J[0]),String(J[1]))});else if(Y&&typeof Y==="object")Object.entries(Y).forEach(([J,U])=>{if(U!=null)z.set(J,String(U))});if($==="json"&&Z&&!z.has("Content-Type"))z.set("Content-Type","application/json");return z}evaluateExpressionOrLiteral(G){let $=String(G??"").trim();if(!$)return"";let Z=j($,this);return Z===void 0?$:Z}assignStateValue(G,$){if(!G)return;T(`${G} = __sx_value`,this,{__sx_value:$})}serializeError(G){if(!G)return null;if(typeof G==="string")return{message:G};return{name:G.name||"Error",message:G.message||String(G),status:G.status}}beginRequestUiState(G){let{el:$,disableWhileRequest:Z,textWhileRequest:z}=G;if(!Z&&z==null)return()=>{};let Y=this.requestUiState.get($)||{count:0,restoreFns:[]};if(Y.count===0)Y.restoreFns=this.applyRequestUiState(G);return Y.count+=1,this.requestUiState.set($,Y),()=>{let J=this.requestUiState.get($);if(!J)return;if(J.count-=1,J.count<=0)J.restoreFns.forEach((U)=>U()),this.requestUiState.delete($);else this.requestUiState.set($,J)}}applyRequestUiState(G){let $=[],{el:Z,disableWhileRequest:z,textWhileRequest:Y}=G;if(z)this.getDisableTargets(Z).forEach((J)=>{let U=!!J.disabled;J.disabled=!0,$.push(()=>{J.disabled=U})});if(Y!=null){let J=this.getTextWhileRequestTarget(Z);if(J){let U=String(this.evaluateExpressionOrLiteral(Y));if(J.tagName==="INPUT"){let H=J.value;J.value=U,$.push(()=>{J.value=H})}else{let H=J.textContent;J.textContent=U,$.push(()=>{J.textContent=H})}}}return $}getDisableTargets(G){if(G.tagName==="FORM")return Array.from(G.elements||[]).filter(($)=>$&&("disabled"in $)&&$.type!=="hidden");return"disabled"in G?[G]:[]}getTextWhileRequestTarget(G){if(G.tagName!=="FORM")return G;return G.querySelector("button[type='submit']")||G.querySelector("button:not([type])")||G.querySelector("input[type='submit']")}clearDebounceTimers(){this.debounceTimers.forEach((G)=>clearTimeout(G)),this.debounceTimers.clear()}clearEmitterHandlers(){this.emitterHandlers.forEach(({event:G,handler:$})=>{this.emitter.removeEventListener(G,$)}),this.emitterHandlers=[]}initIntegrationBindings(){e().forEach((G)=>{if(typeof G.setup!=="function")return;try{G.setup(this)}catch($){console.error("SpruceX integration setup error:",$)}})}scanIntegrations(G){e().forEach(($)=>{if(typeof $.scan!=="function")return;try{$.scan(this,G)}catch(Z){console.error("SpruceX integration scan error:",Z)}})}updateIntegrations(){e().forEach((G)=>{if(typeof G.update!=="function")return;try{G.update(this)}catch($){console.error("SpruceX integration update error:",$)}})}teardownIntegrations(){e().forEach((G)=>{if(typeof G.teardown!=="function")return;try{G.teardown(this)}catch($){console.error("SpruceX integration teardown error:",$)}})}async performRequest(G){let $=this.buildUrl(G),{body:Z,bodyKind:z}=this.buildBody(G),Y=this.buildHeaders(G,z,Z!=null),{el:J,method:U,target:H,swap:Q,jsonInto:q,optimistic:X,revertOnError:W,loadingInto:D,errorInto:S}=G,P=this.beginRequestUiState(G);if(this.assignStateValue(D,!0),this.assignStateValue(S,null),X)T(X,this);try{let K={method:U};if(Z!=null)K.body=Z;if(Array.from(Y.keys()).length>0)K.headers=Y;let O=await fetch($,K);if(!O.ok)throw new Error(`HTTP ${O.status}: ${O.statusText}`);let _=await O.text(),V=null;if(q&&_.trim().length)try{V=JSON.parse(_)}catch(L){console.error("SpruceX JSON parse error:",L)}if(q&&V!=null)T(`${q} = value`,this,{value:V});else this.applySwap(H||J,_,Q);let A={response:O,text:_,json:V};J.dispatchEvent(new CustomEvent("success",{detail:A,bubbles:!0})),J.dispatchEvent(new CustomEvent("sprucex:success",{detail:A,bubbles:!0}))}catch(K){if(W)T(W,this);this.assignStateValue(S,this.serializeError(K));let O={error:K};J.dispatchEvent(new CustomEvent("error",{detail:O,bubbles:!0})),J.dispatchEvent(new CustomEvent("sprucex:error",{detail:O,bubbles:!0}))}finally{this.assignStateValue(D,!1),P()}}getChartConstructor(){if(typeof window==="undefined")return null;let G=window.Chart;return G&&typeof G==="object"?G.Chart||G:G}updateChartBindings(){this.chartBindings.forEach((G)=>this.syncChartBinding(G))}syncChartBinding(G){let{el:$,chartExpr:Z,chartTypeExpr:z,chartOptionsExpr:Y}=G;if(!$.isConnected){this.destroyChartInstance($);return}let J=j(Z,this);if(J==null){this.destroyChartInstance($);return}let U=this.getChartConstructor();if(!U){if(!this.warnedMissingChart)this.warnedMissingChart=!0,console.warn("SpruceX: sx-chart requires Chart.js to be loaded on window.Chart.");return}let Q=this.getChartCanvas($)?.getContext?.("2d");if(!Q)return;let q=z!=null?this.evaluateExpressionOrLiteral(z):null,X=Y!=null?this.evaluateExpressionOrLiteral(Y):null,W=J&&typeof J==="object"&&"data"in J?J.data:J,D=typeof q==="string"&&q.trim()||(J&&typeof J==="object"?J.type:null)||"line",S=X&&typeof X==="object"?X:J&&typeof J==="object"&&J.options&&typeof J.options==="object"?J.options:{},P=this.cloneChartConfigValue(W),K=this.cloneChartConfigValue(S),O=this.chartInstances.get($);if(O&&O.config?.type!==D)O.destroy(),this.chartInstances.delete($),O=null;if(!O){O=new U(Q,{type:D,data:P,options:K}),this.chartInstances.set($,O),this.chartSnapshots.set($,{type:D,data:P,options:K});return}let _=this.chartSnapshots.get($),V={type:D,data:P,options:K};if(_&&this.areChartValuesEqual(_,V))return;O.data=P,O.options=K,O.update(),this.chartSnapshots.set($,V)}cloneChartConfigValue(G,$=new WeakMap){if(G==null||typeof G!=="object")return G;if($.has(G))return $.get(G);if(Array.isArray(G)){let Y=[];return $.set(G,Y),G.forEach((J)=>Y.push(this.cloneChartConfigValue(J,$))),Y}let Z=Object.getPrototypeOf(G);if(Z!==Object.prototype&&Z!==null)return G;let z={};return $.set(G,z),Object.keys(G).forEach((Y)=>{z[Y]=this.cloneChartConfigValue(G[Y],$)}),z}areChartValuesEqual(G,$,Z=new WeakMap){if(Object.is(G,$))return!0;if(typeof G!==typeof $)return!1;if(G==null||$==null)return!1;if(typeof G!=="object")return!1;let z=Z.get(G);if(z&&z.has($))return!0;if(z)z.add($);else Z.set(G,new WeakSet([$]));if(Array.isArray(G)){if(!Array.isArray($)||G.length!==$.length)return!1;for(let Q=0;Q<G.length;Q+=1)if(!this.areChartValuesEqual(G[Q],$[Q],Z))return!1;return!0}if(Array.isArray($))return!1;let Y=Object.getPrototypeOf(G),J=Object.getPrototypeOf($);if(Y!==J)return!1;if(Y!==Object.prototype&&Y!==null)return!1;let U=Object.keys(G),H=Object.keys($);if(U.length!==H.length)return!1;for(let Q=0;Q<U.length;Q+=1){let q=U[Q];if(!Object.prototype.hasOwnProperty.call($,q))return!1;if(!this.areChartValuesEqual(G[q],$[q],Z))return!1}return!0}getChartCanvas(G){if(G.tagName==="CANVAS")return G;let $=G.querySelector("canvas");if($)return $;let Z=document.createElement("canvas");return G.appendChild(Z),Z}destroyChartInstance(G){let $=this.chartInstances.get(G);if(!$)return;try{$.destroy()}catch(Z){console.error("SpruceX sx-chart destroy error:",Z)}this.chartInstances.delete(G),this.chartSnapshots.delete(G)}teardownChartBindings(){this.chartInstances.forEach((G,$)=>this.destroyChartInstance($)),this.chartInstances.clear()}initGridBindings(){this.gridBindings.forEach((G)=>{let{el:$}=G;if(!$.isConnected||this.gridInstances.has($))return;if(typeof window==="undefined"||!window.GridStack||typeof window.GridStack.init!=="function"){if(!this.warnedMissingGridStack)this.warnedMissingGridStack=!0,console.warn("SpruceX: sx-gridstack requires GridStack on window.GridStack.");return}let Z=this.buildGridOptions(G),z=window.GridStack.init(Z,$),Y=[],J=(U,H)=>{if(!H)return;let Q=(q,X=[])=>{let W=this.serializeGridNodes(X);this.assignStateValue(H,W),$.dispatchEvent(new CustomEvent(`sprucex:gridstack:${U}`,{detail:W,bubbles:!0}))};z.on(U,Q),Y.push(()=>{if(typeof z.off==="function")z.off(U,Q)})};J("change",G.onChangeInto),J("added",G.onAddedInto),J("removed",G.onRemovedInto),J("dragstop",G.onDragstopInto),J("resizestop",G.onResizestopInto),this.gridInstances.set($,{grid:z,cleanups:Y})})}buildGridOptions(G){let $={},{el:Z,gridExpr:z,gridOptionsExpr:Y}=G;if(z&&z.trim()&&z.trim()!=="true"){let J=j(z,this);if(J&&typeof J==="object"&&!Array.isArray(J))Object.assign($,J)}if(Y){let J=j(Y,this);if(J&&typeof J==="object"&&!Array.isArray(J))Object.assign($,J)}return Array.from(Z.attributes).filter((J)=>J.name.startsWith(XG)).forEach((J)=>{let U=J.name.slice(XG.length);if(!U)return;let H=U.replace(/-([a-z])/g,(Q,q)=>q.toUpperCase());$[H]=this.parseGridOptionValue(J.value)}),$}parseGridOptionValue(G){let $=String(G||"").trim();if(!$)return!0;if($==="true")return!0;if($==="false")return!1;let Z=Number($);if(Number.isFinite(Z))return Z;let z=j($,this);return z===void 0?$:z}serializeGridNodes(G){if(!Array.isArray(G))return[];return G.map(($)=>({id:$?.id??$?.el?.id??null,x:$?.x,y:$?.y,w:$?.w,h:$?.h,minW:$?.minW,minH:$?.minH,maxW:$?.maxW,maxH:$?.maxH}))}teardownGridBindings(){this.gridInstances.forEach(({grid:G,cleanups:$})=>{if($.forEach((Z)=>Z()),G&&typeof G.destroy==="function")G.destroy(!1)}),this.gridInstances.clear()}applySwap(G,$,Z){let z=typeof G==="string"?document.querySelector(G):G;if(!z)return;switch(Z){case"outerHTML":z.outerHTML=$;break;case"before":z.insertAdjacentHTML("beforebegin",$);break;case"after":z.insertAdjacentHTML("afterend",$);break;case"prepend":z.insertAdjacentHTML("afterbegin",$);break;case"append":z.insertAdjacentHTML("beforeend",$);break;case"morph":{let U=new DOMParser().parseFromString(`<div>${$}</div>`,"text/html").body.firstChild;if(U)v(z,U);break}case"id-map":{let U=new DOMParser().parseFromString(`<div>${$}</div>`,"text/html").body.firstChild;if(U)v(z,U);break}case"innerHTML":default:z.innerHTML=$}}isForBlockDetached(G){if(!G)return!0;let{parent:$,marker:Z}=G;if(!$||!Z)return!0;if(!$.isConnected||!Z.isConnected)return!0;if(Z.parentNode!==$)return!0;return!1}teardownForBlock(G){if(!G)return;if((Array.isArray(G.instances)?[...G.instances]:[]).forEach((z)=>{if(z.elements)z.elements.forEach((Y)=>Y.remove());else if(z.fragmentRoot)z.fragmentRoot.remove();this.cleanupInstanceBindings(z.bindings)}),G.instances)G.instances.length=0;let Z=this.forBlocks.indexOf(G);if(Z!==-1)this.forBlocks.splice(Z,1)}teardownDetachedForBlocks(){this.forBlocks.slice().forEach((G)=>{if(this.isForBlockDetached(G))this.teardownForBlock(G)})}teardownAllForBlocks(){this.forBlocks.slice().forEach((G)=>this.teardownForBlock(G)),this.forBlocks=[]}renderForBlocks(G=null){this.teardownDetachedForBlocks();let $=0;while($<this.forBlocks.length){let Z=this.forBlocks[$];if(!Z){$+=1;continue}if(this.isForBlockDetached(Z)){this.teardownForBlock(Z);continue}let{def:z,template:Y,parent:J,marker:U,instances:H,parentLocals:Q}=Z;if(G&&Z.instances.some((_)=>_.elements&&_.elements.some((V)=>V.contains(G)))){$+=1;continue}let X=this.locals;if(Q)this.locals=Q;let W=j(z.iterable,this)||[],D=Array.from(W);this.locals=X;let S=new Map;H.forEach((_)=>{let V=_.itemKey;if(V!==void 0)S.set(V,_)});let P=[],K=new Set;for(let _=0;_<D.length;_++){let V=D[_],A=z.index||"$index",L=V;if(typeof V==="object"&&V!==null)L=V;let B=S.get(L);if(B&&!K.has(L))K.add(L),B.scopeLocals[A]=_,P.push(B);else{let C=Q?{...Q}:{};C[z.item]=V,C[A]=_;let I=Y.content?Y.content.cloneNode(!0):_$(Y),c=[];while(I.firstChild){let p=I.firstChild;c.push(p),I.removeChild(p)}let w={bindings:[],memoBindings:[],modelBindings:[],eventHandlers:[],nestedForBlocks:[]};c.forEach((p)=>{let x=this.scanFragmentBindings(p,C);if(w.bindings.push(...x.bindings),w.memoBindings.push(...x.memoBindings),w.modelBindings.push(...x.modelBindings),w.eventHandlers.push(...x.eventHandlers),x.nestedForBlocks)w.nestedForBlocks.push(...x.nestedForBlocks)});let HG={scopeLocals:C,elements:c,bindings:w,itemKey:L};P.push(HG),K.add(L)}}H.forEach((_)=>{if(!K.has(_.itemKey)){if(_.elements)_.elements.forEach((V)=>V.remove());else if(_.fragmentRoot)_.fragmentRoot.remove();this.cleanupInstanceBindings(_.bindings)}});let O=U;for(let _=P.length-1;_>=0;_--){let V=P[_];if(V.elements.forEach((A)=>{J.insertBefore(A,O)}),V.elements.length>0)O=V.elements[0]}Z.instances.length=0,Z.instances.push(...P),$+=1}}scanFragmentBindings(G,$){let Z=this,z={bindings:[],memoBindings:[],modelBindings:[],eventHandlers:[],nestedForBlocks:[]};return k(G,(Y)=>{if(Y.nodeType!==1)return;if(Y.hasAttribute(N))return!1;if(Y.tagName==="TEMPLATE"&&Y.hasAttribute(m)){let P=Y.getAttribute(m)||"",K=Y.parentElement;if(!K)return;let O=document.createComment("sx-for");K.insertBefore(O,Y),Y.remove();let _=SG(P);if(!_)return console.error("SpruceX invalid nested sx-for expression:",P),!1;let V={template:Y,parent:K,marker:O,expr:P,def:_,instances:[],parentLocals:$,autoAnimate:K.hasAttribute(R)};if(Z.forBlocks.push(V),z.nestedForBlocks.push(V),K.hasAttribute(R)){let A=K.getAttribute(R),L={};if(A&&A!=="true"&&A!=="")try{L=JSON.parse(A)}catch(B){let C=parseInt(A,10);if(!isNaN(C))L={duration:C}}Z.setupAutoAnimate(K,L)}return!1}let J=Y.hasAttribute(t),U=Y.getAttribute(d);if(U&&!J){let P={el:Y,type:"text",expr:U,errorFallback:Y.getAttribute(F),locals:$};Z.bindings.push(P),z.bindings.push(P)}let H=Y.getAttribute(i);if(H&&!J){let P={el:Y,type:"html",expr:H,errorFallback:Y.getAttribute(F),locals:$};Z.bindings.push(P),z.bindings.push(P)}let Q=Y.getAttribute(_G);if(Q){let P={el:Y,type:"show",expr:Q,errorFallback:Y.getAttribute(F),locals:$};Z.bindings.push(P),z.bindings.push(P)}let q=Y.getAttribute(VG);if(q){if(!Z.originalClasses.has(Y))Z.originalClasses.set(Y,new Set(Array.from(Y.classList)));let P={el:Y,type:"class",expr:q,errorFallback:Y.getAttribute(F),locals:$};Z.bindings.push(P),z.bindings.push(P)}for(let P of Array.from(Y.attributes))if(P.name.startsWith(s)){let K=P.name.slice(s.length),O={el:Y,type:"bind",attr:K,expr:P.value,errorFallback:Y.getAttribute(F),locals:$};Z.bindings.push(O),z.bindings.push(O)}let X=Y.getAttribute(t),W=Y.getAttribute(d),D=Y.getAttribute(i);if(X&&(W||D)){let P=[];try{let _=new Function(`return (${X});`)();if(Array.isArray(_))P=_}catch(O){console.error("SpruceX sx-memo parse error:",X,O)}let K={el:Y,expr:W||D,type:W?"text":"html",deps:P,lastVals:null,lastResult:null,locals:$};Z.memoBindings.push(K),z.memoBindings.push(K)}let S=this.setupModelBindingWithReturn(Y,$);if(S)z.modelBindings.push(S);for(let P of Array.from(Y.attributes))if(P.name.startsWith(n)){let K=P.name.slice(n.length),[O,..._]=K.split("."),V=P.value,A=(L)=>{if(_.includes("prevent"))L.preventDefault();if(_.includes("stop"))L.stopPropagation();if(_.includes("self")&&L.target!==L.currentTarget)return;if(_.includes("window")&&L.target!==window)return;if(_.includes("document")&&L.target!==document)return;if(L instanceof KeyboardEvent){let C=_.filter((I)=>!["prevent","stop","self","window","document"].includes(I));if(C.length>0){let I=L.key.toLowerCase();if(!C.includes(I))return}}this.lastEvent=L;let B=this.locals;this.locals=$,T(V,this),this.locals=B};if(ZG.has(O)){if(!Y.__sx_handlers)Y.__sx_handlers={};if(!Y.__sx_handlers[O])Y.__sx_handlers[O]=[];Y.__sx_handlers[O].push({handler:A,component:this})}else Y.addEventListener(O,A),Z.eventHandlers.push({el:Y,event:O,handler:A}),z.eventHandlers.push({el:Y,event:O,handler:A})}if(Y.hasAttribute(R)){let P=Y.getAttribute(R);queueMicrotask(()=>this.setupAutoAnimate(Y,P||{}))}}),z}setupModelBindingWithReturn(G,$=null){let Z=G.getAttribute(PG),z=Array.from(G.attributes).filter((_)=>_.name.startsWith(o));if(!Z&&z.length===0)return null;let Y=Z||z[0].value,J=new Set,U=null;z.forEach((_)=>{let V=_.name.slice(o.length);if(V.startsWith("debounce-ms"))U=Number(_.value||"200");else J.add(V)});let H=(G.type||"").toLowerCase(),Q=H==="checkbox",q=H==="radio",X=G.tagName==="SELECT",W=()=>{let _=this.locals;if($)this.locals=$;try{let V=j(Y,this);if(Q)if(Array.isArray(V))G.checked=V.includes(G.value);else G.checked=!!V;else if(q)G.checked=String(V)===String(G.value);else if(X)G.value=V??"";else if(V!==null&&V!==void 0&&typeof V==="object")G.value=JSON.stringify(V);else G.value=V??""}finally{this.locals=_}},D=(_)=>{if(J.has("trim")&&typeof _==="string")_=_.trim();if(J.has("number")){let V=Number(_);if(!Number.isNaN(V))_=V}return _},S=()=>{let _=this.locals;if($)this.locals=$;try{let V;if(Q){let A=j(Y,this);if(Array.isArray(A)){let L=[...A],B=L.indexOf(G.value);if(G.checked&&B===-1)L.push(G.value);if(!G.checked&&B!==-1)L.splice(B,1);V=L}else V=G.checked}else if(q){if(!G.checked)return;V=G.value}else if(X)V=G.value;else V=G.value;V=D(V),T(`${Y} = value`,this,{value:V})}finally{this.locals=_}},P="input";if(J.has("lazy"))P="change";let K=S;if(U!=null&&U>0){let _=null;K=()=>{clearTimeout(_),_=setTimeout(S,U)}}G.addEventListener(P,K);let O={updateDom:W,locals:$,el:G,event:P,handler:K};return this.eventHandlers.push({el:G,event:P,handler:K}),this.modelBindings.push(O),O}cleanupInstanceBindings(G){if(!G)return;(G.bindings||[]).forEach(($)=>{let Z=this.bindings.indexOf($);if(Z!==-1)this.bindings.splice(Z,1)}),(G.memoBindings||[]).forEach(($)=>{let Z=this.memoBindings.indexOf($);if(Z!==-1)this.memoBindings.splice(Z,1)}),(G.modelBindings||[]).forEach(($)=>{let Z=this.modelBindings.indexOf($);if(Z!==-1)this.modelBindings.splice(Z,1)}),(G.eventHandlers||[]).forEach(({el:$,event:Z,handler:z})=>{$.removeEventListener(Z,z);let Y=this.eventHandlers.findIndex((J)=>J.el===$&&J.event===Z&&J.handler===z);if(Y!==-1)this.eventHandlers.splice(Y,1)}),G.nestedForBlocks?.forEach(($)=>{this.teardownForBlock($)})}applyInitialRender(){this.updateBindings(),this.modelBindings.forEach((G)=>G.updateDom()),this.updateMemoBindings(),this.updateIntegrations()}updateBindings(){for(let G of this.bindings){let{el:$,type:Z,expr:z,attr:Y,errorFallback:J,locals:U}=G,H=this.locals;if(U)this.locals=U;try{switch(Z){case"text":{let Q=j(z,this,J);if(Q!==null&&Q!==void 0&&typeof Q==="object")$.textContent=JSON.stringify(Q);else $.textContent=Q??"";break}case"html":{let Q=j(z,this,J);if(Q!==null&&Q!==void 0&&typeof Q==="object")$.innerHTML=JSON.stringify(Q);else $.innerHTML=Q??"";break}case"show":{let Q=!!j(z,this,J);$.style.display=Q?"":"none";break}case"bind":{let Q=j(z,this,J);if(Q===!1||Q===null||Q===void 0)$.removeAttribute(Y);else $.setAttribute(Y,Q);break}case"class":{let Q=j(z,this,J),q=this.originalClasses.get($)||new Set,X=new Set(Array.from($.classList));if(typeof Q==="string"){let W=new Set(Q.split(/\s+/).filter(Boolean));X.forEach((D)=>{if(!q.has(D))$.classList.remove(D)}),W.forEach((D)=>$.classList.add(D))}else if(Q&&typeof Q==="object")Object.keys(Q).forEach((W)=>{W.split(/\s+/).filter(Boolean).forEach((D)=>{if(Q[W])$.classList.add(D);else $.classList.remove(D)})});break}}}finally{this.locals=H}}}updateMemoBindings(){this.memoBindings.forEach((G)=>{let{el:$,expr:Z,type:z,deps:Y,locals:J}=G,U=this.locals;if(J)this.locals=J;try{let H=Y.map((q)=>{if(J&&q in J)return J[q];if(q in this.state)return this.state[q];return this.state[q]});if(G.lastVals&&G.lastVals.length===H.length&&G.lastVals.every((q,X)=>q===H[X]))return;G.lastVals=H;let Q=j(Z,this);if(G.lastResult=Q,z==="text")$.textContent=Q??"";else $.innerHTML=Q??""}finally{this.locals=U}})}callHook(G){let $=this.state&&this.state[G];if(typeof $==="function")try{$.call(this.state)}catch(Z){console.error(`SpruceX ${G}() hook error:`,Z)}}refresh(){this.teardownIntegrations(),this.clearDebounceTimers(),this.clearEmitterHandlers(),this.teardownAllForBlocks(),this.bindings=[],this.memoBindings=[],this.modelBindings=[],this.netBindings=[],this.chartBindings=[],this.gridBindings=[],this.forBlocks=[],this.eventHandlers.forEach(({el:G,event:$,handler:Z})=>{G.removeEventListener($,Z)}),this.eventHandlers=[],k(this.root,(G)=>{if(G!==this.root&&G.hasAttribute(N))return!1;if(G.__sx_handlers)delete G.__sx_handlers}),this.animatedElements.forEach((G,$)=>{this.disableAutoAnimate($)}),this.animatedElements.clear(),this.pollTimers.forEach((G)=>clearInterval(G)),this.pollTimers=[],this.collectRefs(),this.scan(this.root),this.renderForBlocks(),this.applyInitialRender()}destroy(){if(this.callHook("destroyed"),Object.keys(M).forEach((G)=>{M[G].delete(this)}),this.animatedElements.forEach((G,$)=>{this.disableAutoAnimate($)}),this.animatedElements.clear(),this.teardownIntegrations(),this.teardownAllForBlocks(),this.eventHandlers.forEach(({el:G,event:$,handler:Z})=>{G.removeEventListener($,Z)}),this.clearEmitterHandlers(),this._delegatedCleanups)this._delegatedCleanups.forEach((G)=>G());if(this.pollTimers.forEach((G)=>clearInterval(G)),this.clearDebounceTimers(),this.rafId)cancelAnimationFrame(this.rafId);this.bindings=[],this.memoBindings=[],this.modelBindings=[],this.eventHandlers=[],this.chartBindings=[],this.gridBindings=[],this.netBindings=[],this.forBlocks=[],this.pollTimers=[],delete this.root.__sprucex}}function j$(){if(!l("chart"))a("chart",{scan(G,$){let Z=$.getAttribute(eG);if(!Z)return;G.chartBindings.push({el:$,chartExpr:Z,chartTypeExpr:$.getAttribute(G$),chartOptionsExpr:$.getAttribute($$)})},update(G){G.updateChartBindings()},teardown(G){G.teardownChartBindings()}});if(!l("gridstack"))a("gridstack",{scan(G,$){if(!$.hasAttribute(DG))return;G.gridBindings.push({el:$,gridExpr:$.getAttribute(DG),gridOptionsExpr:$.getAttribute(Z$),onChangeInto:$.getAttribute(Y$),onAddedInto:$.getAttribute(z$),onRemovedInto:$.getAttribute(J$),onDragstopInto:$.getAttribute(U$),onResizestopInto:$.getAttribute(H$)})},update(G){G.initGridBindings()},teardown(G){G.teardownGridBindings()}})}var UG=new Map,zG=new Map,c$=30000,g=new Set,IG=!1,GG=null;j$();function d$(){if(GG||g.size===0)return;GG=setInterval(()=>{E()},100)}function E(){if(g.forEach((G)=>{if(!G||!G.isConnected||G.__sprucex){g.delete(G);return}if(TG(G))g.delete(G)}),g.size===0&&GG)clearInterval(GG),GG=null}function i$(G){if(!G||G.__sprucex)return;let $=g.has(G);if(g.add(G),d$(),$||IG)return;IG=!0,queueMicrotask(()=>{IG=!1,E()})}function s$(){if(typeof document==="undefined")return;document.querySelectorAll(`[${N}]`).forEach((G)=>{if(G.__sprucex&&typeof G.__sprucex.refresh==="function")G.__sprucex.refresh()})}var F$={init:$G,store:V$,data(G,$){if(arguments.length===1&&typeof G==="string")return f(G);let Z=NG(G,$);return E(),Z},inspect(){let G=document.querySelectorAll(`[${N}]`);return Array.from(G).map(($)=>({el:$,state:$.__sprucex?.state||null}))},config(G){},navigate(G){let Z=document.querySelector(`[${y}]`)?.getAttribute(y),z=Z?document.querySelector(Z):document.body;return wG(G,z)},prefetch(G){return JG(G)},clearCache(){UG.clear()},morph(G,$){if(typeof G==="string")G=document.querySelector(G);if(typeof $==="string")$=new DOMParser().parseFromString(`<div>${$}</div>`,"text/html").body.firstChild;if(G&&$)v(G,$)},animate(G,$={}){if(typeof G==="string")G=document.querySelector(G);if(!G)return null;let Z=YG();if(!Z)return console.warn("SpruceX: auto-animate library not found. Include it via script tag or npm."),null;return Z(G,$)},setAutoAnimate:O$,integration(G,$){if(arguments.length===1&&typeof G==="string")return l(G);let Z=a(G,$);return s$(),Z}};if(typeof window!=="undefined"){if(window.SpruceX=F$,!window.SpruceXBoot)window.SpruceXBoot={}}var B$=!1;function R$(){if(B$||typeof window==="undefined")return;B$=!0;let G=window.SpruceXBoot;if(G&&typeof G.initTheme==="function")try{G.initTheme()}catch($){console.error("SpruceX boot hook error:",$)}}function TG(G){if(G.__sprucex)return G.__sprucex;try{let $=new RG(G);return G.__sprucex=$,$}catch($){if($&&$.code===W$)return i$(G),null;return console.error("SpruceX component init error:",$),null}}function $G(){R$(),document.querySelectorAll(`[${N}]`).forEach((Z)=>{if(!Z.hasAttribute(WG))TG(Z);else{let Y=new IntersectionObserver((J)=>{J.forEach((U)=>{if(U.isIntersecting)TG(Z),Y.disconnect()})});Y.observe(Z)}});let $=document.querySelector(`[${y}]`);if($&&!$.__sprucex_page)$.__sprucex_page=!0,o$($);I$(),n$(),E(),Array.from(document.scripts).forEach((Z)=>{Z.__sprucex_executed=!0})}var MG=null;function n$(){if(MG)return;if(MG=new MutationObserver((G)=>{for(let $ of G)$.removedNodes.forEach((Z)=>{if(Z.nodeType!==1)return;if(Z.__sprucex)Z.__sprucex.destroy();Z.querySelectorAll(`[${N}]`).forEach((z)=>{if(z.__sprucex)z.__sprucex.destroy()})})}),document.body)MG.observe(document.body,{childList:!0,subtree:!0})}var N$=!1;function o$(G){let $=G.getAttribute(y);if($===null)return;let Z=$?document.querySelector($):document.body;if(!Z){console.error("SpruceX sx-page target not found:",$);return}if(N$)return;N$=!0,document.addEventListener("click",async(z)=>{let Y=z.target.closest("a[href]");if(!Y)return;let J=Y.getAttribute("href");if(!J||J.startsWith("#")||J.startsWith("javascript:"))return;if(Y.hasAttribute("download")||Y.getAttribute("target")==="_blank")return;try{let U=new URL(J,window.location.origin);if(U.origin!==window.location.origin)return;z.preventDefault(),await wG(U.href,Z)}catch{return}}),window.addEventListener("popstate",async()=>{await wG(window.location.href,Z,!1)})}function I$(){document.querySelectorAll(`[${OG}]`).forEach((G)=>{if(G.__sprucex_boost)return;G.__sprucex_boost=!0;let Z=(G.getAttribute(qG)||"mouseenter").split(/\s+/);if(G.tagName==="A")Z.forEach((z)=>{G.addEventListener(z,()=>JG(G.href),{passive:!0,once:!0})});else Z.forEach((z)=>{G.addEventListener(z,(Y)=>{let J=Y.target.closest("a[href]");if(J&&!J.__sprucex_prefetched)J.__sprucex_prefetched=!0,JG(J.href)},{passive:!0})}),G.addEventListener("focusin",(z)=>{let Y=z.target.closest("a[href]");if(Y&&!Y.__sprucex_prefetched)Y.__sprucex_prefetched=!0,JG(Y.href)},{passive:!0})})}async function wG(G,$,Z=!0){let z=performance.now(),Y=new CustomEvent("sprucex:page-before",{detail:{url:G},bubbles:!0,cancelable:!0});if(!document.dispatchEvent(Y))return;try{let J=T$(G);if(!J){if($)$.style.opacity=$.style.opacity||"1";J=await M$(G)}if(!J)throw new Error("Empty response");let H=new DOMParser().parseFromString(J,"text/html"),Q,X=document.querySelector("[sx-page]")?.getAttribute(y);if(X)Q=H.querySelector(X);if(!Q)Q=H.body;let W=H.querySelector("title");if(W)document.title=W.textContent;if(C$($),$&&Q)v($,Q),$.querySelectorAll("script").forEach((P)=>{if(!P.__sprucex_executed)t$(P)});if(Z)history.pushState({url:G},"",G);C$($),$G();let D=$.parentElement;while(D){if(D.__sprucex)D.__sprucex.refresh();D=D.parentElement}I$();let S=new URL(G).hash;if(S){let P=document.querySelector(S);if(P)P.scrollIntoView()}else window.scrollTo(0,0);document.dispatchEvent(new CustomEvent("sprucex:page-after",{detail:{url:G,duration:performance.now()-z},bubbles:!0}))}catch(J){console.error("SpruceX page navigation error:",J),document.dispatchEvent(new CustomEvent("sprucex:page-error",{detail:{url:G,error:J},bubbles:!0})),window.location.href=G}}function C$(G){if(!G)return;if(G.querySelectorAll(`[${N}]`).forEach(($)=>{if($.__sprucex)$.__sprucex.destroy()}),G.hasAttribute(N)&&G.__sprucex)G.__sprucex.destroy()}async function JG(G){if(!G)return;try{let $=new URL(G,window.location.origin);if($.origin!==window.location.origin)return;if($.href===window.location.href)return;await M$($.href)}catch{}}async function M$(G){let $=T$(G);if($)return $;if(zG.has(G))return zG.get(G);let Z=(async()=>{try{let z=await fetch(G,{headers:{"X-SpruceX-Request":"true"}});if(!z.ok)throw new Error(`HTTP ${z.status}`);let Y=await z.text();return UG.set(G,{html:Y,timestamp:Date.now()}),Y}finally{zG.delete(G)}})();return zG.set(G,Z),Z}function T$(G){let $=UG.get(G);if(!$)return null;if(Date.now()-$.timestamp>c$)return UG.delete(G),null;return $.html}if(typeof document!=="undefined")if(R$(),window.addEventListener("load",()=>{E()}),document.readyState==="loading")document.addEventListener("DOMContentLoaded",$G);else $G();function t$(G){if(G.type&&G.type!=="text/javascript"&&G.type!=="application/javascript"&&G.type!=="module")return;let $=document.createElement("script");if(Array.from(G.attributes).forEach((Z)=>{$.setAttribute(Z.name,Z.value)}),$.src)$.addEventListener("load",()=>E(),{once:!0}),$.addEventListener("error",()=>E(),{once:!0});if($.textContent=G.textContent,$.__sprucex_executed=!0,G.replaceWith($),!$.src)queueMicrotask(()=>E())}})();
